<!DOCTYPE html>
<html prefix="" lang="es">
<head>
<meta charset="utf-8">
<meta name="description" content="Blog y sitio web personales">
<meta name="viewport" content="width=device-width">
<title>Nicolás' blog (publicaciones antiguas, página 4) | Nicolás' blog</title>
<link href="../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" href="rss.xml">
<link rel="canonical" href="https://nicoguaro.github.io/es/index-4.html">
<link rel="prev" href="index-5.html" type="text/html">
<link rel="next" href="index-3.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>A reserved <a href="https://getnikola.com" target="_blank">Nikola</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a> for Jekyll,
            ported to Nikola by <a href="https://twitter.com/ralsina" target="_blank">@ralsina</a>.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../pages/about/">About</a>
        <a class="sidebar-nav-item" href="../index.html">Blog</a>
        <a class="sidebar-nav-item" href="../pages/preprints-archive/">Preprints</a>
        <a class="sidebar-nav-item" href="../pages/links/">Links</a>
        <a class="sidebar-nav-item" href="../archive.html">Archive</a>
        <a class="sidebar-nav-item" href="../categories/">Tags</a>
        <a class="sidebar-nav-item" href="../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://nicoguaro.github.io/es/" title="Nicolás' blog" rel="home">Nicolás' blog</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        

<div class="posts">
    <article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_summary/" class="u-url">Reto de métodos numéricos: resumen</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_summary/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-11-14T11:22:23-05:00" title="2017-11-14 11:22">2017-11-14 11:22</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_summary/#disqus_thread" data-disqus-identifier="cache/posts/numerical_summary.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) escribí un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tenía experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="resumen">
<h2>Resumen</h2>
<p>Esta publicación resume el reto. Para ver el código fuente pueden remitirse
<a class="reference external" href="https://github.com/nicoguaro/numerical_challenge_2017">al repositorio</a>.</p>
<div class="section" id="el-veredicto">
<h3>El veredicto</h3>
<p>Ya que el reto es conmigo mismo, y el propósito era aprender algo de
Julia, el veredicto es: <strong>exitoso</strong>. Sin embargo, fallé en el día 26
con el Método de Elementos de Frontera.</p>
</div>
<div class="section" id="la-lista-de-metodos">
<h3>La lista de métodos</h3>
<table>
<colgroup>
<col style="width: 35%">
<col style="width: 65%">
</colgroup>
<thead><tr>
<th class="head"><p>Día</p></th>
<th class="head"><p>Método numérico</p></th>
</tr></thead>
<tbody>
<tr>
<td><p><a class="reference external" href="posts/numerical-01">01</a></p></td>
<td><p>Bisección</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-02">02</a></p></td>
<td><p>Regula falsi</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-03">03</a></p></td>
<td><p>Newton</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-04">04</a></p></td>
<td><p>Newton multivariable</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-05">05</a></p></td>
<td><p>Broyden</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-06">06</a></p></td>
<td><p>Descenso del gradiente</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-07">07</a></p></td>
<td><p>Nelder-Mead</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-08">08</a></p></td>
<td><p>Newton para optimización</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-09">09</a></p></td>
<td><p>Interpolación de Lagrange</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-10">10</a></p></td>
<td><p>Interpolación de Lagrange con muestreo de Lobatto</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-11">11</a></p></td>
<td><p>Interpolación de Lagrange con matriz de Vandermonde</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-12">12</a></p></td>
<td><p>Interpolación de Hermite</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-13">13</a></p></td>
<td><p>Interpolación spline</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-14">14</a></p></td>
<td><p>Cuadratura trapezoidal</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-15">15</a></p></td>
<td><p>Cuadratura de Simpson</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-16">16</a></p></td>
<td><p>Cuadratura de Clenshaw-Curtis</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-17">17</a></p></td>
<td><p>Integración de Euler</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-18">18</a></p></td>
<td><p>Integración de Runge-Kutta</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-19">19</a></p></td>
<td><p>Integración de Verlet</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-20">20</a></p></td>
<td><p>Método del disparo</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-21">21</a></p></td>
<td><p>Diferencias finitas con método de Jacobi</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-22">22</a></p></td>
<td><p>Diferencias finitas para valores propios</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-23">23</a></p></td>
<td><p>Método de Ritz</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-24">24</a></p></td>
<td><p>Elementos finitos en 1D</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-25">25</a></p></td>
<td><p>Elementos finitos en 2D</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-26">26</a></p></td>
<td><p>Método de elementos de frontera</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-27">27</a></p></td>
<td><p>Integración Monte-Carlo</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-28">28</a></p></td>
<td><p>Factorización LU factorization</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-29">29</a></p></td>
<td><p>Factorización de Cholesky</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-30">30</a></p></td>
<td><p>Gradiente conjugado</p></td>
</tr>
<tr>
<td><p><a class="reference external" href="posts/numerical-31">31</a></p></td>
<td><p>Elementos finitos con solucionador</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="conclusiones">
<h3>Conclusiones</h3>
<ul class="simple">
<li><p>Este era un ejercicio de kata de código para aprender algunos detalles sobre
Julia para computación científica. Como tal, fue muy útil para mí ensuciarme
las manos con Julia.</p></li>
<li><p>Implementar el Método de Elementos de Frontera en un día parece algo difícil.
Yo ya lo sabía de antemano, pero lo intenté de todas formas … sin éxito.</p></li>
<li><p>La sintaxis de Julia está en un punto intermedio entre Python y Matlab. Esto
hace que sea fácil de usar, aunque la documentación de algunas paquetes está
en una etapa preliminar en este momento.</p></li>
<li><p>No volveré a hacer un reto como estos en un rato. Requiere de mucha atención
realizarlo.</p></li>
</ul>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-31/" class="u-url">Reto de métodos numéricos: Día 31</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-31/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-31T20:45:09-05:00" title="2017-10-31 20:45">2017-10-31 20:45</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-31/#disqus_thread" data-disqus-identifier="cache/posts/numerical-31.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="poniendo-todo-junto">
<h2>Poniendo todo junto</h2>
<p>Hoy, estoy juntando partes, es decir, voy a resolver un sistema de ecuaciones
que resulta de elementos finitos usando gradiente conjugado.</p>
<p>A continuación el código.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-4"></a>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-5"></a>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-6"></a><span class="k">def</span> <span class="nf">FEM1D</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-7"></a>    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-8"></a>    <span class="n">stiff_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]])</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-9"></a>    <span class="n">eles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cont</span><span class="p">,</span> <span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-10"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-11"></a>    <span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-12"></a>    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">eles</span><span class="p">:</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-13"></a>        <span class="n">jaco</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-14"></a>        <span class="n">rhs</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">+</span> <span class="n">jaco</span><span class="o">*</span><span class="n">source</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">])</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-15"></a>        <span class="k">for</span> <span class="n">cont1</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele</span><span class="p">):</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-16"></a>            <span class="k">for</span> <span class="n">cont2</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele</span><span class="p">):</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-17"></a>                <span class="n">stiff</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">stiff</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">+</span>  <span class="n">stiff_loc</span><span class="p">[</span><span class="n">cont1</span><span class="p">,</span> <span class="n">cont2</span><span class="p">]</span><span class="o">/</span><span class="n">jaco</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-18"></a>    <span class="k">return</span> <span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-19"></a>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-20"></a>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-21"></a><span class="k">def</span> <span class="nf">conj_grad</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-22"></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-23"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">r</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-24"></a>    <span class="n">rsq_old</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-25"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-26"></a>        <span class="n">Ap</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-27"></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">rsq_old</span> <span class="o">/</span> <span class="n">p</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ap</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-28"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">p</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-29"></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="n">Ap</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-30"></a>        <span class="n">rsq_new</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-31"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rsq_new</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-32"></a>            <span class="k">break</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-33"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="p">(</span><span class="n">rsq_new</span> <span class="o">/</span> <span class="n">rsq_old</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-34"></a>        <span class="n">rsq_old</span> <span class="o">=</span> <span class="n">rsq_new</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-35"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">cont</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rsq_new</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-36"></a>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-37"></a>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-38"></a><span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-39"></a><span class="n">N_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-40"></a><span class="n">err_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">N_vec</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-41"></a><span class="n">niter_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">N_vec</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-42"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-43"></a><span class="k">for</span> <span class="n">cont</span><span class="p">,</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">N_vec</span><span class="p">):</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-44"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-45"></a>    <span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">FEM1D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-46"></a>    <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-47"></a>    <span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">niter</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">conj_grad</span><span class="p">(</span><span class="n">stiff</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-48"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sol</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-49"></a>    <span class="n">err_vec</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-50"></a>    <span class="n">niter_vec</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">niter</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-51"></a>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-52"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-53"></a><span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_vec</span><span class="p">,</span> <span class="n">err_vec</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-54"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Number of nodes"</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-55"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Relative error"</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-56"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-57"></a><span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_vec</span><span class="p">,</span> <span class="n">niter_vec</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-58"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Number of nodes"</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-59"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Number of iterations"</span><span class="p">)</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-60"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a name="rest_code_f3a12b76f13e4b0c898e1ef0192b044e-61"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_15710e1fa23241899527e197e0abffe3-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-2"></a>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-3"></a>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-4"></a><span class="k">function</span> <span class="n">FEM1D</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-5"></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-6"></a>    <span class="n">stiff_loc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">;</span> <span class="o">-</span><span class="mf">2.0</span> <span class="mf">2.0</span><span class="p">]</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-7"></a>    <span class="n">eles</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cont</span><span class="p">,</span> <span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">cont</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-8"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-9"></a>    <span class="n">rhs</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-10"></a>    <span class="k">for</span> <span class="n">ele</span> <span class="kp">in</span> <span class="n">eles</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-11"></a>        <span class="n">jaco</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-12"></a>        <span class="n">rhs</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">+</span> <span class="n">jaco</span><span class="o">*</span><span class="n">source</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">])</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-13"></a>        <span class="n">stiff</span><span class="p">[</span><span class="n">ele</span><span class="p">,</span> <span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">stiff</span><span class="p">[</span><span class="n">ele</span><span class="p">,</span> <span class="n">ele</span><span class="p">]</span> <span class="o">+</span>  <span class="n">stiff_loc</span><span class="o">/</span><span class="n">jaco</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-14"></a>    <span class="k">end</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-15"></a>    <span class="k">return</span> <span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-16"></a><span class="k">end</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-17"></a>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-18"></a>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-19"></a><span class="k">function</span> <span class="n">conj_grad</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-20"></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-21"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">r</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-22"></a>    <span class="n">rsq_old</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-23"></a>    <span class="n">niter</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-24"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-25"></a>        <span class="n">Ap</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">p</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-26"></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">rsq_old</span> <span class="o">/</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Ap</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-27"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">p</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-28"></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="n">Ap</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-29"></a>        <span class="n">rsq_new</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-30"></a>        <span class="k">if</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">rsq_new</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-31"></a>            <span class="k">break</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-32"></a>        <span class="k">end</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-33"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="p">(</span><span class="n">rsq_new</span> <span class="o">/</span> <span class="n">rsq_old</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-34"></a>        <span class="n">rsq_old</span> <span class="o">=</span> <span class="n">rsq_new</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-35"></a>        <span class="n">niter</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-36"></a>    <span class="k">end</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-37"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="p">,</span> <span class="n">norm</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-38"></a><span class="k">end</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-39"></a>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-40"></a>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-41"></a>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-42"></a><span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">.^</span><span class="mi">3</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-43"></a><span class="n">N_vec</span> <span class="o">=</span> <span class="n">round</span><span class="o">.</span><span class="p">(</span><span class="n">logspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-44"></a><span class="n">err_vec</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N_vec</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-45"></a><span class="n">niter_vec</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N_vec</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-46"></a><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-47"></a><span class="k">for</span> <span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="kp">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">N_vec</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-48"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-49"></a>    <span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">FEM1D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-50"></a>    <span class="n">sol</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-51"></a>    <span class="n">sol</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">niter</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">conj_grad</span><span class="p">(</span><span class="n">stiff</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-52"></a>                                <span class="o">-</span><span class="n">rhs</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-53"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">sol</span> <span class="o">-</span> <span class="n">x</span><span class="o">.*</span><span class="p">(</span><span class="n">x</span><span class="o">.^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="o">.*</span><span class="p">(</span><span class="n">x</span><span class="o">.^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-54"></a>    <span class="n">err_vec</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-55"></a>    <span class="n">niter_vec</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">niter</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-56"></a><span class="k">end</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-57"></a><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-58"></a><span class="n">loglog</span><span class="p">(</span><span class="n">N_vec</span><span class="p">,</span> <span class="n">err_vec</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-59"></a><span class="n">xlabel</span><span class="p">(</span><span class="s">"Number of nodes"</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-60"></a><span class="n">ylabel</span><span class="p">(</span><span class="s">"Relative error"</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-61"></a><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-62"></a><span class="n">loglog</span><span class="p">(</span><span class="n">N_vec</span><span class="p">,</span> <span class="n">niter_vec</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-63"></a><span class="n">xlabel</span><span class="p">(</span><span class="s">"Number of nodes"</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-64"></a><span class="n">ylabel</span><span class="p">(</span><span class="s">"Number of iterations"</span><span class="p">)</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-65"></a><span class="n">tight_layout</span><span class="p">()</span>
<a name="rest_code_15710e1fa23241899527e197e0abffe3-66"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>En este caso, vamos a analizar el error de la solución como función del número
de nodos. Se muestra esto y el número de iteraciones requeridas en el gradiente
conjugado.</p>
<img alt="Error relativo en la solución." class="align-center" src="../images/FEM1D_convergence.svg" style="width: 800px;">
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-30/" class="u-url">Reto de métodos numéricos: Día 30</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-30/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-30T19:38:03-05:00" title="2017-10-30 19:38">2017-10-30 19:38</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-30/#disqus_thread" data-disqus-identifier="cache/posts/numerical-30.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="gradiente-conjugado">
<h2>Gradiente conjugado</h2>
<p>Hoy tenemos el <a class="reference external" href="https://en.wikipedia.org/wiki/Conjugate_gradient_method">método del gradiente conjugado</a>.
Este método se usa comúnmente para resolver sistemas lineales positivos
definidos. En comparación con el descenso del gradiente, escogemos una
dirección de descenso que es conjugado con su residual, es decir, es ortogonal
con una matriz de ponderación.</p>
<p>A continuación se presenta el código.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-3"></a>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-4"></a>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-5"></a><span class="k">def</span> <span class="nf">conj_grad</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-6"></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-7"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">r</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-8"></a>    <span class="n">rsq_old</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-9"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-10"></a>        <span class="n">Ap</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-11"></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">rsq_old</span> <span class="o">/</span> <span class="n">p</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ap</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-12"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">p</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-13"></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="n">Ap</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-14"></a>        <span class="n">rsq_new</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-15"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rsq_new</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-16"></a>            <span class="k">break</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-17"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="p">(</span><span class="n">rsq_new</span> <span class="o">/</span> <span class="n">rsq_old</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-18"></a>        <span class="n">rsq_old</span> <span class="o">=</span> <span class="n">rsq_new</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-19"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">cont</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rsq_new</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-20"></a>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-21"></a>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-22"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-23"></a><span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>\
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-24"></a>    <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-25"></a><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-26"></a><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_6ae9dce500fc4e9fb6241347e1634030-27"></a><span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="p">,</span> <span class="n">accu</span> <span class="o">=</span> <span class="n">conj_grad</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-1"></a><span class="k">function</span> <span class="n">conj_grad</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-2"></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-3"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">r</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-4"></a>    <span class="n">rsq_old</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-5"></a>    <span class="n">niter</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-6"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-7"></a>        <span class="n">Ap</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">p</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-8"></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">rsq_old</span> <span class="o">/</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Ap</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-9"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">p</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-10"></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="n">Ap</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-11"></a>        <span class="n">rsq_new</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-12"></a>        <span class="k">if</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">rsq_new</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-13"></a>            <span class="k">break</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-14"></a>        <span class="k">end</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-15"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="p">(</span><span class="n">rsq_new</span> <span class="o">/</span> <span class="n">rsq_old</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-16"></a>        <span class="n">rsq_old</span> <span class="o">=</span> <span class="n">rsq_new</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-17"></a>        <span class="n">niter</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-18"></a>    <span class="k">end</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-19"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="p">,</span> <span class="n">norm</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-20"></a><span class="k">end</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-21"></a>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-22"></a>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-23"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-24"></a><span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="n">diagm</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="o">+</span> <span class="n">diagm</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">diagm</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-25"></a><span class="n">b</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-26"></a><span class="n">x0</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_7c57d3dad5d3491ab55eec81978d9942-27"></a><span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="p">,</span> <span class="n">accu</span> <span class="o">=</span> <span class="n">conj_grad</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
</pre>
<p>En este caso, vamos a probar el método con una matriz que viene de una
discretización de una derivada de segundo orden usando diferencias finitas.</p>
</div>
<div class="section" id="comparacion-python-julia">
<h3>Comparación Python/Julia</h3>
<p>Respecto al número de líneas tenemos: 27 en Python y 27 en Julia.  La comparación
en tiempo de ejecución se realizó con el comando mágico de IPython <code class="docutils literal">%timeit</code>
y con <code class="docutils literal">@benchmark</code> en Julia.</p>
<p>Para Python:</p>
<pre class="code IPython"><a name="rest_code_a7b7856fb67c4d8294647b4de195f75b-1"></a><span class="o">%</span><span class="k">timeit</span> conj_grad(A, b, x0)
</pre>
<p>con resultado</p>
<pre class="code text"><a name="rest_code_581cb79f3ff94812a2c363b6bc92d5c6-1"></a>10 loops, best of 3: 107 ms per loop
</pre>
<p>Para Julia:</p>
<pre class="code julia"><a name="rest_code_342c71ac86d54d8f9d094db1496f91c0-1"></a><span class="nd">@benchmark</span> <span class="n">conj_grad</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
</pre>
<p>con resultado</p>
<pre class="code julia"><a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">27.13</span> <span class="n">MiB</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">3501</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-4"></a>  <span class="o">--------------</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">128.477</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.54</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">294.407</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.24</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">298.208</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.30</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">464.223</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.30</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-9"></a>  <span class="o">--------------</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">17</span>
<a name="rest_code_c4f105f05e294d1aa847a5da4e9452b6-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>En este caso, podemos decir que el código de Python es alrededor de 2 veces más
rápido que el de Julia.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-29/" class="u-url">Reto de métodos numéricos: Día 29</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-29/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-29T21:10:08-05:00" title="2017-10-29 21:10">2017-10-29 21:10</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-29/#disqus_thread" data-disqus-identifier="cache/posts/numerical-29.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="descomposicion-de-cholesky">
<h2>Descomposición de Cholesky</h2>
<p>Hoy tenemos la <a class="reference external" href="https://en.wikipedia.org/wiki/Cholesky_decomposition">descomposición de Cholesky</a>.
Es una factorización de una matriz hermítica, positiva definita en matrices
triangulares inferior y superior. La diferencia principal con la descomposición LU
es que la matriz inferior es la transpuesta hermítica de la superior.</p>
<p>A continuación se presenta el código.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-3"></a>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-4"></a>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-5"></a><span class="k">def</span> <span class="nf">cholesky</span><span class="p">(</span><span class="n">mat</span><span class="p">):</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-6"></a>    <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-7"></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-8"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">-</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-10"></a>               <span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">col</span><span class="p">]))</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-11"></a>        <span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">-</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-12"></a>               <span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">col</span><span class="p">]))</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-13"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-14"></a>            <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">-</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-15"></a>               <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">col</span><span class="p">]))</span><span class="o">/</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-16"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-17"></a>        <span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-18"></a>    <span class="k">return</span> <span class="n">mat</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-19"></a>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-20"></a>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-21"></a><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-22"></a>    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-23"></a>    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">4.25</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">],</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-24"></a>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a name="rest_code_a903cbcdf27243aca8a83a33f065a8d7-25"></a><span class="n">B</span> <span class="o">=</span> <span class="n">cholesky</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-1"></a><span class="k">function</span> <span class="n">cholesky</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-2"></a>    <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-3"></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-4"></a>    <span class="k">for</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">m</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-5"></a>        <span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">-</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-6"></a>            <span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="n">col</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="n">col</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-7"></a>        <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="o">:</span><span class="n">m</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-8"></a>            <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">-</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-9"></a>               <span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="n">col</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="n">col</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-10"></a>        <span class="k">end</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-11"></a>    <span class="k">end</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-12"></a>    <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">m</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-13"></a>        <span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">row</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-14"></a>    <span class="k">end</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-15"></a>    <span class="k">return</span> <span class="n">mat</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-16"></a><span class="k">end</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-17"></a>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-18"></a>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-19"></a><span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">1</span><span class="p">;</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-20"></a>    <span class="o">-</span><span class="mi">1</span> <span class="mf">4.25</span> <span class="mf">2.75</span><span class="p">;</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-21"></a>    <span class="mi">1</span> <span class="mf">2.75</span> <span class="mf">3.5</span><span class="p">]</span>
<a name="rest_code_63f9784846254fb9ab6d07843daaf1e0-22"></a><span class="n">B</span> <span class="o">=</span> <span class="n">cholesky</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre>
<p>Como ejemplo tenemos la siguiente matriz</p>
<div class="math">
\begin{equation*}
A = \begin{bmatrix}
     4 &amp;-1 &amp;1\\
    -1 &amp;4.25 &amp;2.75\\
     1 &amp;2.75 &amp;3.5
    \end{bmatrix}
\end{equation*}
</div>
<p>Y la respuesta en ambos códigos es</p>
<pre class="code text"><a name="rest_code_ab698cc2b941418b956d74e355d9930c-1"></a>2.0  0.0  0.0
<a name="rest_code_ab698cc2b941418b956d74e355d9930c-2"></a>-0.5  2.0  0.0
<a name="rest_code_ab698cc2b941418b956d74e355d9930c-3"></a>0.5  1.5  1.0
</pre>
</div>
<div class="section" id="comparacion-python-julia">
<h3>Comparación Python/Julia</h3>
<p>Respecto al número de líneas tenemos: 23 en Python y 22 en Julia.  La comparación
en tiempo de ejecución se realizó con el comando mágico de IPython <code class="docutils literal">%timeit</code>
y con <code class="docutils literal">@benchmark</code> en Julia.</p>
<p>Para Python:</p>
<pre class="code IPython"><a name="rest_code_8f548c0312f94581b3ff6257c738cdc4-1"></a><span class="o">%</span><span class="k">timeit</span> cholesky(np.eye(100))
</pre>
<p>con resultado</p>
<pre class="code text"><a name="rest_code_e442657f24d44feca3b95281d04466a3-1"></a>100 loops, best of 3: 13 ms per loop
</pre>
<p>Para Julia:</p>
<pre class="code julia"><a name="rest_code_b1efa2cdcf2c43daa9acc904265ba9e6-1"></a><span class="nd">@benchmark</span> <span class="n">cholesky</span><span class="p">(</span><span class="n">eye</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</pre>
<p>con resultado</p>
<pre class="code julia"><a name="rest_code_fff55b4c707348279531085e7fc24f2d-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">4.01</span> <span class="n">MiB</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">20303</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-4"></a>  <span class="o">--------------</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">1.010</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">1.136</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">1.370</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">17.85</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">4.652</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">40.37</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-9"></a>  <span class="o">--------------</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">3637</span>
<a name="rest_code_fff55b4c707348279531085e7fc24f2d-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>En este caso, podemos decir que el código de Python es alrededor de 10 veces
más lento que el de Julia.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-28/" class="u-url">Reto de métodos numéricos: Día 28</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-28/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-28T17:02:38-05:00" title="2017-10-28 17:02">2017-10-28 17:02</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-28/#disqus_thread" data-disqus-identifier="cache/posts/numerical-28.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="factorizacion-lu">
<h2>Factorización LU</h2>
<p>Hoy tenemos la <a class="reference external" href="https://en.wikipedia.org/wiki/LU_decomposition">descomposición LU</a>.
Este es la factorización de una matriz en su formas triangulares inferior (L)
y superior (U). Básicamente, almacena cada uno de los pasos de una eliminación
gaussiana en matrices.</p>
<p>A continuación el código.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_bc99157059be4fa098d2124ad6686777-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-3"></a>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-4"></a>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-5"></a><span class="k">def</span> <span class="nf">LU</span><span class="p">(</span><span class="n">mat</span><span class="p">):</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-6"></a>    <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-7"></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-8"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-9"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-10"></a>            <span class="k">if</span> <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-11"></a>                <span class="n">lam</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">/</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-12"></a>                <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">-</span>\
<a name="rest_code_bc99157059be4fa098d2124ad6686777-13"></a>                                      <span class="n">lam</span> <span class="o">*</span> <span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">]</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-14"></a>                <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">lam</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-15"></a>    <span class="k">return</span> <span class="n">mat</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-16"></a>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-17"></a>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-18"></a><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-19"></a>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-20"></a>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-21"></a>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-22"></a>    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a name="rest_code_bc99157059be4fa098d2124ad6686777-23"></a><span class="n">B</span> <span class="o">=</span> <span class="n">LU</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-1"></a><span class="k">function</span> <span class="n">LU</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-2"></a>    <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-3"></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-4"></a>    <span class="k">for</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">m</span> <span class="o">-</span> <span class="mi">2</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-5"></a>        <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="o">:</span><span class="n">m</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-6"></a>            <span class="k">if</span> <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-7"></a>                <span class="n">lam</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">/</span><span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-8"></a>                <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="p">]</span> <span class="o">-</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-9"></a>                                      <span class="n">lam</span> <span class="o">*</span> <span class="n">mat</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="p">]</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-10"></a>                <span class="n">mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">lam</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-11"></a>            <span class="k">end</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-12"></a>        <span class="k">end</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-13"></a>    <span class="k">end</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-14"></a>    <span class="k">return</span> <span class="n">mat</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-15"></a><span class="k">end</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-16"></a>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-17"></a>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-18"></a><span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span> <span class="mf">1.0</span> <span class="mf">0.0</span> <span class="mf">3.0</span><span class="p">;</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-19"></a>    <span class="mf">2.0</span> <span class="mf">1.0</span> <span class="o">-</span><span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">;</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-20"></a>    <span class="mf">3.0</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">-</span><span class="mf">1.0</span> <span class="mf">2.0</span><span class="p">;</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-21"></a>    <span class="o">-</span><span class="mf">1.0</span> <span class="mf">2.0</span> <span class="mf">3.0</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
<a name="rest_code_f615432b8a6b437b85074ac2d9adffd9-22"></a><span class="n">B</span> <span class="o">=</span> <span class="n">LU</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre>
<p>Como un ejemplo tenemos la matriz</p>
<div class="math">
\begin{equation*}
A = \begin{bmatrix}
    1 &amp;1 &amp;0 &amp;3\\
    2 &amp;1 &amp;-1 &amp;1\\
    3 &amp;-1 &amp;-1 &amp;2\\
    -1 &amp;2 &amp;3 &amp;-1
    \end{bmatrix} =
    \begin{bmatrix}
    1 &amp;1 &amp;0 &amp;0\\
    2 &amp;1 &amp;0 &amp;0\\
    3 &amp;4 &amp;1 &amp;2\\
    -1 &amp;-3 &amp;0 &amp;1
    \end{bmatrix}
    \begin{bmatrix}
    1 &amp;1 &amp;0 &amp;3\\
    0 &amp;-1 &amp;-1 &amp;-5\\
    0 &amp;0 &amp;3 &amp;13\\
    0 &amp;0 &amp;0 &amp;-13
    \end{bmatrix}
\end{equation*}
</div>
<p>Y, la respuesta en ámbos códigos es</p>
<pre class="code text"><a name="rest_code_6b9c6ac3a39f4d21939f11e8d8ce04dd-1"></a>[[  1.,   1.,   0.,   3.],
<a name="rest_code_6b9c6ac3a39f4d21939f11e8d8ce04dd-2"></a> [  2.,  -1.,  -1.,  -5.],
<a name="rest_code_6b9c6ac3a39f4d21939f11e8d8ce04dd-3"></a> [  3.,   4.,   3.,  13.],
<a name="rest_code_6b9c6ac3a39f4d21939f11e8d8ce04dd-4"></a> [ -1.,  -3.,   0., -13.]]
</pre>
</div>
<div class="section" id="comparacion-python-julia">
<h3>Comparación Python/Julia</h3>
<p>Respecto al número de líneas tenemos: 23 en Python y 22 en Julia.  La comparación
en tiempo de ejecución se realizó con el comando mágico de IPython <code class="docutils literal">%timeit</code>
y con <code class="docutils literal">@benchmark</code> en Julia.</p>
<p>Para Python:</p>
<pre class="code IPython"><a name="rest_code_786c6f3f578c496ba8b7500a4a34a7b4-1"></a><span class="o">%</span><span class="k">timeit</span> LU(np.random.rand(10, 10))
</pre>
<p>con resultado</p>
<pre class="code text"><a name="rest_code_68fd318d988d4eeeacd5f1bfe8a387c3-1"></a>1000 loops, best of 3: 303 µs per loop
</pre>
<p>Para Julia:</p>
<pre class="code julia"><a name="rest_code_e950575462f546129c42213d78ca6ada-1"></a><span class="nd">@benchmark</span> <span class="n">LU</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre>
<p>con resultado</p>
<pre class="code julia"><a name="rest_code_23d7432d5cda475284201a95645b0f33-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">29.25</span> <span class="n">KiB</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">310</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-4"></a>  <span class="o">--------------</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">9.993</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">11.725</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">14.943</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">15.90</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">3.285</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">95.64</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-9"></a>  <span class="o">--------------</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_23d7432d5cda475284201a95645b0f33-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>En este caso, podemos decir que el código de Python es alrededor de 30 veces
más lento que el de Julia.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-27/" class="u-url">Reto de métodos numéricos: Día 27</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-27/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-27T21:27:06-05:00" title="2017-10-27 21:27">2017-10-27 21:27</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-27/#disqus_thread" data-disqus-identifier="cache/posts/numerical-27.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="integracion-monte-carlo">
<h2>Integración Monte Carlo</h2>
<p>Hoy tenemos la <a class="reference external" href="https://en.wikipedia.org/wiki/Monte_Carlo_integration">integración Monte Carlo</a>.
En donde usamos muestreo aleatorio para calcular una integral numéricamente.
Este método es importante cuando tenemos que evaluar integrales
multidimensionales ya que las técnicas de cuadratura usuales implican un
crecimiento exponencial con el número de puntos de muestreo.</p>
<p>El método cálcula una integral</p>
<div class="math">
\begin{equation*}
I = \int_\Omega f(x) dx
\end{equation*}
</div>
<p>donde <span class="math">\(\Omega\)</span> tiene volumen <span class="math">\(V\)</span>.</p>
<p>La integral es aproximada como</p>
<div class="math">
\begin{equation*}
I \approx \frac{V}{N} \sum_{i=1}^{N} f(x_i)
\end{equation*}
</div>
<p>donde <span class="math">\(x_i\)</span> está distribuido de manera uniforme sobre <span class="math">\(\Omega\)</span>.</p>
<p>A continuación se presenta el código.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_803cb66dac154564951082d93f99ed47-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-3"></a>
<a name="rest_code_803cb66dac154564951082d93f99ed47-4"></a>
<a name="rest_code_803cb66dac154564951082d93f99ed47-5"></a><span class="k">def</span> <span class="nf">monte_carlo_int</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-6"></a>    <span class="n">ndims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">low</span><span class="p">)</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-7"></a>    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">ndims</span><span class="p">))</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-8"></a>    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">high</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">low</span><span class="p">))</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-9"></a>    <span class="k">return</span> <span class="n">V</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span><span class="o">/</span><span class="n">N</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-10"></a>
<a name="rest_code_803cb66dac154564951082d93f99ed47-11"></a>
<a name="rest_code_803cb66dac154564951082d93f99ed47-12"></a><span class="k">def</span> <span class="nf">circ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rad</span><span class="p">):</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-13"></a>    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">rad</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-14"></a>
<a name="rest_code_803cb66dac154564951082d93f99ed47-15"></a>
<a name="rest_code_803cb66dac154564951082d93f99ed47-16"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">1000000</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-17"></a><span class="n">low</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-18"></a><span class="n">high</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-19"></a><span class="n">rad</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_803cb66dac154564951082d93f99ed47-20"></a><span class="n">inte</span> <span class="o">=</span> <span class="n">monte_carlo_int</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rad</span><span class="p">,))</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_967bf7e3f33e490eb12178fb4f439164-1"></a><span class="k">using</span> <span class="n">Distributions</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-2"></a>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-3"></a>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-4"></a><span class="k">function</span> <span class="n">monte_carlo_int</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-5"></a>    <span class="n">ndims</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">low</span><span class="p">)</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-6"></a>    <span class="n">pts</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">N</span><span class="p">,</span> <span class="n">ndims</span><span class="p">)</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-7"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">ndims</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-8"></a>        <span class="n">pts</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">high</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">-</span> <span class="n">low</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span> <span class="o">+</span> <span class="n">low</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-9"></a>    <span class="k">end</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-10"></a>    <span class="n">V</span> <span class="o">=</span> <span class="n">prod</span><span class="p">(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-11"></a>    <span class="k">return</span> <span class="n">V</span><span class="o">*</span><span class="n">sum</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">args</span><span class="o">...</span><span class="p">))</span><span class="o">/</span><span class="n">N</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-12"></a><span class="k">end</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-13"></a>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-14"></a>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-15"></a><span class="k">function</span> <span class="n">circ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-16"></a>    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sign</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">rad</span><span class="o">^</span><span class="mi">2</span><span class="p">))</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-17"></a><span class="k">end</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-18"></a>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-19"></a>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-20"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">1000000</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-21"></a><span class="n">low</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-22"></a><span class="n">high</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-23"></a><span class="n">rad</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_967bf7e3f33e490eb12178fb4f439164-24"></a><span class="n">inte</span> <span class="o">=</span> <span class="n">monte_carlo_int</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rad</span><span class="p">,))</span>
</pre>
<p>Una de los ejemplos más comunes es el cálculo de <span class="math">\(\pi\)</span>, esto se
ilustra en la siguiente animación.</p>
<img alt="Aproximación de pi usando Monte Carlo." class="align-center" src="https://upload.wikimedia.org/wikipedia/commons/8/84/Pi_30K.gif" style="width: 500px;">
</div>
<div class="section" id="comparacion-python-julia">
<h3>Comparación Python/Julia</h3>
<p>Respecto al número de líneas tenemos: 20 en Python y 24 en Julia.  La comparación
en tiempo de ejecución se realizó con el comando mágico de IPython <code class="docutils literal">%timeit</code>
y con <code class="docutils literal">@benchmark</code> en Julia.</p>
<p>Para Python:</p>
<pre class="code IPython"><a name="rest_code_aaa46e62181a4ae2930a93724b03fc43-1"></a><span class="o">%</span><span class="k">timeit</span> monte_carlo_int(circ, N, low, high, args=(rad,))
</pre>
<p>con resultado</p>
<pre class="code text"><a name="rest_code_cd32dd888ca8485192ee567c93f08ee6-1"></a>10 loops, best of 3: 53.2 ms per loop
</pre>
<p>Para Julia:</p>
<pre class="code julia"><a name="rest_code_a289e86c2c014040ab0bc1e6f7865c8a-1"></a><span class="nd">@benchmark</span> <span class="n">monte_carlo_int</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rad</span><span class="p">,))</span>
</pre>
<p>con result</p>
<pre class="code julia"><a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">129.70</span> <span class="n">MiB</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">46</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-4"></a>  <span class="o">--------------</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">60.131</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">5.15</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">164.018</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">55.64</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">204.366</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">49.50</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">357.749</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">64.04</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-9"></a>  <span class="o">--------------</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">25</span>
<a name="rest_code_54816a25c15e41dcbd9a9a87543c0d51-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>En este caso, podemos decir que el código de Python es alrededor de 3 veces más
rápido que el de Julia.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-26/" class="u-url">Reto de métodos numéricos: Día 26</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-26/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-26T19:15:08-05:00" title="2017-10-26 19:15">2017-10-26 19:15</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-26/#disqus_thread" data-disqus-identifier="cache/posts/numerical-26.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="metodo-de-elementos-de-frontera">
<h2>Método de elementos de frontera</h2>
<p>Hoy tenemos el <a class="reference external" href="https://en.wikipedia.org/wiki/Boundary_element_method">método de elementos de frontera</a>, o, un intento de él.
Queremos resolver la ecuación</p>
<div class="math">
\begin{equation*}
\nabla^2 u = -f(x)
\end{equation*}
</div>
<p>con</p>
<div class="math">
\begin{equation*}
u(x) = g(x),\quad \forall (x, y)\in \partial \Omega
\end{equation*}
</div>
<p>Para este método, necesitamos la repreentación integral de la ecuación, que
en este caso es</p>
<div class="math">
\begin{equation*}
u(\xi)  = \int_{S} [u(x) F(x, \xi) - q(x)G(x, \xi)]dS(x) +
          \int_{V} f(x) G(x, \xi) dV(x)
\end{equation*}
</div>
<p>con</p>
<div class="math">
\begin{equation*}
G(x,\xi)= -\frac{1}{2\pi}\ln|x- \xi|
\end{equation*}
</div>
<p>y</p>
<div class="math">
\begin{equation*}
F(x,\xi) = -\frac{1}{2\pi |x- \xi|^2}(x - \xi)\cdot\hat{n}
\end{equation*}
</div>
<p>Entonces, podemos formar el sistema de ecuaciones</p>
<div class="math">
\begin{equation*}
[G]\{q\} = [F]\{u\}\, ,
\end{equation*}
</div>
<p>Que obtenemos de discretizar la frontera. Si tomamos variables constantes a lo
largo de la discretización, las integrales se pueden calcular analíticamente</p>
<div class="math">
\begin{equation*}
G_{nm} = -\frac{1}{2\pi}\left[r \sin\theta\left(\ln|r| - 1\right)
         + \theta r\cos\theta\right]^{\theta_B, r_B}_{\theta_A, r_A}
\end{equation*}
</div>
<p>y</p>
<div class="math">
\begin{equation*}
F_{nm} = \left[\frac{\theta}{2\pi}\right]^{\theta_B}_{\theta_A}
\end{equation*}
</div>
<p>para <span class="math">\(n\)</span> y <span class="math">\(m\)</span> en diferentes elementos, y los subíndices
<span class="math">\(A,B\)</span> se refieren a los puntos finales del elemento a evaluar.
Para los términos en la diagonal las integrales son</p>
<div class="math">
\begin{equation*}
G_{nn} = -\frac{L}{2\pi}\left(\ln\left\vert\frac{L}{2}\right\vert - 1\right)
\end{equation*}
</div>
<p>y</p>
<div class="math">
\begin{equation*}
F_{nn} = - \frac{1}{2\pi}
\end{equation*}
</div>
<p>con <span class="math">\(L\)</span>, el tamaño del elemento.</p>
<p>A continuación se muestra el código de Python. En este caso, no tuve éxito en
hacer que el código funcionara.</p>
<pre class="code python"><a name="rest_code_5251c85d6e374ab9a122d68c29df5722-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-3"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">arctan2</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">arctan</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-4"></a><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span><span class="p">,</span> <span class="n">solve</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-5"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-6"></a>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-7"></a>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-8"></a><span class="k">def</span> <span class="nf">assem</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elems</span><span class="p">):</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-9"></a>    <span class="n">nelems</span> <span class="o">=</span> <span class="n">elems</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-10"></a>    <span class="n">Gmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nelems</span><span class="p">,</span> <span class="n">nelems</span><span class="p">))</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-11"></a>    <span class="n">Fmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nelems</span><span class="p">,</span> <span class="n">nelems</span><span class="p">))</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-12"></a>    <span class="k">for</span> <span class="n">ev_cont</span><span class="p">,</span> <span class="n">elem1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elems</span><span class="p">):</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-13"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">elem1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">coords</span><span class="p">[</span><span class="n">elem1</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-14"></a>        <span class="k">for</span> <span class="n">col_cont</span><span class="p">,</span> <span class="n">elem2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elems</span><span class="p">):</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-15"></a>            <span class="n">pt_col</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">elem2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-16"></a>            <span class="k">if</span> <span class="n">ev_cont</span> <span class="o">==</span> <span class="n">col_cont</span><span class="p">:</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-17"></a>                <span class="n">L</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">elem1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">elem1</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-18"></a>                <span class="n">Gmat</span><span class="p">[</span><span class="n">ev_cont</span><span class="p">,</span> <span class="n">ev_cont</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-19"></a>                <span class="n">Fmat</span><span class="p">[</span><span class="n">ev_cont</span><span class="p">,</span> <span class="n">ev_cont</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.5</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-20"></a>            <span class="k">else</span><span class="p">:</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-21"></a>                <span class="n">Gij</span><span class="p">,</span> <span class="n">Fij</span> <span class="o">=</span> <span class="n">influence_coeff</span><span class="p">(</span><span class="n">elem1</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">pt_col</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-22"></a>                <span class="n">Gmat</span><span class="p">[</span><span class="n">ev_cont</span><span class="p">,</span> <span class="n">col_cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gij</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-23"></a>                <span class="n">Fmat</span><span class="p">[</span><span class="n">ev_cont</span><span class="p">,</span> <span class="n">col_cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">Fij</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-24"></a>    <span class="k">return</span> <span class="n">Gmat</span><span class="p">,</span> <span class="n">Fmat</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-25"></a>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-26"></a>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-27"></a><span class="k">def</span> <span class="nf">influence_coeff</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">pt_col</span><span class="p">):</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-28"></a>    <span class="n">r_A</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">pt_col</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-29"></a>    <span class="n">r_B</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">pt_col</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-30"></a>    <span class="n">theta_A</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="n">r_A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_A</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-31"></a>    <span class="n">theta_B</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="n">r_B</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_B</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-32"></a>    <span class="n">G_coeff</span> <span class="o">=</span> <span class="n">r_B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">r_B</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta_B</span><span class="o">*</span><span class="n">r_B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>\
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-33"></a>              <span class="p">(</span><span class="n">r_A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">r_A</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta_A</span><span class="o">*</span><span class="n">r_A</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-34"></a>    <span class="n">F_coeff</span> <span class="o">=</span> <span class="n">theta_B</span> <span class="o">-</span> <span class="n">theta_A</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-35"></a>    <span class="k">return</span> <span class="o">-</span><span class="n">G_coeff</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span> <span class="n">F_coeff</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-36"></a>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-37"></a>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-38"></a><span class="k">def</span> <span class="nf">eval_sol</span><span class="p">(</span><span class="n">ev_coords</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-39"></a>    <span class="n">nelems</span> <span class="o">=</span> <span class="n">elems</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-40"></a>    <span class="n">Gmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nelems</span><span class="p">,</span> <span class="n">nelems</span><span class="p">))</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-41"></a>    <span class="n">Fmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nelems</span><span class="p">,</span> <span class="n">nelems</span><span class="p">))</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-42"></a>    <span class="k">for</span> <span class="n">ev_cont</span><span class="p">,</span> <span class="n">elem1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elems</span><span class="p">):</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-43"></a>        <span class="n">L</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">elem1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">elem1</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-44"></a>        <span class="k">for</span> <span class="n">col_cont</span><span class="p">,</span> <span class="n">elem2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elems</span><span class="p">):</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-45"></a>            <span class="n">pt_col</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">elem2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-46"></a>            <span class="k">if</span> <span class="n">ev_cont</span> <span class="o">==</span> <span class="n">col_cont</span><span class="p">:</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-47"></a>                <span class="n">Gmat</span><span class="p">[</span><span class="n">ev_cont</span><span class="p">,</span> <span class="n">ev_cont</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-48"></a>                <span class="n">Fmat</span><span class="p">[</span><span class="n">ev_cont</span><span class="p">,</span> <span class="n">ev_cont</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.5</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-49"></a>            <span class="k">else</span><span class="p">:</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-50"></a>                <span class="n">Gmat</span><span class="p">[</span><span class="n">ev_cont</span><span class="p">,</span> <span class="n">col_cont</span><span class="p">],</span> <span class="n">Fmat</span><span class="p">[</span><span class="n">ev_cont</span><span class="p">,</span> <span class="n">col_cont</span><span class="p">]</span> <span class="o">=</span> \
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-51"></a>                    <span class="n">influence_coeff</span><span class="p">(</span><span class="n">elem1</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">pt_col</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-52"></a>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-53"></a><span class="n">nelems</span> <span class="o">=</span> <span class="mi">3</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-54"></a><span class="n">rad</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-55"></a><span class="n">theta</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">nelems</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-56"></a><span class="n">coords</span> <span class="o">=</span> <span class="n">rad</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-57"></a><span class="n">elems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cont</span><span class="p">,</span> <span class="p">(</span><span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">nelems</span><span class="p">]</span> <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nelems</span><span class="p">)])</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-58"></a><span class="n">Gmat</span><span class="p">,</span> <span class="n">Fmat</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elems</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-59"></a><span class="n">u_boundary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<a name="rest_code_5251c85d6e374ab9a122d68c29df5722-60"></a><span class="n">q_boundary</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">Gmat</span><span class="p">,</span> <span class="n">Fmat</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u_boundary</span><span class="p">))</span>
</pre>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-25/" class="u-url">Reto de métodos numéricos: Día 25</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-25/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-25T21:41:53-05:00" title="2017-10-25 21:41">2017-10-25 21:41</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-25/#disqus_thread" data-disqus-identifier="cache/posts/numerical-25.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="metodo-de-elementos-finitos">
<h2>Método de elementos finitos</h2>
<p>Hoy tenemos el <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_element_method">método de elementos finitos</a> para resolver la
ecuación:</p>
<div class="math">
\begin{equation*}
\nabla^2 u = -f(x)
\end{equation*}
</div>
<p>con</p>
<div class="math">
\begin{equation*}
u(\sqrt{3}, 1) = 0
\end{equation*}
</div>
<p>Como en el <a class="reference external" href="posts/numerical-25/posts/numerical-23">método de Ritz</a> formamos un funcional
que es <em>equivalente</em> a la ecuación diferencial, proponemos una aproximación que
es una combinación lineal de funciones base y encontramos el <em>mejor</em> conjunto
de coeficientes para esta combinación. La <em>mejor</em> solución se encuentra
minimizando el funcional.</p>
<p>El funcional para este ecuación diferencial es</p>
<div class="math">
\begin{equation*}
\Pi[u] = -\int_\Omega \left(\nabla u\right)^2 d\Omega
         -\int_\Omega  u f(x) d\Omega
\end{equation*}
</div>
<p>Usando triángulos lineales, las matrices de rigidez son</p>
<div class="math">
\begin{equation*}
K_\text{local} =  \frac{1}{2|J|}
    \begin{bmatrix}
        2 &amp; -1 &amp;1\\
        -1 &amp; 1 &amp;0\\
        -1 &amp; 0 &amp;1\\
    \end{bmatrix}
\end{equation*}
</div>
<p>y</p>
<div class="math">
\begin{equation*}
b_\text{local} = -|J| f(x_m) \mathbf{1}_3\, ,
\end{equation*}
</div>
<p>donde <span class="math">\(|J|\)</span> es el determinante jacobiano de la transformación y
<span class="math">\(x_m\)</span> es el centroide del triángulo. Me estoy
saltando muchos detalles respecto al ensamblaje; sería muy costoso describir
el proceso completo.</p>
<p>Vamos a resolver el problema en una malla de 6 triángulos que forman un
hexágono regular.</p>
<p>A continuación se presenta el código.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-4"></a>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-5"></a><span class="k">def</span> <span class="nf">assem</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-6"></a>    <span class="n">ncoords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-7"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ncoords</span><span class="p">,</span> <span class="n">ncoords</span><span class="p">))</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-8"></a>    <span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ncoords</span><span class="p">))</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-9"></a>    <span class="k">for</span> <span class="n">el_cont</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elems</span><span class="p">):</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-10"></a>        <span class="n">stiff_loc</span><span class="p">,</span> <span class="n">jaco</span> <span class="o">=</span> <span class="n">local_stiff</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-11"></a>        <span class="n">rhs</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+=</span> <span class="n">jaco</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-12"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-13"></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-14"></a>                <span class="n">row_glob</span><span class="p">,</span> <span class="n">col_glob</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">elem</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-15"></a>                <span class="n">stiff</span><span class="p">[</span><span class="n">row_glob</span><span class="p">,</span> <span class="n">col_glob</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stiff_loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-16"></a>    <span class="k">return</span> <span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-17"></a>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-18"></a>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-19"></a><span class="k">def</span> <span class="nf">local_stiff</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-20"></a>    <span class="n">dHdr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-21"></a>    <span class="n">jaco</span> <span class="o">=</span> <span class="n">dHdr</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-22"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-23"></a>    <span class="k">return</span> <span class="n">stiff</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">jaco</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">jaco</span><span class="p">)</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-24"></a>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-25"></a>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-26"></a><span class="n">sq3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-27"></a><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-28"></a>        <span class="p">[</span><span class="n">sq3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-29"></a>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-30"></a>        <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">sq3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-31"></a>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-32"></a>        <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">sq3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-33"></a>        <span class="p">[</span><span class="n">sq3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-34"></a>        <span class="p">[</span><span class="n">sq3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-35"></a><span class="n">elems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-36"></a>        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-37"></a>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-38"></a>        <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-39"></a>        <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-40"></a>        <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-41"></a>        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-42"></a><span class="n">source</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-43"></a><span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-44"></a><span class="n">free</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-45"></a><span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">stiff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">free</span><span class="p">,</span> <span class="n">free</span><span class="p">)],</span> <span class="n">rhs</span><span class="p">[</span><span class="n">free</span><span class="p">])</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-46"></a><span class="n">sol_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-47"></a><span class="n">sol_c</span><span class="p">[</span><span class="n">free</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-48"></a><span class="n">plt</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sol_c</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"hot"</span><span class="p">)</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-49"></a><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-50"></a><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">"image"</span><span class="p">)</span>
<a name="rest_code_2fdd5ea2af43480eaf03e3c18d6fc573-51"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_d59f94d13cf842f1827862db692cdf3d-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-2"></a>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-3"></a>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-4"></a><span class="k">function</span> <span class="n">assem</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-5"></a>    <span class="n">ncoords</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-6"></a>    <span class="n">nelems</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">elems</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-7"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">ncoords</span><span class="p">,</span> <span class="n">ncoords</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-8"></a>    <span class="n">rhs</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">ncoords</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-9"></a>    <span class="k">for</span> <span class="n">el_cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">nelems</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-10"></a>        <span class="n">elem</span> <span class="o">=</span> <span class="n">elems</span><span class="p">[</span><span class="n">el_cont</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-11"></a>        <span class="n">stiff_loc</span><span class="p">,</span> <span class="n">jaco</span> <span class="o">=</span> <span class="n">local_stiff</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">elem</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-12"></a>        <span class="n">rhs</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+=</span> <span class="n">jaco</span><span class="o">*</span><span class="n">mean</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-13"></a>        <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-14"></a>            <span class="k">for</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-15"></a>                <span class="n">row_glob</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-16"></a>                <span class="n">col_glob</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-17"></a>                <span class="n">stiff</span><span class="p">[</span><span class="n">row_glob</span><span class="p">,</span> <span class="n">col_glob</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stiff_loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-18"></a>            <span class="k">end</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-19"></a>        <span class="k">end</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-20"></a>    <span class="k">end</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-21"></a>    <span class="k">return</span> <span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-22"></a><span class="k">end</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-23"></a>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-24"></a>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-25"></a><span class="k">function</span> <span class="n">local_stiff</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-26"></a>    <span class="n">dHdr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">;</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-27"></a>    <span class="n">jaco</span> <span class="o">=</span> <span class="n">dHdr</span> <span class="o">*</span> <span class="n">coords</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-28"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">;</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-29"></a>    <span class="k">return</span> <span class="n">stiff</span><span class="o">/</span><span class="n">det</span><span class="p">(</span><span class="n">jaco</span><span class="p">),</span> <span class="n">det</span><span class="p">(</span><span class="n">jaco</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-30"></a><span class="k">end</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-31"></a>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-32"></a>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-33"></a><span class="n">sq3</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-34"></a><span class="n">coords</span> <span class="o">=</span><span class="p">[</span><span class="n">sq3</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-35"></a>        <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-36"></a>        <span class="mi">2</span><span class="o">*</span><span class="n">sq3</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-37"></a>        <span class="mi">0</span> <span class="mi">2</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-38"></a>        <span class="mi">2</span><span class="o">*</span><span class="n">sq3</span> <span class="mi">2</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-39"></a>        <span class="n">sq3</span> <span class="mi">3</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-40"></a>        <span class="n">sq3</span> <span class="mi">1</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-41"></a><span class="n">elems</span> <span class="o">=</span><span class="p">[</span><span class="mi">2</span> <span class="mi">1</span> <span class="mi">7</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-42"></a>        <span class="mi">1</span> <span class="mi">3</span> <span class="mi">7</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-43"></a>        <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-44"></a>        <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-45"></a>        <span class="mi">6</span> <span class="mi">4</span> <span class="mi">7</span><span class="p">;</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-46"></a>        <span class="mi">4</span> <span class="mi">2</span> <span class="mi">7</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-47"></a><span class="n">source</span> <span class="o">=</span> <span class="o">-</span><span class="n">ones</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-48"></a><span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">assem</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-49"></a><span class="n">free</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">6</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-50"></a><span class="n">sol</span> <span class="o">=</span> <span class="n">stiff</span><span class="p">[</span><span class="n">free</span><span class="p">,</span> <span class="n">free</span><span class="p">]</span> <span class="o">\</span> <span class="n">rhs</span><span class="p">[</span><span class="n">free</span><span class="p">]</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-51"></a><span class="n">sol_c</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-52"></a><span class="n">sol_c</span><span class="p">[</span><span class="n">free</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-53"></a><span class="n">tricontourf</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">sol_c</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"hot"</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-54"></a><span class="n">colorbar</span><span class="p">()</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-55"></a><span class="n">axis</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>
<a name="rest_code_d59f94d13cf842f1827862db692cdf3d-56"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>En ambos casos tenemos el mismo resultado.</p>
<img alt="Aproximación por el método de elementos finitos." class="align-center" src="../images/FEM2D.svg" style="width: 500px;">
</div>
<div class="section" id="comparacion-python-julia">
<h3>Comparación Python/Julia</h3>
<p>Respecto al número de líneas tenemos: 51 en Python y 56 en Julia.  La comparación
en tiempo de ejecución se realizó con el comando mágico de IPython <code class="docutils literal">%timeit</code>
y con <code class="docutils literal">@benchmark</code> en Julia. Para la comparación solo estamos considerando el
tiempo que toma formar las matrices.</p>
<p>Para Python:</p>
<pre class="code IPython"><a name="rest_code_b1bd4d73149c4fd08b8600b6ec5d9dc2-1"></a><span class="o">%</span><span class="k">timeit</span> assem(coords, elems, source)
</pre>
<p>con resultado</p>
<pre class="code text"><a name="rest_code_f1a960f93ab6432a9e0409d7d527c290-1"></a>1000 loops, best of 3: 671 µs per loop
</pre>
<p>Para Julia:</p>
<pre class="code julia"><a name="rest_code_078bf3d40498417684b0fc93beb703ec-1"></a><span class="nd">@benchmark</span> <span class="n">assem</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</pre>
<p>con resultado</p>
<pre class="code julia"><a name="rest_code_88c3eeba7f844450bea301fa9dca1184-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">13.30</span> <span class="n">KiB</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">179</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-4"></a>  <span class="o">--------------</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">7.777</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">8.934</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">10.810</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">14.54</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">797.432</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">95.85</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-9"></a>  <span class="o">--------------</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_88c3eeba7f844450bea301fa9dca1184-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">4</span>
</pre>
<p>En este caso, podemos decir que el código de Python es alrededor de 70 veces más
lento que el de Julia.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-24/" class="u-url">Reto de métodos numéricos: Día 24</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-24/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-24T15:17:58-05:00" title="2017-10-24 15:17">2017-10-24 15:17</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-24/#disqus_thread" data-disqus-identifier="cache/posts/numerical-24.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="metodo-de-elementos-finitos">
<h2>Método de elementos finitos</h2>
<p>Hoy tenemos el <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_element_method">método de elementos finitos</a> para resolver la
ecuación:</p>
<div class="math">
\begin{equation*}
\frac{d^2 u}{dx^2} = f(x)
\end{equation*}
</div>
<p>con</p>
<div class="math">
\begin{equation*}
u(0) = u(1)  = 0
\end{equation*}
</div>
<p>Como en el <a class="reference external" href="posts/numerical-24/posts/numerical-23">método de Ritz</a> formamos un funcional
que es <em>equivalente</em> a la ecuación diferencial, proponemos una aproximación que
es una combinación lineal de funciones base y encontramos el <em>mejor</em> conjunto
de coeficientes para esta combinación. La <em>mejor</em> solución se encuentra
minimizando el funcional.</p>
<p>El funcional para este ecuación diferencial es</p>
<div class="math">
\begin{equation*}
\Pi[u] = -\int_{0}^{1} \left(\frac{d u}{d x}\right)^2 dx
         -\int_{0}^{1}  u f(x) dx
\end{equation*}
</div>
<p>La diferencia principal es que usamos interpolación por tramos como funciones
base,</p>
<div class="math">
\begin{equation*}
\hat{u}(x) = \sum_{n=0}^{N} u_n N_n(x)\, ,
\end{equation*}
</div>
<p>Esto lleva al siguiente sistema de ecuaciones</p>
<div class="math">
\begin{equation*}
[K]\{\mathbf{c}\} = \{\mathbf{b}\}
\end{equation*}
</div>
<p>donde las matrices de rigidez locales están dadas por</p>
<div class="math">
\begin{equation*}
K_\text{local} =  \frac{1}{|J|}\begin{bmatrix} 2 &amp; -2\\ -2 &amp;2\end{bmatrix}
\end{equation*}
</div>
<p>y</p>
<div class="math">
\begin{equation*}
b_\text{local} = -|J|\begin{bmatrix} f(x_m)\\ f(x_{n})\end{bmatrix}\, ,
\end{equation*}
</div>
<p>donde <span class="math">\(|J|\)</span> es el determinante jacobian de la transformación. Me estoy
saltando muchos detalles respecto al ensamblaje; sería muy costoso describir
el proceso completo.</p>
<p>Probaremos la implementación con la función <span class="math">\(f(x) = x^3\)</span>, que lleva a
la solución
.. math:</p>
<pre class="literal-block">u(x) = \frac{x (x^4 - 1)}{20}</pre>
<p>A continuacón se presenta el código.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-4"></a>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-5"></a>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-6"></a><span class="k">def</span> <span class="nf">FEM1D</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-7"></a>    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-8"></a>    <span class="n">stiff_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]])</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-9"></a>    <span class="n">eles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cont</span><span class="p">,</span> <span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-10"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-11"></a>    <span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-12"></a>    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">eles</span><span class="p">:</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-13"></a>        <span class="n">jaco</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-14"></a>        <span class="n">rhs</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">+</span> <span class="n">jaco</span><span class="o">*</span><span class="n">source</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">])</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-15"></a>        <span class="k">for</span> <span class="n">cont1</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele</span><span class="p">):</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-16"></a>            <span class="k">for</span> <span class="n">cont2</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele</span><span class="p">):</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-17"></a>                <span class="n">stiff</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">stiff</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">+</span>  <span class="n">stiff_loc</span><span class="p">[</span><span class="n">cont1</span><span class="p">,</span> <span class="n">cont2</span><span class="p">]</span><span class="o">/</span><span class="n">jaco</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-18"></a>    <span class="k">return</span> <span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-19"></a>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-20"></a>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-21"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-22"></a><span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-23"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-24"></a><span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">FEM1D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-25"></a><span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-26"></a><span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">stiff</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-27"></a>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-28"></a>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-29"></a><span class="c1">#%% Plotting</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-30"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-31"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-32"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-33"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-34"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$y$"</span><span class="p">)</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-35"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"FEM solution"</span><span class="p">,</span> <span class="s2">"Exact solution"</span><span class="p">])</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-36"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a name="rest_code_bfb2b9fa6eff4d78beac143d33f3f3b2-37"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-2"></a>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-3"></a>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-4"></a><span class="k">function</span> <span class="n">FEM1D</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-5"></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-6"></a>    <span class="n">stiff_loc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">;</span> <span class="o">-</span><span class="mf">2.0</span> <span class="mf">2.0</span><span class="p">]</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-7"></a>    <span class="n">eles</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cont</span><span class="p">,</span> <span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">cont</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-8"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-9"></a>    <span class="n">rhs</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-10"></a>    <span class="k">for</span> <span class="n">ele</span> <span class="kp">in</span> <span class="n">eles</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-11"></a>        <span class="n">jaco</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-12"></a>        <span class="n">rhs</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">+</span> <span class="n">jaco</span><span class="o">*</span><span class="n">source</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">ele</span><span class="p">])</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-13"></a>        <span class="n">stiff</span><span class="p">[</span><span class="n">ele</span><span class="p">,</span> <span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">stiff</span><span class="p">[</span><span class="n">ele</span><span class="p">,</span> <span class="n">ele</span><span class="p">]</span> <span class="o">+</span>  <span class="n">stiff_loc</span><span class="o">/</span><span class="n">jaco</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-14"></a>    <span class="k">end</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-15"></a>    <span class="k">return</span> <span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-16"></a><span class="k">end</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-17"></a>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-18"></a>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-19"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-20"></a><span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">.^</span><span class="mi">3</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-21"></a><span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-22"></a><span class="n">stiff</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">FEM1D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-23"></a><span class="n">sol</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-24"></a><span class="n">sol</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">stiff</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">\</span><span class="n">rhs</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-25"></a>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-26"></a>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-27"></a><span class="c">#%% Plotting</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-28"></a><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-29"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-30"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">.*</span><span class="p">(</span><span class="n">x</span><span class="o">.^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">"dashed"</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-31"></a><span class="n">xlabel</span><span class="p">(</span><span class="n">L</span><span class="s">"</span><span class="si">$x</span><span class="s">$"</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-32"></a><span class="n">ylabel</span><span class="p">(</span><span class="n">L</span><span class="s">"</span><span class="si">$y</span><span class="s">$"</span><span class="p">)</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-33"></a><span class="n">legend</span><span class="p">([</span><span class="s">"FEM solution"</span><span class="p">,</span> <span class="s">"Exact solution"</span><span class="p">])</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-34"></a><span class="n">tight_layout</span><span class="p">()</span>
<a name="rest_code_7a10deba57754e73b0f6d4b82ec8784e-35"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>Ambos presentan el mismo resultado que se ve a continuación.</p>
<img alt="Aproximación por el método de elementos finitos." class="align-center" src="../images/FEM1D.svg" style="width: 400px;">
</div>
<div class="section" id="comparacion-python-julia">
<h3>Comparación Python/Julia</h3>
<p>Respecto al número de líneas tenemos: 37 en Python y 35 en Julia.  La comparación
en tiempo de ejecución se realizó con el comando mágico de IPython <code class="docutils literal">%timeit</code>
y con <code class="docutils literal">@benchmark</code> en Julia. Para la comparación solo estamos considerando el
tiempo que toma formar las matrices.</p>
<p>Para Python:</p>
<pre class="code IPython"><a name="rest_code_30e38da135214a078009c6f51a1c9dc9-1"></a><span class="o">%</span><span class="k">timeit</span> FEM1D(x, fun)
</pre>
<p>con resultado</p>
<pre class="code text"><a name="rest_code_c7cbbdf9e23f422899f07f7826045ced-1"></a>100 loops, best of 3: 2.15 ms per loop
</pre>
<p>Para Julia:</p>
<pre class="code julia"><a name="rest_code_1feaa1f29e744b7786468819e9b5be63-1"></a><span class="nd">@benchmark</span> <span class="n">FEM1D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">)</span>
</pre>
<p>con resultado</p>
<pre class="code julia"><a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">183.73</span> <span class="n">KiB</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">1392</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-4"></a>  <span class="o">--------------</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">60.045</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">70.445</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">98.276</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">25.64</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">4.269</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">96.70</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-9"></a>  <span class="o">--------------</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_c7f9bece989c4732bc6e35f4ed799ee8-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>En este caso, podemos decir que el código de Python es alrededor de 30 veces
más lento que el de Julia.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-23/" class="u-url">Reto de métodos numéricos: Día 23</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-23/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-23T20:30:03-05:00" title="2017-10-23 20:30">2017-10-23 20:30</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-23/#disqus_thread" data-disqus-identifier="cache/posts/numerical-23.html">Comentarios</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Durante octubre (2017) estaré escribiendo un programa por día para algunos
métodos numéricos famosos en Python y Julia. Esto está pensado como
un ejercicio, no esperen que el código sea lo suficientemente bueno para
usarse en la "vida real". Además, también debo mencionar que casi que no
tengo experiencia con Julia, así que probablemente no escriba un Julia
idiomático y se parezca más a Python.</p>
<div class="section" id="metodo-de-ritz">
<h2>Método de Ritz</h2>
<p>Hoy tenemos el <a class="reference external" href="https://en.wikipedia.org/wiki/Ritz_method">método de Ritz</a>
para resolver la ecuación:</p>
<div class="math">
\begin{equation*}
\frac{d^2 u}{dx^2} = f(x)
\end{equation*}
</div>
<p>con</p>
<div class="math">
\begin{equation*}
u(0) = u(1)  = 0
\end{equation*}
</div>
<p>El método consiste en formar un funcional que es <em>equivalente</em> a la ecuación
diferencial, proponer una aproximación como una combinación lineal de un
conjunto de funciones base y encontrar el <em>mejor</em> conjunto de coeficientes
para esta combinación. Este <em>mejor</em> solución se encuentra minimizando el
funcional.</p>
<p>El funcional para esta ecuación diferencial es</p>
<div class="math">
\begin{equation*}
\Pi[u] = -\int_{0}^{1} \left(\frac{d u}{d x}\right)^2 dx
         -\int_{0}^{1}  u f(x) dx
\end{equation*}
</div>
<p>En este caso, estamos usando la aproximación</p>
<div class="math">
\begin{equation*}
\hat{u}(x) = x (1 - x)\sum_{n=0}^{N} c_n x^n\, ,
\end{equation*}
</div>
<p>en donde escogimos el factor <span class="math">\(x (1 - x)\)</span> para forzar que las funciones
satisfagan las condiciones de frontera. El funcional aproximado es</p>
<div class="math">
\begin{align*}
\Pi[\hat{u}] = -\sum_{n=0}^{N} \sum_{m=0}^{N} c_n c_m
    \left[\frac{2 + 2m + 2n + 2mn}{(n + m + 1)(n + m + 2)(n + m +3)}\right]
    -\\ \sum_{n=0}^{N} c_n\int_{0}^{1} x^{n + 1}(1 - x) f(x) dx
\end{align*}
</div>
<p>en donde, en general, necesitamos realizar una integración numérica para el
segundo término.</p>
<p>Minimizando el funcional</p>
<div class="math">
\begin{equation*}
\frac{\partial \Pi[\hat{u}]}{\partial c_m} = 0\, ,
\end{equation*}
</div>
<p>obtenmos el siguiente sistema de ecuaciones</p>
<div class="math">
\begin{equation*}
[K]\{\mathbf{c}\} = \{\mathbf{b}\}
\end{equation*}
</div>
<p>con</p>
<div class="math">
\begin{equation*}
K_{mn} = \frac{2 + 2m + 2n + 2mn}{(n + m + 1)(n + m + 2)(n + m +3)}
\end{equation*}
</div>
<p>y</p>
<div class="math">
\begin{equation*}
b_m = -\int_{0}^{1} x^{m + 1}(1 - x) f(x) dx\, .
\end{equation*}
</div>
<p>Probaremos la implementación con la función <span class="math">\(f(x) = x^3\)</span>, que
lleva a la solución</p>
<div class="math">
\begin{equation*}
u(x) = \frac{x (x^4 - 1)}{20}
\end{equation*}
</div>
<p>A continuación se presenta el código.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-3"></a><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-4"></a><span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">solve</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-5"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-6"></a>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-7"></a>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-8"></a><span class="k">def</span> <span class="nf">ritz</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-9"></a>    <span class="n">stiff_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-10"></a>    <span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">))</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-11"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-12"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-13"></a>            <span class="n">numer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">col</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">row</span><span class="o">*</span><span class="n">col</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-14"></a>            <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-15"></a>            <span class="n">stiff_mat</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="o">/</span><span class="n">denom</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-16"></a>        <span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">source</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-17"></a>        <span class="n">rhs</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-18"></a>    <span class="k">return</span> <span class="n">stiff_mat</span><span class="p">,</span> <span class="n">rhs</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-19"></a>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-20"></a>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-21"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-22"></a><span class="n">source</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-23"></a><span class="n">mat</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">ritz</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-24"></a><span class="n">c</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="o">-</span><span class="n">rhs</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-25"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-26"></a><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-27"></a><span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-28"></a>    <span class="n">y</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-29"></a>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-30"></a><span class="c1">#%% Plotting</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-31"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-32"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-33"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-34"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-35"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$y$"</span><span class="p">)</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-36"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Ritz solution"</span><span class="p">,</span> <span class="s2">"Exact solution"</span><span class="p">])</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-37"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a name="rest_code_2b1805c90ddc4574a4e1db754007fa78-38"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_9b4145c8ec414848997c64560d88b825-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-2"></a>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-3"></a>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-4"></a><span class="k">function</span> <span class="n">ritz</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-5"></a>    <span class="n">stiff_mat</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-6"></a>    <span class="n">rhs</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-7"></a>    <span class="k">for</span> <span class="n">row</span> <span class="kp">in</span> <span class="mi">0</span><span class="o">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-8"></a>        <span class="k">for</span> <span class="n">col</span> <span class="kp">in</span> <span class="mi">0</span><span class="o">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-9"></a>            <span class="n">numer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">col</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">row</span><span class="o">*</span><span class="n">col</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-10"></a>            <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-11"></a>            <span class="n">stiff_mat</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="o">/</span><span class="n">denom</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-12"></a>        <span class="k">end</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-13"></a>        <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">source</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-14"></a>        <span class="n">rhs</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">_</span>  <span class="o">=</span> <span class="n">quadgk</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-15"></a>    <span class="k">end</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-16"></a>    <span class="k">return</span> <span class="n">stiff_mat</span><span class="p">,</span> <span class="n">rhs</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-17"></a><span class="k">end</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-18"></a>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-19"></a>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-20"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-21"></a><span class="n">source</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">3</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-22"></a><span class="n">mat</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">ritz</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-23"></a><span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">mat</span><span class="o">\</span><span class="n">rhs</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-24"></a><span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-25"></a><span class="n">y</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-26"></a><span class="k">for</span> <span class="n">cont</span> <span class="kp">in</span> <span class="mi">0</span><span class="o">:</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-27"></a>    <span class="n">y</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">.^</span><span class="p">(</span><span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-28"></a><span class="k">end</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-29"></a>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-30"></a><span class="c">#%% Plotting</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-31"></a><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-32"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-33"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">.*</span><span class="p">(</span><span class="n">x</span><span class="o">.^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">"dashed"</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-34"></a><span class="n">xlabel</span><span class="p">(</span><span class="n">L</span><span class="s">"</span><span class="si">$x</span><span class="s">$"</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-35"></a><span class="n">ylabel</span><span class="p">(</span><span class="n">L</span><span class="s">"</span><span class="si">$y</span><span class="s">$"</span><span class="p">)</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-36"></a><span class="n">legend</span><span class="p">([</span><span class="s">"Ritz solution"</span><span class="p">,</span> <span class="s">"Exact solution"</span><span class="p">])</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-37"></a><span class="n">tight_layout</span><span class="p">()</span>
<a name="rest_code_9b4145c8ec414848997c64560d88b825-38"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>Ambos tiene (casi) el mismo resultado y se muestra a continuación</p>
<img alt="Método de Ritz usando 2 términos." class="align-center" src="../images/ritz.svg" style="width: 400px;"><p>Y si consideramos 3 términos en la expansion, obtenemos</p>
<img alt="Método de Ritz usando 3 términos." class="align-center" src="../images/ritz-N-3.svg" style="width: 400px;">
</div>
<div class="section" id="comparacion-python-julia">
<h3>Comparación Python/Julia</h3>
<p>Respecto al número de líneas tenemos: 38 en Python y 38 en Julia.  La comparación
en tiempo de ejecución se realizó con el comando mágico de IPython <code class="docutils literal">%timeit</code>
y con <code class="docutils literal">@benchmark</code> en Julia.</p>
<p>Para Python:</p>
<pre class="code IPython"><a name="rest_code_7739d0996479472196caca3693517888-1"></a><span class="o">%%time</span>it
<a name="rest_code_7739d0996479472196caca3693517888-2"></a><span class="n">mat</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">ritz</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_7739d0996479472196caca3693517888-3"></a><span class="n">c</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="o">-</span><span class="n">rhs</span><span class="p">)</span>
</pre>
<p>con resultado</p>
<pre class="code text"><a name="rest_code_6e341ff56abd412a98677b534722f624-1"></a>1000 loops, best of 3: 228 µs per loop
</pre>
<p>Para Julia:</p>
<pre class="code julia"><a name="rest_code_6785df6e750a4def80e51a0bae5f935a-1"></a><span class="k">function</span> <span class="n">bench</span><span class="p">()</span>
<a name="rest_code_6785df6e750a4def80e51a0bae5f935a-2"></a>   <span class="n">mat</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">ritz</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<a name="rest_code_6785df6e750a4def80e51a0bae5f935a-3"></a>   <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">mat</span><span class="o">\</span><span class="n">rhs</span>
<a name="rest_code_6785df6e750a4def80e51a0bae5f935a-4"></a><span class="k">end</span>
<a name="rest_code_6785df6e750a4def80e51a0bae5f935a-5"></a><span class="nd">@benchmark</span> <span class="n">bench</span><span class="p">()</span>
</pre>
<p>con resultado</p>
<pre class="code julia"><a name="rest_code_9953c963455f420ab2a702e39714a6e6-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">6.56</span> <span class="n">KiB</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">340</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-4"></a>  <span class="o">--------------</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">13.527</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">15.927</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">17.133</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">4.50</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">2.807</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">97.36</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-9"></a>  <span class="o">--------------</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_9953c963455f420ab2a702e39714a6e6-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>En este caso, podemos decir que el código de Python es alrededor de 14 veces
más lento que el de Julia.</p>
</div>
</div>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-5.html" rel="prev">Publicaciones posteriores</a>
            </li>
            <li class="next">
                <a href="index-3.html" rel="next">Publicaciones anteriores</a>
            </li>
        </ul></nav><script>var disqus_shortname="nicoguaro-github";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script><footer id="footer"><p>Contents © 2021 <a href="mailto:nicoguarin@gmail.com">Nicolás Guarín-Zapata</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a></p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145359674-1', 'auto');
ga('send', 'pageview');
</script><script src="../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("es");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
