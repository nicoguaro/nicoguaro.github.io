<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Personal blog and website">
<meta name="viewport" content="width=device-width">
<title>Nicolás' blog (old posts, page 2) | Nicolás' blog</title>
<link href="assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" href="es/rss.xml">
<link rel="canonical" href="https://nicoguaro.github.io/index-2.html">
<link rel="prev" href="index-3.html" type="text/html">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>A reserved <a href="https://getnikola.com" target="_blank">Nikola</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a> for Jekyll,
            ported to Nikola by <a href="https://twitter.com/ralsina" target="_blank">@ralsina</a>.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="pages/about/">About</a>
        <a class="sidebar-nav-item" href="index.html">Blog</a>
        <a class="sidebar-nav-item" href="pages/preprints-archive/">Preprints</a>
        <a class="sidebar-nav-item" href="pages/links/">Links</a>
        <a class="sidebar-nav-item" href="archive.html">Archive</a>
        <a class="sidebar-nav-item" href="categories/">Tags</a>
        <a class="sidebar-nav-item" href="rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://nicoguaro.github.io/" title="Nicolás' blog" rel="home">Nicolás' blog</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        

<div class="posts">
    <article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-12/" class="u-url">Numerical methods challenge: Day 12</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-12/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-12T15:06:10-05:00" title="2017-10-12 15:06">2017-10-12 15:06</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-12/#disqus_thread" data-disqus-identifier="cache/posts/numerical-12.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="hermite-interpolation-inverting-vandermonde-matrix">
<h2>Hermite interpolation: Inverting Vandermonde matrix</h2>
<p>Today we are comparing <a class="reference external" href="posts/numerical-12/posts/numerical-11">Lagrange interpolation</a> with
<a class="reference external" href="https://en.wikipedia.org/wiki/Hermite_interpolation">Hermite interpolation</a>.
For this example we are using the
<a class="reference external" href="https://en.wikipedia.org/wiki/Vandermonde_matrix">confluent Vandermonde matrix</a>
<span class="math">\(V\)</span>. The code is based on an <em>old</em> code of mine that is present
in this <a class="reference external" href="https://github.com/nicoguaro/FEM_resources/terpolation/interp.py">repo</a>.</p>
<p>As in the case of Lagrange interpolation we solve the system</p>
<div class="math">
\begin{equation*}
V\mathbf{c} = I
\end{equation*}
</div>
<p>where <span class="math">\(\mathbf{c}\)</span> is the vector of coefficients and <span class="math">\(I\)</span> is
the identity matrix. This method is not stable and should not be used for the computation of higher order
interpolants, even for optimally chosed sampling. It will start failing
around 20 points. A better approach is to use the
<a class="reference external" href="https://en.wikipedia.org/wiki/Lagrange_polynomial#Barycentric_form">barycentric form</a>
of the interpolation.</p>
<p>In the example below we use
<a class="reference external" href="https://en.wikipedia.org/wiki/Chebyshev_nodes">Chebyshev nodes</a>.
The nodes are given by</p>
<div class="math">
\begin{equation*}
x_k = \cos\left(\frac{2k-1}{2n}\pi\right), \quad k = 1, \ldots, n
\end{equation*}
</div>
<p>where <span class="math">\(n\)</span> is the degree of the polynomial.</p>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_c1dd9e07acb64a269c94080617392b2e-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-4"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-5"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-6"></a><span class="k">def</span> <span class="nf">vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-7"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-8"></a>    <span class="n">van</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-9"></a>    <span class="n">power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-10"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-11"></a>        <span class="n">van</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">**</span><span class="n">power</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-12"></a>    <span class="k">return</span> <span class="n">van</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-13"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-14"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-15"></a><span class="k">def</span> <span class="nf">conf_vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-16"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-17"></a>    <span class="n">conf_van</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-18"></a>    <span class="n">power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-19"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-20"></a>        <span class="n">conf_van</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">**</span><span class="n">power</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-21"></a>        <span class="n">conf_van</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">power</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="n">power</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-22"></a>    <span class="k">return</span> <span class="n">conf_van</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-23"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-24"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-25"></a><span class="k">def</span> <span class="nf">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inter_type</span><span class="o">=</span><span class="s2">"lagrange"</span><span class="p">):</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-26"></a>    <span class="k">if</span> <span class="n">inter_type</span> <span class="o">==</span> <span class="s2">"lagrange"</span><span class="p">:</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-27"></a>        <span class="n">vand_mat</span> <span class="o">=</span> <span class="n">vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-28"></a>    <span class="k">elif</span> <span class="n">inter_type</span> <span class="o">==</span> <span class="s2">"hermite"</span><span class="p">:</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-29"></a>        <span class="n">vand_mat</span> <span class="o">=</span> <span class="n">conf_vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-30"></a>    <span class="n">coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">vand_mat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">vand_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-31"></a>    <span class="k">return</span> <span class="n">coef</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-32"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-33"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-34"></a><span class="k">def</span> <span class="nf">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-35"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-36"></a>    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-37"></a>        <span class="n">coef</span> <span class="o">=</span> <span class="n">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inter_type</span><span class="o">=</span><span class="s2">"lagrange"</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-38"></a>    <span class="k">else</span><span class="p">:</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-39"></a>        <span class="n">coef</span> <span class="o">=</span> <span class="n">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inter_type</span><span class="o">=</span><span class="s2">"hermite"</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-40"></a>    <span class="n">f_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-41"></a>    <span class="n">nmat</span> <span class="o">=</span> <span class="n">coef</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-42"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmat</span><span class="p">):</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-43"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmat</span><span class="p">):</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-44"></a>            <span class="k">if</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="ow">or</span> <span class="n">nmat</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-45"></a>                <span class="n">f_eval</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">*</span><span class="n">x_eval</span><span class="o">**</span><span class="n">row</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-46"></a>            <span class="k">else</span><span class="p">:</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-47"></a>                <span class="n">f_eval</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">*</span><span class="n">x_eval</span><span class="o">**</span><span class="n">row</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="n">col</span> <span class="o">-</span> <span class="n">n</span><span class="p">]</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-48"></a>    <span class="k">return</span> <span class="n">f_eval</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-49"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-50"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-51"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-52"></a>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-53"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">7</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-54"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-55"></a><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-56"></a><span class="n">df</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-57"></a><span class="n">x_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-58"></a><span class="n">interp_f</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x_eval</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-59"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_eval</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x_eval</span><span class="p">))</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-60"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_eval</span><span class="p">,</span> <span class="n">interp_f</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-61"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">"."</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-62"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
<a name="rest_code_c1dd9e07acb64a269c94080617392b2e-63"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_cb4af7c256d84178824e4392e626cc1f-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-2"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-3"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-4"></a><span class="k">function</span> <span class="n">vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-5"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-6"></a>    <span class="n">van</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-7"></a>    <span class="n">power</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-8"></a>    <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-9"></a>        <span class="n">van</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.^</span><span class="n">power</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-10"></a>    <span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-11"></a>    <span class="k">return</span> <span class="n">van</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-12"></a><span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-13"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-14"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-15"></a><span class="k">function</span> <span class="n">conf_vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-16"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-17"></a>    <span class="n">conf_van</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-18"></a>    <span class="n">power</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-19"></a>    <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-20"></a>        <span class="n">conf_van</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.^</span><span class="n">power</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-21"></a>        <span class="n">conf_van</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span><span class="o">.*</span><span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.^</span><span class="p">(</span><span class="n">power</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-22"></a>    <span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-23"></a>    <span class="k">return</span> <span class="n">conf_van</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-24"></a><span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-25"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-26"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-27"></a><span class="k">function</span> <span class="n">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">;</span> <span class="n">inter_type</span><span class="o">=</span><span class="s">"lagrange"</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-28"></a>    <span class="k">if</span> <span class="n">inter_type</span> <span class="o">==</span> <span class="s">"lagrange"</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-29"></a>        <span class="n">vand_mat</span> <span class="o">=</span> <span class="n">vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-30"></a>    <span class="k">elseif</span> <span class="n">inter_type</span> <span class="o">==</span> <span class="s">"hermite"</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-31"></a>        <span class="n">vand_mat</span> <span class="o">=</span> <span class="n">conf_vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-32"></a>    <span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-33"></a>    <span class="n">coef</span> <span class="o">=</span> <span class="n">vand_mat</span> <span class="o">\</span> <span class="n">eye</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">vand_mat</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-34"></a>    <span class="k">return</span> <span class="n">coef</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-35"></a><span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-36"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-37"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-38"></a><span class="k">function</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">;</span> <span class="n">df</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-39"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-40"></a>    <span class="k">if</span> <span class="n">df</span> <span class="o">==</span> <span class="nb">nothing</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-41"></a>        <span class="n">coef</span> <span class="o">=</span> <span class="n">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inter_type</span><span class="o">=</span><span class="s">"lagrange"</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-42"></a>    <span class="k">else</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-43"></a>        <span class="n">coef</span> <span class="o">=</span> <span class="n">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inter_type</span><span class="o">=</span><span class="s">"hermite"</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-44"></a>    <span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-45"></a>    <span class="n">f_eval</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-46"></a>    <span class="n">nmat</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">coef</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-47"></a>    <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">nmat</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-48"></a>        <span class="k">for</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">nmat</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-49"></a>            <span class="k">if</span> <span class="n">col</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">||</span> <span class="n">nmat</span> <span class="o">==</span> <span class="n">n</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-50"></a>                <span class="n">f_eval</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">*</span><span class="n">x_eval</span><span class="o">.^</span><span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-51"></a>            <span class="k">else</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-52"></a>                <span class="n">f_eval</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">*</span><span class="n">x_eval</span><span class="o">.^</span><span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="n">col</span> <span class="o">-</span> <span class="n">n</span><span class="p">]</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-53"></a>            <span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-54"></a>        <span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-55"></a>    <span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-56"></a>    <span class="k">return</span> <span class="n">f_eval</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-57"></a><span class="k">end</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-58"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-59"></a>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-60"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">7</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-61"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">cos</span><span class="o">.</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-62"></a><span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-63"></a><span class="n">df</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">x</span><span class="o">./</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-64"></a><span class="n">x_eval</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-65"></a><span class="n">interp_f</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-66"></a><span class="n">plot</span><span class="p">(</span><span class="n">x_eval</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x_eval</span><span class="o">.^</span><span class="mi">2</span><span class="p">))</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-67"></a><span class="n">plot</span><span class="p">(</span><span class="n">x_eval</span><span class="p">,</span> <span class="n">interp_f</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-68"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s">"."</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-69"></a><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
<a name="rest_code_cb4af7c256d84178824e4392e626cc1f-70"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>In both cases the result is the plot below.</p>
<img alt="Hermite interpolation using Vandermonde matrix." class="align-center" src="images/hermite_vandermonde.svg" style="width: 500px;"><p>And, if we try with a high <span class="math">\(n\)</span>, say <span class="math">\(n=43\)</span>, we can see the
problems.</p>
<img alt="Hermite interpolation using Vandermonde matrix." class="align-center" src="images/hermite_vandermonde-n-23.svg" style="width: 500px;">
</div>
<div class="section" id="comparison-python-julia">
<h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 61 in Python and 70 in Julia. The comparison
in execution time is done with <code class="docutils literal">%%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_83b41ad0ad40422f987a0a09bec01ca4-1"></a><span class="o">%%time</span>it -n 100
<a name="rest_code_83b41ad0ad40422f987a0a09bec01ca4-2"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">7</span>
<a name="rest_code_83b41ad0ad40422f987a0a09bec01ca4-3"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_83b41ad0ad40422f987a0a09bec01ca4-4"></a><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_83b41ad0ad40422f987a0a09bec01ca4-5"></a><span class="n">df</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_83b41ad0ad40422f987a0a09bec01ca4-6"></a><span class="n">x_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_83b41ad0ad40422f987a0a09bec01ca4-7"></a><span class="n">interp_f</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x_eval</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code text"><a name="rest_code_6cbb22ed15c34db5a0f2ebd89f9b049f-1"></a>100 loops, best of 3: 18.1 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-1"></a><span class="k">function</span> <span class="n">bench</span><span class="p">()</span>
<a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-2"></a>   <span class="n">n</span> <span class="o">=</span> <span class="mi">7</span>
<a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-3"></a>   <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">cos</span><span class="o">.</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-4"></a>   <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-5"></a>   <span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">x</span><span class="o">./</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span>
<a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-6"></a>   <span class="n">x_eval</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-7"></a>   <span class="n">interp_f</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x_eval</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-8"></a><span class="k">end</span>
<a name="rest_code_e1faef57cc1c40debb1dfeb1503f85af-9"></a><span class="nd">@benchmark</span> <span class="n">bench</span><span class="p">()</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">3.13</span> <span class="n">MiB</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">836</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-4"></a>  <span class="o">--------------</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">10.318</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">10.449</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">11.362</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">1.74</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">26.646</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-9"></a>  <span class="o">--------------</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">100</span>
<a name="rest_code_dbb61e0f7818404a8f967a1fe88a4935-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly as fast as
the Julia one.</p>
</div>
<div class="section" id="comparison-hermite-lagrange-interpolation">
<h3>Comparison Hermite/Lagrange interpolation</h3>
<p>We want to compare Hermite interpolation with Lagrange interpolation for
the same number of degrees of freedom. We use the same function for test
purposes</p>
<div class="math">
\begin{equation*}
f(x) = \frac{1}{1 + 25x^2}
\end{equation*}
</div>
<p>This is the Python code that does that part</p>
<pre class="code Python"><a name="rest_code_f64ffade3d144a1488ebe72c4855df43-1"></a><span class="n">n_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-2"></a><span class="n">error_herm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-3"></a><span class="n">error_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-4"></a><span class="k">for</span> <span class="n">cont</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_dof</span><span class="p">):</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-5"></a>    <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-6"></a>    <span class="n">df</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-7"></a>    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-8"></a>    <span class="n">x2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-9"></a>    <span class="n">x_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-10"></a>    <span class="n">herm</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x_eval</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-11"></a>    <span class="n">lag</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-12"></a>    <span class="n">fun</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-13"></a>    <span class="n">error_herm</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fun</span> <span class="o">-</span> <span class="n">herm</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-14"></a>    <span class="n">error_lag</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fun</span> <span class="o">-</span> <span class="n">lag</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-15"></a>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-16"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_dof</span><span class="p">,</span> <span class="n">error_lag</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-17"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_dof</span><span class="p">,</span> <span class="n">error_herm</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Number of degrees of freedom"</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Relative error"</span><span class="p">)</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-20"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Lagrange"</span><span class="p">,</span> <span class="s2">"Hermite"</span><span class="p">])</span>
<a name="rest_code_f64ffade3d144a1488ebe72c4855df43-21"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
<p>And this is the comparison of the relative errors</p>
<img alt="Comparison of errors between Lagrange and Hermite interpolation." class="align-center" src="images/hermite_lagrange_error.svg" style="width: 500px;"><p>In general, the Lagrange approximation is closer for this function.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-11/" class="u-url">Numerical methods challenge: Day 11</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-11/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-11T12:25:10-05:00" title="2017-10-11 12:25">2017-10-11 12:25</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-11/#disqus_thread" data-disqus-identifier="cache/posts/numerical-11.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="lagrange-interpolation-inverting-vandermonde-matrix">
<h2>Lagrange interpolation: Inverting Vandermonde matrix</h2>
<p>Today we have
<a class="reference external" href="https://en.wikipedia.org/wiki/Lagrange_polynomial">Lagrange interpolation</a>,
yet one more time. I will have a different approach to compute the
interpolation; I will form the <a class="reference external" href="https://en.wikipedia.org/wiki/Vandermonde_matrix">Vandermonde matrix</a> <span class="math">\(V\)</span> and solve the system</p>
<div class="math">
\begin{equation*}
V\mathbf{c} = I
\end{equation*}
</div>
<p>where <span class="math">\(\mathbf{c}\)</span> is the vector of coefficients and <span class="math">\(I\)</span> is
the identity matrix. This method, and the <a class="reference external" href="posts/numerical-11/posts/numerical-09/">previous one</a>
are not stable and should not be used for the computation of higher order
interpolants, even for optimally chosed sampling. It will start failing
around 40 points. A better approach is to use the
<a class="reference external" href="https://en.wikipedia.org/wiki/Lagrange_polynomial#Barycentric_form">barycentric form</a>
of the interpolation.</p>
<p>In the example below we use
<a class="reference external" href="https://en.wikipedia.org/wiki/Chebyshev_nodes">Chebyshev nodes</a>.
The nodes are given by</p>
<div class="math">
\begin{equation*}
x_k = \cos\left(\frac{2k-1}{2n}\pi\right), \quad k = 1, \ldots, n
\end{equation*}
</div>
<p>where <span class="math">\(n\)</span> is the degree of the polynomial.</p>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_8e2bd7ff11824ee283eea7656211207c-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-4"></a>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-5"></a>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-6"></a><span class="k">def</span> <span class="nf">vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-7"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-8"></a>    <span class="n">van</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-9"></a>    <span class="n">power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-10"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-11"></a>        <span class="n">van</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">**</span><span class="n">power</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-12"></a>    <span class="k">return</span> <span class="n">van</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-13"></a>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-14"></a>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-15"></a><span class="k">def</span> <span class="nf">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-16"></a>    <span class="n">vand_mat</span> <span class="o">=</span> <span class="n">vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-17"></a>    <span class="n">coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">vand_mat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-18"></a>    <span class="k">return</span> <span class="n">coef</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-19"></a>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-20"></a>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-21"></a><span class="k">def</span> <span class="nf">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">):</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-22"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-23"></a>    <span class="n">coef</span> <span class="o">=</span> <span class="n">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-24"></a>    <span class="n">f_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-25"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-26"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-27"></a>            <span class="n">f_eval</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">*</span><span class="n">x_eval</span><span class="o">**</span><span class="n">row</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-28"></a>    <span class="k">return</span> <span class="n">f_eval</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-29"></a>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-30"></a>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-31"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">11</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-32"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-33"></a><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-34"></a><span class="n">x_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-35"></a><span class="n">interp_f</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-36"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-37"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_eval</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x_eval</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-38"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_eval</span><span class="p">,</span> <span class="n">interp_f</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-39"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s2">"."</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-40"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
<a name="rest_code_8e2bd7ff11824ee283eea7656211207c-41"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-2"></a>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-3"></a>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-4"></a><span class="k">function</span> <span class="n">vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-5"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-6"></a>    <span class="n">van</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-7"></a>    <span class="n">power</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-8"></a>    <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-9"></a>        <span class="n">van</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.^</span><span class="n">power</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-10"></a>    <span class="k">end</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-11"></a>    <span class="k">return</span> <span class="n">van</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-12"></a><span class="k">end</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-13"></a>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-14"></a>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-15"></a><span class="k">function</span> <span class="n">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-16"></a>    <span class="n">vand_mat</span> <span class="o">=</span> <span class="n">vander_mat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-17"></a>    <span class="n">coef</span> <span class="o">=</span> <span class="n">vand_mat</span> <span class="o">\</span> <span class="n">eye</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-18"></a>    <span class="k">return</span> <span class="n">coef</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-19"></a><span class="k">end</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-20"></a>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-21"></a>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-22"></a><span class="k">function</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-23"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-24"></a>    <span class="n">coef</span> <span class="o">=</span> <span class="n">inter_coef</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-25"></a>    <span class="n">f_eval</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-26"></a>    <span class="k">for</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-27"></a>        <span class="k">for</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-28"></a>            <span class="n">f_eval</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">*</span><span class="n">x_eval</span><span class="o">.^</span><span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-29"></a>        <span class="k">end</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-30"></a>    <span class="k">end</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-31"></a>    <span class="k">return</span> <span class="n">f_eval</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-32"></a><span class="k">end</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-33"></a>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-34"></a>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-35"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">11</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-36"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span> <span class="n">cos</span><span class="o">.</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-37"></a><span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-38"></a><span class="n">x_eval</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-39"></a><span class="n">interp_f</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-40"></a><span class="n">plot</span><span class="p">(</span><span class="n">x_eval</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x_eval</span><span class="o">.^</span><span class="mi">2</span><span class="p">))</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-41"></a><span class="n">plot</span><span class="p">(</span><span class="n">x_eval</span><span class="p">,</span> <span class="n">interp_f</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-42"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s">"."</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-43"></a><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
<a name="rest_code_bd80f5170cfd4caf8af6d76f27f65c7a-44"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>In both cases the result is the plot below.</p>
<img alt="Lagrange interpolation using Vandermonde matrix." class="align-center" src="images/lagrange_vandermonde.svg" style="width: 500px;"><p>And, if we try with a high <span class="math">\(n\)</span>, say <span class="math">\(n=45\)</span>, we can see the
problems.</p>
<img alt="Lagrange interpolation using Vandermonde matrix." class="align-center" src="images/lagrange_vandermonde-n-45.svg" style="width: 500px;">
</div>
<div class="section" id="comparison-python-julia">
<h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 41 in Python and 44 in Julia. The comparison
in execution time is done with <code class="docutils literal">%%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_f352582c5c104f8d82b95e7a24cd7e51-1"></a><span class="o">%%time</span>it -n 100
<a name="rest_code_f352582c5c104f8d82b95e7a24cd7e51-2"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">11</span>
<a name="rest_code_f352582c5c104f8d82b95e7a24cd7e51-3"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_f352582c5c104f8d82b95e7a24cd7e51-4"></a><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_f352582c5c104f8d82b95e7a24cd7e51-5"></a><span class="n">x_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_f352582c5c104f8d82b95e7a24cd7e51-6"></a><span class="n">interp_f</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code text"><a name="rest_code_9a90ec17aff9479c98d4b721173c890b-1"></a>100 loops, best of 3: 7.86 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_0433c2768795405cb3be992b25251328-1"></a><span class="k">function</span> <span class="n">bench</span><span class="p">()</span>
<a name="rest_code_0433c2768795405cb3be992b25251328-2"></a>   <span class="n">x</span> <span class="o">=</span> <span class="o">-</span> <span class="n">cos</span><span class="o">.</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a name="rest_code_0433c2768795405cb3be992b25251328-3"></a>   <span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_0433c2768795405cb3be992b25251328-4"></a>   <span class="n">x_eval</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<a name="rest_code_0433c2768795405cb3be992b25251328-5"></a>   <span class="n">interp_f</span> <span class="o">=</span> <span class="n">compute_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x_eval</span><span class="p">)</span>
<a name="rest_code_0433c2768795405cb3be992b25251328-6"></a>   <span class="k">return</span> <span class="nb">nothing</span>
<a name="rest_code_0433c2768795405cb3be992b25251328-7"></a><span class="k">end</span>
<a name="rest_code_0433c2768795405cb3be992b25251328-8"></a><span class="nd">@benchmark</span> <span class="n">bench</span><span class="p">()</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_5e750fa6d09548bbb782052709e9afe3-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">32.23</span> <span class="n">MiB</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">8277</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-4"></a>  <span class="o">--------------</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">114.282</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">1.50</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">122.061</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">1.46</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">129.733</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">1.90</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">163.716</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">1.98</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-9"></a>  <span class="o">--------------</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">39</span>
<a name="rest_code_5e750fa6d09548bbb782052709e9afe3-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 16 times faster
than the Julia one.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-10/" class="u-url">Numerical methods challenge: Day 10</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-10/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-10T21:16:26-05:00" title="2017-10-10 21:16">2017-10-10 21:16</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-10/#disqus_thread" data-disqus-identifier="cache/posts/numerical-10.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="lagrange-interpolation-runge-phenomenon">
<h2>Lagrange interpolation: Runge phenomenon</h2>
<p>Today we have
<a class="reference external" href="https://en.wikipedia.org/wiki/Lagrange_polynomial">Lagrange interpolation</a>,
again. Technically, I am not posting about a different method, but just
using the <a class="reference external" href="posts/numerical-09/">same algorithm for interpolation</a>.
The difference is that I will change the sampling, that is, I will use
non-uniform sampling.</p>
<p>The problem with uniform interpolation is known as
<a class="reference external" href="https://en.wikipedia.org/wiki/Runge%27s_phenomenon">Runge phenomenon</a>
and is illustrated in the following image.</p>
<img alt="Runge phenomenon." class="align-center" src="images/runge_phenomenon.svg" style="width: 500px;"><p>One way to mitigate the problem is to use non-uniform sampling, such as
<a class="reference external" href="https://en.wikipedia.org/wiki/Chebyshev_nodes">Chebyshev nodes</a> or
<a class="reference external" href="https://en.wikipedia.org/wiki/Gaussian_quadrature#Gauss.E2.80.93Lobatto_rules">Lobatto nodes</a>. The former set minimizes
the Runge phenomenon, while the latter maximizes the
<a class="reference external" href="https://en.wikipedia.org/wiki/Vandermonde_matrix">Vandermonde determinant</a>.</p>
<p>In the example below we use Lobatto sampling. Lobatto nodes are the zeros of</p>
<div class="math">
\begin{equation*}
(1 - x^2) P'_N(x)
\end{equation*}
</div>
<p>where <span class="math">\(P_N\)</span> refers to the Nth Legendre polynomial. The use of these
nodes is useful in numerical integration and spectral methods. Finding the
zeroes of these polynomials might be cumbersome in general. Nevertheless,
we use an approach originally implemented in
<a class="reference external" href="http://www.mathworks.com/matlabcentral/fileexchange/4775-legende-gauss-lobatto-nodes-and-weights">MATLAB by Greg von Winckel</a> that use Chebyshev nodes
as first guess and then update this guess using Newton-Raphson method.</p>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="p">(</span><span class="n">zeros_like</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">amax</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-3"></a>                   <span class="n">array</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">prod</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-5"></a>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-6"></a>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-7"></a><span class="k">def</span> <span class="nf">lagrange</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">,</span> <span class="n">x_new</span><span class="p">):</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-8"></a>    <span class="n">y_new</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-9"></a>    <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">):</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-10"></a>        <span class="n">y_new</span> <span class="o">+=</span> <span class="n">yi</span><span class="o">*</span><span class="n">prod</span><span class="p">([(</span><span class="n">x_new</span> <span class="o">-</span> <span class="n">xj</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="n">xj</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-11"></a>                         <span class="k">for</span> <span class="n">xj</span> <span class="ow">in</span> <span class="n">x_int</span> <span class="k">if</span> <span class="n">xi</span><span class="o">!=</span><span class="n">xj</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-12"></a>    <span class="k">return</span> <span class="n">y_new</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-13"></a>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-14"></a>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-15"></a><span class="k">def</span> <span class="nf">gauss_lobatto</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">):</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-16"></a>    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-17"></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>  <span class="c1"># Vandermonde Matrix</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-18"></a>    <span class="n">x_old</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-19"></a>    <span class="k">while</span> <span class="n">amax</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_old</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-20"></a>        <span class="n">x_old</span> <span class="o">=</span> <span class="n">x</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-21"></a>        <span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-22"></a>        <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-23"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-24"></a>            <span class="n">P</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">P</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-25"></a>                       <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">k</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-26"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x_old</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">P</span><span class="p">[:,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[:,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">P</span><span class="p">[:,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-27"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-28"></a>    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-29"></a>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-30"></a>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-31"></a><span class="n">runge</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-32"></a><span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-33"></a><span class="n">x_int</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-34"></a><span class="n">x_int2</span> <span class="o">=</span> <span class="n">gauss_lobatto</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-35"></a><span class="n">x_new</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-36"></a><span class="n">y_new</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">x_int</span><span class="p">),</span> <span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-37"></a><span class="n">y_new2</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x_int2</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">x_int2</span><span class="p">),</span> <span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-38"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">"k"</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-39"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-40"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new2</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-41"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Runge function"</span><span class="p">,</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-42"></a>            <span class="s2">"Uniform interpolation"</span><span class="p">,</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-43"></a>            <span class="s2">"Lobatto-sampling interpolation"</span><span class="p">])</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-44"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"x"</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-45"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"y"</span><span class="p">)</span>
<a name="rest_code_a51379c510a44f8d8f3eb171c6d5ec66-46"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_0261dc472f10463a886ca8c7db977686-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-2"></a>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-3"></a>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-4"></a><span class="k">function</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">,</span> <span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-5"></a>    <span class="n">y_new</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-6"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span> <span class="kp">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-7"></a>        <span class="n">prod</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-8"></a>        <span class="k">for</span> <span class="n">xj</span> <span class="kp">in</span> <span class="n">x_int</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-9"></a>            <span class="k">if</span> <span class="n">xi</span> <span class="o">!=</span> <span class="n">xj</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-10"></a>                <span class="n">prod</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.*</span> <span class="p">(</span><span class="n">x_new</span> <span class="o">-</span> <span class="n">xj</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="n">xj</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-11"></a>            <span class="k">end</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-12"></a>        <span class="k">end</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-13"></a>        <span class="n">y_new</span> <span class="o">+=</span> <span class="n">yi</span><span class="o">*</span><span class="n">prod</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-14"></a>    <span class="k">end</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-15"></a>    <span class="k">return</span> <span class="n">y_new</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-16"></a><span class="k">end</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-17"></a>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-18"></a>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-19"></a><span class="k">function</span> <span class="n">gauss_lobatto</span><span class="p">(</span><span class="n">N</span><span class="p">;</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-20"></a>    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">cos</span><span class="o">.</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">pi</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-21"></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="c"># Vandermonde Matrix</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-22"></a>    <span class="n">x_old</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-23"></a>    <span class="k">while</span> <span class="n">maximum</span><span class="p">(</span><span class="n">abs</span><span class="o">.</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_old</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">tol</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-24"></a>        <span class="n">x_old</span> <span class="o">=</span> <span class="n">x</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-25"></a>        <span class="n">P</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-26"></a>        <span class="n">P</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-27"></a>        <span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">3</span><span class="o">:</span><span class="n">N</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-28"></a>            <span class="n">P</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">.*</span> <span class="n">P</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-29"></a>                       <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">k</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-30"></a>        <span class="k">end</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-31"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x_old</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">.*</span> <span class="n">P</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">N</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">./</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span> <span class="n">P</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-32"></a>    <span class="k">end</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-33"></a>    <span class="k">return</span> <span class="n">x</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-34"></a><span class="k">end</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-35"></a>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-36"></a>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-37"></a><span class="n">runge</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span>  <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-38"></a><span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-39"></a><span class="n">x_int</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-40"></a><span class="n">x_int2</span> <span class="o">=</span> <span class="n">gauss_lobatto</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-41"></a><span class="n">x_new</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-42"></a><span class="n">y_new</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">x_int</span><span class="p">),</span> <span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-43"></a><span class="n">y_new2</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x_int2</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">x_int2</span><span class="p">),</span> <span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-44"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s">"k"</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-45"></a><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-46"></a><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new2</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-47"></a><span class="n">legend</span><span class="p">([</span><span class="s">"Runge function"</span><span class="p">,</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-48"></a>            <span class="s">"Uniform interpolation"</span><span class="p">,</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-49"></a>            <span class="s">"Lobatto-sampling interpolation"</span><span class="p">])</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-50"></a><span class="n">xlabel</span><span class="p">(</span><span class="s">"x"</span><span class="p">)</span>
<a name="rest_code_0261dc472f10463a886ca8c7db977686-51"></a><span class="n">ylabel</span><span class="p">(</span><span class="s">"y"</span><span class="p">)</span>
</pre>
<p>In both cases the result is plot shown above.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-09/" class="u-url">Numerical methods challenge: Day 9</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-09/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-09T21:17:56-05:00" title="2017-10-09 21:17">2017-10-09 21:17</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-09/#disqus_thread" data-disqus-identifier="cache/posts/numerical-09.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="lagrange-interpolation">
<h2>Lagrange interpolation</h2>
<p>Today we have
<a class="reference external" href="https://en.wikipedia.org/wiki/Lagrange_polynomial">Lagrange interpolation</a>.
This is defined by</p>
<div class="math">
\begin{equation*}
L(x) = \sum_{j=0}^{k} y_j \prod_{m\neq j}\frac{x - x_m}{x_j - x_m}
\end{equation*}
</div>
<p>with <span class="math">\(x\)</span> the point/points where we want to interpolate.</p>
<p>We will test the method with a sigmoid</p>
<div class="math">
\begin{equation*}
f(x) = \frac{1}{1 + e^{-x}}
\end{equation*}
</div>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_083e7c07ae4345a58a750699c2f0da96-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros_like</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">prod</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-4"></a>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-5"></a>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-6"></a><span class="k">def</span> <span class="nf">lagrange</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">,</span> <span class="n">x_new</span><span class="p">):</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-7"></a>    <span class="n">y_new</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-8"></a>    <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">):</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-9"></a>        <span class="n">y_new</span> <span class="o">+=</span> <span class="n">yi</span><span class="o">*</span><span class="n">prod</span><span class="p">([(</span><span class="n">x_new</span> <span class="o">-</span> <span class="n">xj</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="n">xj</span><span class="p">)</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-10"></a>                         <span class="k">for</span> <span class="n">xj</span> <span class="ow">in</span> <span class="n">x_int</span> <span class="k">if</span> <span class="n">xi</span><span class="o">!=</span><span class="n">xj</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-11"></a>    <span class="k">return</span> <span class="n">y_new</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-12"></a>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-13"></a>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-14"></a><span class="n">x_int</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-15"></a><span class="n">y_int</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x_int</span><span class="p">))</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-16"></a><span class="n">x_new</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-17"></a><span class="n">y_new</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">,</span> <span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">,</span> <span class="s2">"ok"</span><span class="p">)</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
<a name="rest_code_083e7c07ae4345a58a750699c2f0da96-20"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-2"></a>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-3"></a><span class="k">function</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">,</span> <span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-4"></a>    <span class="n">y_new</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-5"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span> <span class="kp">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-6"></a>        <span class="n">prod</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-7"></a>        <span class="k">for</span> <span class="n">xj</span> <span class="kp">in</span> <span class="n">x_int</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-8"></a>            <span class="k">if</span> <span class="n">xi</span> <span class="o">!=</span> <span class="n">xj</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-9"></a>                <span class="n">prod</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.*</span> <span class="p">(</span><span class="n">x_new</span> <span class="o">-</span> <span class="n">xj</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="n">xj</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-10"></a>            <span class="k">end</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-11"></a>        <span class="k">end</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-12"></a>        <span class="n">y_new</span> <span class="o">+=</span> <span class="n">yi</span><span class="o">*</span><span class="n">prod</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-13"></a>    <span class="k">end</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-14"></a>    <span class="k">return</span> <span class="n">y_new</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-15"></a><span class="k">end</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-16"></a>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-17"></a>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-18"></a><span class="n">x_int</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-19"></a><span class="n">y_int</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="n">x_int</span><span class="p">))</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-20"></a><span class="n">x_new</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-21"></a><span class="n">y_new</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">,</span> <span class="n">x_new</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-22"></a><span class="n">plot</span><span class="p">(</span><span class="n">x_int</span><span class="p">,</span> <span class="n">y_int</span><span class="p">,</span> <span class="s">"ok"</span><span class="p">)</span>
<a name="rest_code_54bc054cbd4b4fcebea0a421f9f64557-23"></a><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
</pre>
<p>In both cases the result is the following plot.</p>
<img alt="Lagrange interpolation." class="align-center" src="images/lagrange_interp.svg" style="width: 400px;">
</div>
<div class="section" id="comparison-python-julia">
<h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 34 in Python and 37 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_ac8682e29f4a49348eb173003047343e-1"></a><span class="o">%</span><span class="k">timeit</span> lagrange(x_int, y_int, x_new)
</pre>
<p>with result</p>
<pre class="code text"><a name="rest_code_f55993f2c96046b4bbaa9356518c71dd-1"></a>1000 loops, best of 3: 1.55 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_4a4ef82be7fc4149b8ab51e978be6fdd-1"></a><span class="nd">@benchmark</span> <span class="n">newton_opt</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_grad</span><span class="p">,</span> <span class="n">rosen_hess</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">1.97</span> <span class="n">MiB</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">254</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-4"></a>  <span class="o">--------------</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">737.665</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">811.633</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">916.450</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">10.77</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">3.119</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">64.40</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-9"></a>  <span class="o">--------------</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">5433</span>
<a name="rest_code_dc667db96c024fbab1be7b4b974caa7b-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 2 times slower
than the Julia one, where probably I am not using the best approach for
Julia.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-08/" class="u-url">Numerical methods challenge: Day 8</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-08/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-09T16:15:50-05:00" title="2017-10-09 16:15">2017-10-09 16:15</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-08/#disqus_thread" data-disqus-identifier="cache/posts/numerical-08.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="newton-s-method-for-optimization">
<h2>Newton's method for optimization</h2>
<p>Today we have
<a class="reference external" href="https://en.wikipedia.org/wiki/Newton%27s_method_in_optimization">Newton's method</a>
for optimization. The main difference of this method with gradient descent
is the use of higher derivatives, namely, the Hessian matrix of the
objective function. The use of higher derivatives provides information of
the curvature besides the slope information used in gradient descent.
The following image compare the path for gradient descent (green) and
Newton's method (red).</p>
<img alt="Comparison of the path followed by gradient descent and Newton's method." class="align-center" src="https://upload.wikimedia.org/wikipedia/commons/d/da/Newton_optimization_vs_grad_descent.svg" style="width: 400px;"><p>Mathematically, the update is written as</p>
<div class="math">
\begin{equation*}
\mathbf{x}_k = \mathbf{x}_{k-1} -
    H(\mathbf{x}_k)^{-1} \nabla f(\mathbf{x_k})
\end{equation*}
</div>
<p>where <span class="math">\(H(\mathbf{x}_k)\)</span> is the Hessian matrix at step k.</p>
<p>We will test the method with the
<a class="reference external" href="https://en.wikipedia.org/wiki/Rosenbrock_function">Rosenbrock's function</a></p>
<div class="math">
\begin{equation*}
f(x_1, x_2) = (1-x_1)^2 + 100(x_2-{x_1}^2)^2
\end{equation*}
</div>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-3"></a><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span><span class="p">,</span> <span class="n">solve</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-4"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-5"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-6"></a><span class="k">def</span> <span class="nf">newton_opt</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">hess</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">gtol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-7"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Maximum number of iterations reached."</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-8"></a>    <span class="n">g</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-9"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-10"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-11"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"n: </span><span class="si">{}</span><span class="s2">, x: </span><span class="si">{}</span><span class="s2">, g: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-12"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">solve</span><span class="p">(</span><span class="n">hess</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">g</span><span class="p">)</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-13"></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-14"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">gtol</span><span class="p">:</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-15"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Extremum found with desired accuracy."</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-16"></a>            <span class="k">break</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-17"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">msg</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-18"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-19"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-20"></a><span class="k">def</span> <span class="nf">rosen</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-21"></a>    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-22"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-23"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-24"></a><span class="k">def</span> <span class="nf">rosen_grad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-25"></a>    <span class="k">return</span> <span class="n">array</span><span class="p">([</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-26"></a>        <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-27"></a>        <span class="mi">200</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)])</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-28"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-29"></a><span class="k">def</span> <span class="nf">rosen_hess</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-30"></a>    <span class="k">return</span> <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">800</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-31"></a>                 <span class="p">[</span><span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">200</span><span class="p">]])</span>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-32"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-33"></a>
<a name="rest_code_cfa5f19f5f6c49fbab4d264855079bc5-34"></a><span class="nb">print</span><span class="p">(</span><span class="n">newton_opt</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_grad</span><span class="p">,</span> <span class="n">rosen_hess</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code python"><a name="rest_code_8c291c7f5746440ab86a8c16af4ad5d2-1"></a><span class="n">n</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="mf">2402.</span>  <span class="o">-</span><span class="mf">600.</span><span class="p">]</span>
<a name="rest_code_8c291c7f5746440ab86a8c16af4ad5d2-2"></a><span class="n">n</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">1.99833611</span>  <span class="mf">3.99334443</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">1.99888520e+00</span>  <span class="o">-</span><span class="mf">5.53708323e-04</span><span class="p">]</span>
<a name="rest_code_8c291c7f5746440ab86a8c16af4ad5d2-3"></a><span class="n">n</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">1.00055248</span>  <span class="mf">0.0055331</span> <span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="mf">398.44998412</span> <span class="o">-</span><span class="mf">199.11443262</span><span class="p">]</span>
<a name="rest_code_8c291c7f5746440ab86a8c16af4ad5d2-4"></a><span class="n">n</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">1.00054972</span>  <span class="mf">1.00109974</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">1.09944359e-03</span>  <span class="o">-</span><span class="mf">1.52451385e-09</span><span class="p">]</span>
<a name="rest_code_8c291c7f5746440ab86a8c16af4ad5d2-5"></a><span class="n">n</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">1.</span>         <span class="mf">0.9999997</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">1.20876952e-04</span>  <span class="o">-</span><span class="mf">6.04384753e-05</span><span class="p">]</span>
<a name="rest_code_8c291c7f5746440ab86a8c16af4ad5d2-6"></a><span class="p">(</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">'Extremum found with desired accuracy.'</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-1"></a><span class="k">function</span> <span class="n">newton_opt</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">hess</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">gtol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-2"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s">"Maximum number of iterations reached."</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-3"></a>    <span class="n">g</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-4"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">niter</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-5"></a>        <span class="k">if</span> <span class="n">verbose</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-6"></a>            <span class="n">println</span><span class="p">(</span><span class="s">"n: </span><span class="si">$</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span><span class="s">, x: </span><span class="si">$</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="s">, g: </span><span class="si">$</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="s">"</span><span class="p">)</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-7"></a>        <span class="k">end</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-8"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">hess</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">\</span><span class="n">g</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-9"></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-10"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">gtol</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-11"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Extremum found with desired accuracy."</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-12"></a>            <span class="k">break</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-13"></a>        <span class="k">end</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-14"></a>    <span class="k">end</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-15"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">msg</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-16"></a><span class="k">end</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-17"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-18"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-19"></a><span class="k">function</span> <span class="n">rosen</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-20"></a>    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-21"></a><span class="k">end</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-22"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-23"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-24"></a><span class="k">function</span> <span class="n">rosen_grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-25"></a>    <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-26"></a>            <span class="mi">200</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">)]</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-27"></a><span class="k">end</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-28"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-29"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-30"></a><span class="k">function</span> <span class="n">rosen_hess</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-31"></a>    <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">800</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-32"></a>            <span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">200</span><span class="p">]</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-33"></a><span class="k">end</span>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-34"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-35"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-36"></a>
<a name="rest_code_5ef2a5f25c7d4789b566a89e201611c4-37"></a><span class="n">println</span><span class="p">(</span><span class="n">newton_opt</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_grad</span><span class="p">,</span> <span class="n">rosen_hess</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">true</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_cd10ce2b35f041949d107fa1ebfba1fd-1"></a><span class="n">n</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">2402.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">600.0</span><span class="p">]</span>
<a name="rest_code_cd10ce2b35f041949d107fa1ebfba1fd-2"></a><span class="n">n</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">1.99834</span><span class="p">,</span> <span class="mf">3.99334</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">1.99889</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000553708</span><span class="p">]</span>
<a name="rest_code_cd10ce2b35f041949d107fa1ebfba1fd-3"></a><span class="n">n</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">1.00055</span><span class="p">,</span> <span class="mf">0.0055331</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">398.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">199.114</span><span class="p">]</span>
<a name="rest_code_cd10ce2b35f041949d107fa1ebfba1fd-4"></a><span class="n">n</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">1.00055</span><span class="p">,</span> <span class="mf">1.0011</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.00109944</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.52451e-9</span><span class="p">]</span>
<a name="rest_code_cd10ce2b35f041949d107fa1ebfba1fd-5"></a><span class="n">n</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.000120877</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.04385e-5</span><span class="p">]</span>
<a name="rest_code_cd10ce2b35f041949d107fa1ebfba1fd-6"></a><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">"Extremum found with desired accuracy."</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="comparison-python-julia">
<h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 34 in Python and 37 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_8ddc7fe952cc4cce841fdb074c0218c7-1"></a><span class="o">%</span><span class="k">timeit</span> newton_opt(rosen, rosen_grad, rosen_hess, [2.0, 1.0])
</pre>
<p>with result</p>
<pre class="code text"><a name="rest_code_192a573f78c94f018cb627e772aa233f-1"></a>1000 loops, best of 3: 247 µs per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_5e973d992cdf4c4aa6c7ba32953a1ffb-1"></a><span class="nd">@benchmark</span> <span class="n">newton_opt</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_grad</span><span class="p">,</span> <span class="n">rosen_hess</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">5.48</span> <span class="n">KiB</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">120</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-4"></a>  <span class="o">--------------</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">5.784</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">6.030</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">6.953</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">10.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">572.279</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">95.96</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-9"></a>  <span class="o">--------------</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_8c3482c8efe8415b953119d9140ac1ea-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">6</span>
</pre>
<p>In this case, we can say that the Python code is roughly 40 times slower
than the Julia one.</p>
</div>
<div class="section" id="comparison-with-gradient-descent">
<h3>Comparison with gradient descent</h3>
<p>We see an improvement in the number of iterations compared with gradient
descent, that is, we moved from 40 iterations to 4 iterations, even if
we demand the method to have higher accuracy, <span class="math">\(10^{-12}\)</span>, for example.</p>
<p>The appearance of this faster convergence does not come for free, of course.
When using Newton's method we have two major drawbacks:</p>
<ul class="simple">
<li><p>We need to compute the Hessian of the function, that might prove
really difficult, even if we have the analytical expression for our
function.</p></li>
<li><p>We need to solve a system of equation in each iteration.</p></li>
</ul>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-07/" class="u-url">Numerical methods challenge: Day 7</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-07/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-07T14:51:35-05:00" title="2017-10-07 14:51">2017-10-07 14:51</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-07/#disqus_thread" data-disqus-identifier="cache/posts/numerical-07.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="nelder-mead-method">
<h2>Nelder-Mead method</h2>
<p>Today we have
<a class="reference external" href="https://en.wikipedia.org/wiki/Nelder%E2%80%93Mead_method">Nelder-Mead method</a>.
This method uses a simplex over <span class="math">\(\mathbb{R}^n\)</span>, e.g., a triangle in
<span class="math">\(\mathbb{R}^2\)</span> or a tetrahedron over <span class="math">\(\mathbb{R}^3\)</span>.</p>
<img alt="Animation showing Nelder-Mead method." class="align-center" src="https://upload.wikimedia.org/wikipedia/commons/e/e4/Nelder-Mead_Rosenbrock.gif" style="width: 600px;"><p><em>In a single step of the method, we remove the vertex with the worst function
value and replace it with another one with a better value. The new point is
obtained by reflecting, expanding, or contracting the simplex along the line
joining the worst vertex with the centroid of the remaining vertices. If we
cannot find a better point in this manner, we retain only the vertex with
the best function value, and we shrink the simplex by moving all other
vertices towards this value.</em> Nocedal and Wright (2006), Numerical Optimization.</p>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_a8424f75da31496ab60dc725608cb407-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-3"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-4"></a><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-5"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-6"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-7"></a><span class="k">def</span> <span class="nf">nelder_mead_step</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-8"></a>                     <span class="n">sigma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-9"></a>    <span class="sd">"""Nelder-Mead iteration according to Wikipedia _[1]</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-10"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-11"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-12"></a><span class="sd">    References</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-13"></a><span class="sd">    ----------</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-14"></a><span class="sd">     .. [1] Wikipedia contributors. "Nelder–Mead method." Wikipedia,</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-15"></a><span class="sd">         The Free Encyclopedia. Wikipedia, The Free Encyclopedia,</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-16"></a><span class="sd">         1 Sep. 2016. Web. 20 Sep. 2016.</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-17"></a><span class="sd">    """</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-18"></a>    <span class="n">nverts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">shape</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-19"></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">verts</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-20"></a>    <span class="c1"># 1. Order</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-21"></a>    <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-22"></a>    <span class="n">verts</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="p">:]</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-23"></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-24"></a>    <span class="c1"># 2. Calculate xo, the centroid"</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-25"></a>    <span class="n">xo</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-26"></a>    <span class="c1"># 3. Reflection</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-27"></a>    <span class="n">xr</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">xo</span> <span class="o">-</span> <span class="n">verts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-28"></a>    <span class="n">fr</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">xr</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-29"></a>    <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">fr</span> <span class="ow">and</span> <span class="n">fr</span><span class="o">&lt;</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-30"></a>        <span class="n">new_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">verts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">xr</span><span class="p">))</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-31"></a>    <span class="c1"># 4. Expansion</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-32"></a>    <span class="k">elif</span> <span class="n">fr</span><span class="o">&lt;</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-33"></a>        <span class="n">xe</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">gamma</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span> <span class="o">-</span> <span class="n">xo</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-34"></a>        <span class="n">fe</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">xe</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-35"></a>        <span class="k">if</span> <span class="n">fe</span> <span class="o">&lt;</span> <span class="n">fr</span><span class="p">:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-36"></a>            <span class="n">new_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">verts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">xe</span><span class="p">))</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-37"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-38"></a>            <span class="n">new_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">verts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">xr</span><span class="p">))</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-39"></a>    <span class="c1"># 5. Contraction</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-40"></a>    <span class="k">else</span><span class="p">:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-41"></a>        <span class="n">xc</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">xo</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-42"></a>        <span class="n">fc</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">xc</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-43"></a>        <span class="k">if</span> <span class="n">fc</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-44"></a>            <span class="n">new_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">verts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">xc</span><span class="p">))</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-45"></a>    <span class="c1"># 6. Shrink</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-46"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-47"></a>            <span class="n">new_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-48"></a>            <span class="n">new_verts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-49"></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nverts</span><span class="p">):</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-50"></a>                <span class="n">new_verts</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">*</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="n">k</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-51"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-52"></a>    <span class="k">return</span> <span class="n">new_verts</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-53"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-54"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-55"></a><span class="k">def</span> <span class="nf">nelder_mead</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-56"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Maximum number of iterations reached."</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-57"></a>    <span class="n">f_old</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-58"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-59"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-60"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"n: </span><span class="si">{}</span><span class="s2">, x: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-61"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">nelder_mead_step</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-62"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">f_old</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-63"></a>        <span class="n">f_old</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-64"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">atol</span><span class="p">:</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-65"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Extremum found with desired accuracy."</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-66"></a>            <span class="k">break</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-67"></a>    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">f_old</span><span class="p">,</span> <span class="n">msg</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-68"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-69"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-70"></a><span class="k">def</span> <span class="nf">rosen</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-71"></a>    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-72"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-73"></a>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-74"></a><span class="n">x</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-75"></a>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-76"></a>           <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<a name="rest_code_a8424f75da31496ab60dc725608cb407-77"></a><span class="nb">print</span><span class="p">(</span><span class="n">nelder_mead</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code python"><a name="rest_code_4fced1e40506446aaebd3ba8e6fdffff-1"></a><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mf">0.99994674</span><span class="p">,</span> <span class="mf">0.99987728</span><span class="p">]),</span> <span class="mf">2.90769311467343e-08</span><span class="p">,</span> <span class="s1">'Extremum found with desired accuracy.'</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-1"></a><span class="k">function</span> <span class="n">nelder_mead_step</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">verts</span><span class="p">;</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-2"></a>                     <span class="n">sigma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-3"></a>    <span class="n">nverts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-4"></a>    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">fun</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">nverts</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-5"></a>    <span class="c"># 1. Order</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-6"></a>    <span class="n">order</span> <span class="o">=</span> <span class="n">sortperm</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-7"></a>    <span class="n">verts</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-8"></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-9"></a>    <span class="c"># 2. Calculate xo, the centroid</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-10"></a>    <span class="n">xo</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-11"></a>    <span class="c"># 3. Reflection</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-12"></a>    <span class="n">xr</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">xo</span> <span class="o">-</span> <span class="n">verts</span><span class="p">[</span><span class="k">end</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span><span class="o">'</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-13"></a>    <span class="n">fr</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">xr</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-14"></a>    <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">fr</span> <span class="o">&amp;&amp;</span> <span class="n">fr</span><span class="o">&lt;</span><span class="n">f</span><span class="p">[</span><span class="k">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-15"></a>        <span class="n">new_verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">];</span> <span class="n">xr</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-16"></a>    <span class="c"># 4. Expansion</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-17"></a>    <span class="k">elseif</span> <span class="n">fr</span><span class="o">&lt;</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-18"></a>        <span class="n">xe</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">gamma</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span> <span class="o">-</span> <span class="n">xo</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-19"></a>        <span class="n">fe</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">xe</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-20"></a>        <span class="k">if</span> <span class="n">fe</span> <span class="o">&lt;</span> <span class="n">fr</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-21"></a>            <span class="n">new_verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">];</span> <span class="n">xe</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-22"></a>        <span class="k">else</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-23"></a>            <span class="n">new_verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">];</span> <span class="n">xr</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-24"></a>        <span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-25"></a>    <span class="c"># 5. Contraction</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-26"></a>    <span class="k">else</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-27"></a>        <span class="n">xc</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="k">end</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span><span class="o">'</span> <span class="o">-</span> <span class="n">xo</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-28"></a>        <span class="n">fc</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">xc</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-29"></a>        <span class="k">if</span> <span class="n">fc</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-30"></a>            <span class="n">new_verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">];</span> <span class="n">xc</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-31"></a>    <span class="c"># 6. Shrink</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-32"></a>        <span class="k">else</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-33"></a>            <span class="n">new_verts</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-34"></a>            <span class="n">new_verts</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-35"></a>            <span class="k">for</span> <span class="n">k</span> <span class="o">=</span>  <span class="mi">1</span><span class="o">:</span><span class="n">nverts</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-36"></a>                <span class="n">new_verts</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">*</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="o">:</span><span class="p">]</span> <span class="o">-</span> <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">])</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-37"></a>            <span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-38"></a>        <span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-39"></a>    <span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-40"></a>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-41"></a>    <span class="k">return</span> <span class="n">new_verts</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-42"></a><span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-43"></a>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-44"></a>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-45"></a><span class="k">function</span> <span class="n">nelder_mead</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-46"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s">"Maximum number of iterations reached."</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-47"></a>    <span class="n">f_old</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-48"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">niter</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-49"></a>        <span class="k">if</span> <span class="n">verbose</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-50"></a>            <span class="n">println</span><span class="p">(</span><span class="s">"n: </span><span class="si">$</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span><span class="s">, x: </span><span class="si">$</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="s">"</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-51"></a>        <span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-52"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">nelder_mead_step</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-53"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">f_old</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-54"></a>        <span class="n">f_old</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-55"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">atol</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-56"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Extremum found with desired accuracy."</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-57"></a>            <span class="k">break</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-58"></a>        <span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-59"></a>    <span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-60"></a>    <span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">f_old</span><span class="p">,</span> <span class="n">msg</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-61"></a><span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-62"></a>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-63"></a>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-64"></a><span class="k">function</span> <span class="n">rosen</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-65"></a>    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-66"></a><span class="k">end</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-67"></a>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-68"></a>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-69"></a><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-70"></a>    <span class="mi">1</span> <span class="mi">1</span><span class="p">;</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-71"></a>    <span class="mi">2</span> <span class="mi">0</span><span class="p">]</span>
<a name="rest_code_e57f1e53ea514b619dde2156eaf046e9-72"></a><span class="n">println</span><span class="p">(</span><span class="n">nelder_mead</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">false</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_b85455623b0c4ffdbe44c6a8c9fdcb46-1"></a><span class="p">([</span><span class="mf">0.999947</span> <span class="mf">0.999877</span><span class="p">],</span> <span class="mf">2.9076931147093985e-8</span><span class="p">,</span> <span class="s">"Extremum found with desired accuracy."</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="comparison-python-julia">
<h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 38 in Python and 39 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_401bdd06e97c42aa91d4199d9f43b90f-1"></a><span class="o">%</span><span class="k">timeit</span> nelder_mead(rosen, x)
</pre>
<p>with result</p>
<pre class="code text"><a name="rest_code_4d8de9a971c540c48012e093765c16b0-1"></a>100 loops, best of 3: 7.82 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_479307c2a8b84a549e11a5eb2e2eb0d8-1"></a><span class="nd">@benchmark</span> <span class="n">grad_descent</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_grad</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">162.23</span> <span class="n">KiB</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">4780</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-4"></a>  <span class="o">--------------</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">462.926</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">506.511</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">552.411</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">3.86</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">5.179</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">80.31</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-9"></a>  <span class="o">--------------</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">9008</span>
<a name="rest_code_f21c1346633b42d18910bdde60ffb7d8-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 15 times slower
than the Julia one.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-06/" class="u-url">Numerical methods challenge: Day 6</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-06/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-06T20:05:08-05:00" title="2017-10-06 20:05">2017-10-06 20:05</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-06/#disqus_thread" data-disqus-identifier="cache/posts/numerical-06.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="gradient-descent">
<h2>Gradient descent</h2>
<p>Today we have
<a class="reference external" href="https://en.wikipedia.org/wiki/Gradient_descent">gradient descent method</a>.
The main idea in this method is to use the steepest direction to move from
a point to a new one in the neighbourhood of a differentiable function.
This is illustrated in the following image, where we can see that the
steps are given perpendicular to the isocontours of the function. If we think
the function as the topography of certain region, it would probably be safe
to think the isocontour of the functios as the path that cows would like to
walk, while the gradient direction the path for a mountain goat.</p>
<img alt="Depiction of the gradient descent method." class="align-center" src="https://upload.wikimedia.org/wikipedia/commons/f/ff/Gradient_descent.svg" style="width: 400px;"><p>Mathematically, the update is written as</p>
<div class="math">
\begin{equation*}
\mathbf{x}_k = \mathbf{x}_{k-1} -
    \gamma_k \nabla f(\mathbf{x_k})
\end{equation*}
</div>
<p>where <span class="math">\(\gamma_k\)</span> is the size of the kth step. Intuitively, we can
see that the size of the step should decrease while we approach the
extremum of the function. This is normally achieving by a
<a class="reference external" href="https://en.wikipedia.org/wiki/Line_search">line search</a>. For gradient
descent method, we could use the Barzilai-Borwein method:</p>
<div class="math">
\begin{equation*}
\gamma_{n} = \frac{(\mathbf x_{n} - \mathbf x_{n-1})^T[\nabla f(\mathbf x_{n}) - \nabla f(\mathbf x_{n-1})]}{||\nabla f(\mathbf x_{n}) - \nabla f(\mathbf x_{n-1})||^2}
\end{equation*}
</div>
<p>We will test the method with the
<a class="reference external" href="https://en.wikipedia.org/wiki/Rosenbrock_function">Rosenbrock's function</a></p>
<div class="math">
\begin{equation*}
f(x_1, x_2) = (1-x_1)^2 + 100(x_2-{x_1}^2)^2
\end{equation*}
</div>
<p>Gradient descent present some problems with this function, that is not convex.
Nevertheless, if we use an initial point that is close enough to the
minimum <span class="math">\([1, 1]\)</span>, we can achieve convergence.</p>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-3"></a><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-4"></a>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-5"></a>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-6"></a><span class="k">def</span> <span class="nf">grad_descent</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">gtol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-7"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Maximum number of iterations reached."</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-8"></a>    <span class="n">g_old</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-9"></a>    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.1</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-10"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-11"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-12"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"n: </span><span class="si">{}</span><span class="s2">, x: </span><span class="si">{}</span><span class="s2">, g: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">g_old</span><span class="p">))</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-13"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamma</span><span class="o">*</span><span class="n">g_old</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-14"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-15"></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-16"></a>        <span class="n">dg</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="n">g_old</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-17"></a>        <span class="n">g_old</span> <span class="o">=</span> <span class="n">g</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-18"></a>        <span class="n">gamma</span> <span class="o">=</span> <span class="n">dx</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span><span class="o">/</span><span class="n">dg</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-19"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">gtol</span><span class="p">:</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-20"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Extremum found with desired accuracy."</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-21"></a>            <span class="k">break</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-22"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">msg</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-23"></a>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-24"></a>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-25"></a><span class="k">def</span> <span class="nf">rosen</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-26"></a>    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-27"></a>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-28"></a>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-29"></a><span class="k">def</span> <span class="nf">rosen_grad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-30"></a>    <span class="k">return</span> <span class="n">array</span><span class="p">([</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-31"></a>        <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-32"></a>        <span class="mi">200</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)])</span>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-33"></a>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-34"></a>
<a name="rest_code_b87acb40a4154fe28f7ac91e6242558e-35"></a><span class="nb">print</span><span class="p">(</span><span class="n">grad_descent</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_grad</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code python"><a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-1"></a><span class="n">n</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="mf">2402.</span>  <span class="o">-</span><span class="mf">600.</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-2"></a><span class="n">n</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">238.2</span>   <span class="mf">61.</span> <span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">5.40030319e+09</span>  <span class="o">-</span><span class="mf">1.13356480e+07</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-3"></a><span class="n">n</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">1.87289769</span>  <span class="mf">61.50393131</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">43446.62297136</span>  <span class="mf">11599.23711122</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-4"></a><span class="n">n</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">1.87482914</span>  <span class="mf">61.50341566</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">43485.61077531</span>  <span class="mf">11597.68626767</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-5"></a><span class="n">n</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">0.2532018</span>   <span class="mf">62.07096513</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">6277.59251909</span>  <span class="mf">12401.37079452</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-6"></a><span class="n">n</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">1.40217916e-02</span>   <span class="mf">6.25988648e+01</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span>  <span class="o">-</span><span class="mf">353.0701476</span>   <span class="mf">12519.73363327</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-7"></a><span class="n">n</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">2.98797952e-04</span>   <span class="mf">6.30854769e+01</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">9.53932693e+00</span>   <span class="mf">1.26170954e+04</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-8"></a><span class="n">n</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">3.49096082e-03</span>   <span class="mf">5.88633946e+01</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span>   <span class="o">-</span><span class="mf">84.18892291</span>  <span class="mf">11772.67648837</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-9"></a><span class="n">n</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.42114221</span>  <span class="mf">0.46054405</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">48.8618897</span>  <span class="mf">56.6366569</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-10"></a><span class="n">n</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.66471507</span>  <span class="mf">0.17821457</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="mf">69.42537577</span> <span class="o">-</span><span class="mf">52.72631034</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-11"></a><span class="n">n</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.50504193</span>  <span class="mf">0.29948111</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">9.96223909</span>  <span class="mf">8.88275049</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-12"></a><span class="n">n</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.52491812</span>  <span class="mf">0.28175867</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.25608389</span>  <span class="mf">1.24392746</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-13"></a><span class="n">n</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.53044731</span>  <span class="mf">0.27871006</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.37379949</span> <span class="o">-</span><span class="mf">0.53285773</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-14"></a><span class="n">n</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.53133016</span>  <span class="mf">0.27996858</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.43934324</span> <span class="o">-</span><span class="mf">0.46863181</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-15"></a><span class="n">n</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.53252827</span>  <span class="mf">0.28124656</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.4365402</span>  <span class="o">-</span><span class="mf">0.46795943</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-16"></a><span class="n">n</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.75411231</span>  <span class="mf">0.51877873</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="mf">14.56231057</span>  <span class="o">-</span><span class="mf">9.98132891</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-17"></a><span class="n">n</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.7050077</span>   <span class="mf">0.55243611</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">16.21302574</span>  <span class="mf">11.08005</span>   <span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-18"></a><span class="n">n</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.73088975</span>  <span class="mf">0.53474821</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.69854407</span>  <span class="mf">0.10967699</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-19"></a><span class="n">n</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.73204207</span>  <span class="mf">0.53456728</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.14989113</span> <span class="o">-</span><span class="mf">0.26366293</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-20"></a><span class="n">n</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.73228024</span>  <span class="mf">0.53498623</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.16984866</span> <span class="o">-</span><span class="mf">0.24962496</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-21"></a><span class="n">n</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.73260201</span>  <span class="mf">0.53545913</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.16949786</span> <span class="o">-</span><span class="mf">0.24931553</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-22"></a><span class="n">n</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.93339279</span>  <span class="mf">0.83080364</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="mf">14.95730865</span>  <span class="o">-</span><span class="mf">8.08369381</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-23"></a><span class="n">n</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.89610321</span>  <span class="mf">0.85095683</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">17.39715957</span>   <span class="mf">9.59117536</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-24"></a><span class="n">n</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.91610476</span>  <span class="mf">0.83992984</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.41766894</span>  <span class="mf">0.13638094</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-25"></a><span class="n">n</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.91659561</span>  <span class="mf">0.83976956</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.02823623</span> <span class="o">-</span><span class="mf">0.07559088</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-26"></a><span class="n">n</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.91662795</span>  <span class="mf">0.83985612</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.03817128</span> <span class="o">-</span><span class="mf">0.0701336</span> <span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-27"></a><span class="n">n</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.91667285</span>  <span class="mf">0.83993863</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.03814167</span> <span class="o">-</span><span class="mf">0.07009733</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-28"></a><span class="n">n</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99186712</span>  <span class="mf">0.97813179</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="mf">2.23273615</span> <span class="o">-</span><span class="mf">1.13372137</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-29"></a><span class="n">n</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.98342663</span>  <span class="mf">0.98241763</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.0476644</span>   <span class="mf">3.05793919</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-30"></a><span class="n">n</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.98959509</span>  <span class="mf">0.97929862</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">2.08791162e-02</span>   <span class="mf">3.50119013e-05</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-31"></a><span class="n">n</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.98961644</span>  <span class="mf">0.97929858</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.00409146</span> <span class="o">-</span><span class="mf">0.00842531</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-32"></a><span class="n">n</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.9896206</span>   <span class="mf">0.97930713</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.00421464</span> <span class="o">-</span><span class="mf">0.00835884</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-33"></a><span class="n">n</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.98963284</span>  <span class="mf">0.97933141</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0042095</span>  <span class="o">-</span><span class="mf">0.00834897</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-34"></a><span class="n">n</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99991222</span>  <span class="mf">0.99971914</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.04194186</span> <span class="o">-</span><span class="mf">0.02106056</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-35"></a><span class="n">n</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99597256</span>  <span class="mf">1.00169739</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.88678974</span>  <span class="mf">1.9472097</span> <span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-36"></a><span class="n">n</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99987194</span>  <span class="mf">0.99974387</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">2.42382231e-04</span>  <span class="o">-</span><span class="mf">6.86507784e-06</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-37"></a><span class="n">n</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99987219</span>  <span class="mf">0.99974388</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">5.01566886e-05</span>  <span class="o">-</span><span class="mf">1.02746923e-04</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-38"></a><span class="n">n</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99987224</span>  <span class="mf">0.99974398</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">5.10336616e-05</span>  <span class="o">-</span><span class="mf">1.02258276e-04</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-39"></a><span class="n">n</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99987255</span>  <span class="mf">0.99974461</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">5.09073070e-05</span>  <span class="o">-</span><span class="mf">1.02006794e-04</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-40"></a><span class="n">n</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99999998</span>  <span class="mf">0.99999996</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">5.05854337e-06</span>  <span class="o">-</span><span class="mf">2.54465444e-06</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-41"></a><span class="n">n</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.99998735</span>  <span class="mf">1.00000631</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.01266881</span>  <span class="mf">0.00632184</span><span class="p">]</span>
<a name="rest_code_1a14e934b90b4e2d8b79875a23e22778-42"></a><span class="p">(</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]),</span> <span class="mf">7.2961338114681859e-21</span><span class="p">,</span> <span class="s1">'Extremum found with desired accuracy.'</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-1"></a><span class="k">function</span> <span class="n">grad_descent</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">gtol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-2"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s">"Maximum number of iterations reached."</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-3"></a>    <span class="n">g_old</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-4"></a>    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.1</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-5"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">niter</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-6"></a>        <span class="k">if</span> <span class="n">verbose</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-7"></a>            <span class="n">println</span><span class="p">(</span><span class="s">"n: </span><span class="si">$</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span><span class="s">, x: </span><span class="si">$</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="s">, g: </span><span class="si">$</span><span class="p">(</span><span class="n">g_old</span><span class="p">)</span><span class="s">"</span><span class="p">)</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-8"></a>        <span class="k">end</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-9"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="o">-</span> <span class="n">gamma</span><span class="o">*</span><span class="n">g_old</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-10"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-11"></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-12"></a>        <span class="n">dg</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="n">g_old</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-13"></a>        <span class="n">g_old</span> <span class="o">=</span> <span class="n">g</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-14"></a>        <span class="n">gamma</span> <span class="o">=</span> <span class="n">dx</span><span class="o">'</span> <span class="o">*</span> <span class="n">dg</span> <span class="o">/</span> <span class="p">(</span><span class="n">dg</span><span class="o">'</span> <span class="o">*</span> <span class="n">dg</span><span class="p">)</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-15"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">gtol</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-16"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Extremum found with desired accuracy."</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-17"></a>            <span class="k">break</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-18"></a>        <span class="k">end</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-19"></a>    <span class="k">end</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-20"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">msg</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-21"></a><span class="k">end</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-22"></a>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-23"></a>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-24"></a><span class="k">function</span> <span class="n">rosen</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-25"></a>    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-26"></a><span class="k">end</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-27"></a>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-28"></a>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-29"></a><span class="k">function</span> <span class="n">rosen_grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-30"></a>    <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-31"></a>            <span class="mi">200</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">)]</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-32"></a><span class="k">end</span>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-33"></a>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-34"></a>
<a name="rest_code_45cebeada2d742ceb5ac7eab25863ccd-35"></a><span class="n">println</span><span class="p">(</span><span class="n">grad_descent</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_grad</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">true</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_598c97d4213b43868b68872446e5849b-1"></a><span class="n">n</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">2402.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">600.0</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-2"></a><span class="n">n</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">238.2</span><span class="p">,</span> <span class="mf">61.0</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.4003e9</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.13356e7</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-3"></a><span class="n">n</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">1.8729</span><span class="p">,</span> <span class="mf">61.5039</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">43446.6</span><span class="p">,</span> <span class="mf">11599.2</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-4"></a><span class="n">n</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">1.87483</span><span class="p">,</span> <span class="mf">61.5034</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">43485.6</span><span class="p">,</span> <span class="mf">11597.7</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-5"></a><span class="n">n</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.253202</span><span class="p">,</span> <span class="mf">62.071</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">6277.59</span><span class="p">,</span> <span class="mf">12401.4</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-6"></a><span class="n">n</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.0140218</span><span class="p">,</span> <span class="mf">62.5989</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">353.07</span><span class="p">,</span> <span class="mf">12519.7</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-7"></a><span class="n">n</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.000298798</span><span class="p">,</span> <span class="mf">63.0855</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">9.53933</span><span class="p">,</span> <span class="mf">12617.1</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-8"></a><span class="n">n</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.00349096</span><span class="p">,</span> <span class="mf">58.8634</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">84.1889</span><span class="p">,</span> <span class="mf">11772.7</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-9"></a><span class="n">n</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.421142</span><span class="p">,</span> <span class="mf">0.460544</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">48.8619</span><span class="p">,</span> <span class="mf">56.6367</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-10"></a><span class="n">n</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.664715</span><span class="p">,</span> <span class="mf">0.178215</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">69.4254</span><span class="p">,</span> <span class="o">-</span><span class="mf">52.7263</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-11"></a><span class="n">n</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.505042</span><span class="p">,</span> <span class="mf">0.299481</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">9.96224</span><span class="p">,</span> <span class="mf">8.88275</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-12"></a><span class="n">n</span><span class="o">:</span> <span class="mi">12</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.524918</span><span class="p">,</span> <span class="mf">0.281759</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.25608</span><span class="p">,</span> <span class="mf">1.24393</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-13"></a><span class="n">n</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.530447</span><span class="p">,</span> <span class="mf">0.27871</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.373799</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.532858</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-14"></a><span class="n">n</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.53133</span><span class="p">,</span> <span class="mf">0.279969</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.439343</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.468632</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-15"></a><span class="n">n</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.532528</span><span class="p">,</span> <span class="mf">0.281247</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.43654</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.467959</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-16"></a><span class="n">n</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.754112</span><span class="p">,</span> <span class="mf">0.518779</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">14.5623</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.98133</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-17"></a><span class="n">n</span><span class="o">:</span> <span class="mi">17</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.705008</span><span class="p">,</span> <span class="mf">0.552436</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">16.213</span><span class="p">,</span> <span class="mf">11.08</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-18"></a><span class="n">n</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.73089</span><span class="p">,</span> <span class="mf">0.534748</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.698544</span><span class="p">,</span> <span class="mf">0.109677</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-19"></a><span class="n">n</span><span class="o">:</span> <span class="mi">19</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.732042</span><span class="p">,</span> <span class="mf">0.534567</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.149891</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.263663</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-20"></a><span class="n">n</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.73228</span><span class="p">,</span> <span class="mf">0.534986</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.169849</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.249625</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-21"></a><span class="n">n</span><span class="o">:</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.732602</span><span class="p">,</span> <span class="mf">0.535459</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.169498</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.249316</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-22"></a><span class="n">n</span><span class="o">:</span> <span class="mi">22</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.933393</span><span class="p">,</span> <span class="mf">0.830804</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">14.9573</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.08369</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-23"></a><span class="n">n</span><span class="o">:</span> <span class="mi">23</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.896103</span><span class="p">,</span> <span class="mf">0.850957</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">17.3972</span><span class="p">,</span> <span class="mf">9.59118</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-24"></a><span class="n">n</span><span class="o">:</span> <span class="mi">24</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.916105</span><span class="p">,</span> <span class="mf">0.83993</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.417669</span><span class="p">,</span> <span class="mf">0.136381</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-25"></a><span class="n">n</span><span class="o">:</span> <span class="mi">25</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.916596</span><span class="p">,</span> <span class="mf">0.83977</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0282362</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0755909</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-26"></a><span class="n">n</span><span class="o">:</span> <span class="mi">26</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.916628</span><span class="p">,</span> <span class="mf">0.839856</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0381713</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0701336</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-27"></a><span class="n">n</span><span class="o">:</span> <span class="mi">27</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.916673</span><span class="p">,</span> <span class="mf">0.839939</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0381417</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0700973</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-28"></a><span class="n">n</span><span class="o">:</span> <span class="mi">28</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.991867</span><span class="p">,</span> <span class="mf">0.978132</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.23274</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.13372</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-29"></a><span class="n">n</span><span class="o">:</span> <span class="mi">29</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.983427</span><span class="p">,</span> <span class="mf">0.982418</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.04766</span><span class="p">,</span> <span class="mf">3.05794</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-30"></a><span class="n">n</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.989595</span><span class="p">,</span> <span class="mf">0.979299</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0208791</span><span class="p">,</span> <span class="mf">3.50119e-5</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-31"></a><span class="n">n</span><span class="o">:</span> <span class="mi">31</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.989616</span><span class="p">,</span> <span class="mf">0.979299</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.00409146</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00842531</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-32"></a><span class="n">n</span><span class="o">:</span> <span class="mi">32</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.989621</span><span class="p">,</span> <span class="mf">0.979307</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.00421464</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00835884</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-33"></a><span class="n">n</span><span class="o">:</span> <span class="mi">33</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.989633</span><span class="p">,</span> <span class="mf">0.979331</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0042095</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00834897</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-34"></a><span class="n">n</span><span class="o">:</span> <span class="mi">34</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.999912</span><span class="p">,</span> <span class="mf">0.999719</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.0419419</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0210606</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-35"></a><span class="n">n</span><span class="o">:</span> <span class="mi">35</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.995973</span><span class="p">,</span> <span class="mf">1.0017</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.88679</span><span class="p">,</span> <span class="mf">1.94721</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-36"></a><span class="n">n</span><span class="o">:</span> <span class="mi">36</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.999872</span><span class="p">,</span> <span class="mf">0.999744</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.000242382</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.86508e-6</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-37"></a><span class="n">n</span><span class="o">:</span> <span class="mi">37</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.999872</span><span class="p">,</span> <span class="mf">0.999744</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.01567e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000102747</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-38"></a><span class="n">n</span><span class="o">:</span> <span class="mi">38</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.999872</span><span class="p">,</span> <span class="mf">0.999744</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.10337e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000102258</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-39"></a><span class="n">n</span><span class="o">:</span> <span class="mi">39</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.999873</span><span class="p">,</span> <span class="mf">0.999745</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.09073e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000102007</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-40"></a><span class="n">n</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="mf">5.05854e-6</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.54465e-6</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-41"></a><span class="n">n</span><span class="o">:</span> <span class="mi">41</span><span class="p">,</span> <span class="n">x</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.999987</span><span class="p">,</span> <span class="mf">1.00001</span><span class="p">],</span> <span class="n">g</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0126688</span><span class="p">,</span> <span class="mf">0.00632184</span><span class="p">]</span>
<a name="rest_code_598c97d4213b43868b68872446e5849b-42"></a><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="mf">7.296133811468186e-21</span><span class="p">,</span> <span class="s">"Root found with desired accuracy."</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="comparison-python-julia">
<h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 38 in Python and 39 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_95af0dec0faa4d8ca70dbfca512fe12f-1"></a><span class="o">%</span><span class="k">timeit</span> grad_descent(rosen, rosen_grad, [2.0, 1.0])
</pre>
<p>with result</p>
<pre class="code text"><a name="rest_code_d3f82e6d97c2473ca5ca20635dfa8097-1"></a>1000 loops, best of 3: 386 µs per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_b1f89405397b4e61b6c61b9e96710a6b-1"></a><span class="nd">@benchmark</span> <span class="n">grad_descent</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_grad</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">16.91</span> <span class="n">KiB</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">251</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-4"></a>  <span class="o">--------------</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">6.479</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">7.393</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">13.437</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">18.45</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">2.029</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">95.94</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-9"></a>  <span class="o">--------------</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_1cf79e3227d2421c8922d67d0f8ebd18-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">5</span>
</pre>
<p>In this case, we can say that the Python code is roughly 50 times slower
than the Julia one.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-05/" class="u-url">Numerical methods challenge: Day 5</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-05/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-05T13:21:41-05:00" title="2017-10-05 13:21">2017-10-05 13:21</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-05/#disqus_thread" data-disqus-identifier="cache/posts/numerical-05.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="broyden-s-method">
<h2>Broyden's method</h2>
<p>Today we have
<a class="reference external" href="https://en.wikipedia.org/wiki/Broyden%27s_method">Broyden's method</a>.
The main idea in this method is to compute the Jacobian matrix just at the
first iteration and change it for each iteration doing rank-1
updates.</p>
<div class="math">
\begin{equation*}
\mathbf{x}_k = \mathbf{x}_{k-1} -
    J_n \mathbf{F}(\mathbf{x_k})
\end{equation*}
</div>
<p>where we need estimate the Jacobian matrix at step <span class="math">\(n\)</span> by</p>
<div class="math">
\begin{equation*}
\mathbf J_n = \mathbf J_{n - 1} + \frac{\Delta \mathbf f_n - \mathbf J_{n - 1} \Delta \mathbf x_n}{\|\Delta \mathbf x_n\|^2} \Delta \mathbf x_n^{\mathrm T}
\end{equation*}
</div>
<p>that correspond to rank-1 updates of the Jacobian matrix.</p>
<p>We will test the method with the function
<span class="math">\(\mathbf{F}(x, y) = (x + 2y - 2, x^2 + 4x - 4)\)</span>
with solution <span class="math">\(\mathbf{x} = (0, 1)\)</span>.</p>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_725f8a50cc9e451dba2654a571336f50-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">outer</span><span class="p">,</span> <span class="n">dot</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-3"></a><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">solve</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">det</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-4"></a>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-5"></a><span class="k">def</span> <span class="nf">broyden</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-6"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Maximum number of iterations reached."</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-7"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-8"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-9"></a>        <span class="k">if</span> <span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ftol</span><span class="p">:</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-10"></a>            <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-11"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Derivative near to zero."</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-12"></a>            <span class="k">break</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-13"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-14"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"n: </span><span class="si">{}</span><span class="s2">, x: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-15"></a>        <span class="n">f_old</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-16"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="n">solve</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">f_old</span><span class="p">)</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-17"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-18"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-19"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="n">f_old</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-20"></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">J</span> <span class="o">+</span> <span class="n">outer</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">dx</span><span class="p">),</span> <span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-21"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ftol</span><span class="p">:</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-22"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Root found with desired accuracy."</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-23"></a>            <span class="k">break</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-24"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">msg</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-25"></a>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-26"></a>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-27"></a><span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-28"></a>    <span class="k">return</span> <span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="p">])</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-29"></a>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-30"></a>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-31"></a><span class="k">def</span> <span class="nf">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-32"></a>    <span class="k">return</span> <span class="n">array</span><span class="p">([</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-33"></a>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-34"></a>            <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">8</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]])</span>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-35"></a>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-36"></a>
<a name="rest_code_725f8a50cc9e451dba2654a571336f50-37"></a><span class="nb">print</span><span class="p">(</span><span class="n">broyden</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]))</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-1"></a><span class="k">function</span> <span class="n">broyden</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-2"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s">"Maximum number of iterations reached."</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-3"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-4"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">niter</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-5"></a>        <span class="k">if</span> <span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ftol</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-6"></a>            <span class="n">x</span> <span class="o">=</span> <span class="nb">nothing</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-7"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Derivative near to zero."</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-8"></a>            <span class="k">break</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-9"></a>        <span class="k">end</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-10"></a>        <span class="k">if</span> <span class="n">verbose</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-11"></a>            <span class="n">println</span><span class="p">(</span><span class="s">"n: </span><span class="si">$</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span><span class="s">, x: </span><span class="si">$</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="s">"</span><span class="p">)</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-12"></a>        <span class="k">end</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-13"></a>        <span class="n">f_old</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-14"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="n">J</span><span class="o">\</span><span class="n">f_old</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-15"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-16"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-17"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="n">f_old</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-18"></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">J</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">J</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span><span class="o">'/</span> <span class="p">(</span><span class="n">dx</span><span class="o">'</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-19"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ftol</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-20"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Root found with desired accuracy."</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-21"></a>            <span class="k">break</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-22"></a>        <span class="k">end</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-23"></a>    <span class="k">end</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-24"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">msg</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-25"></a><span class="k">end</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-26"></a>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-27"></a><span class="k">function</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-28"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-29"></a><span class="k">end</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-30"></a>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-31"></a>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-32"></a><span class="k">function</span> <span class="n">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-33"></a>    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">;</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-34"></a>           <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">8</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-35"></a><span class="k">end</span>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-36"></a>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-37"></a>
<a name="rest_code_a7452ffdd9c44ee9bf3d8626ff693396-38"></a><span class="n">println</span><span class="p">(</span><span class="n">broyden</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]))</span>
</pre>
</div>
<div class="section" id="comparison-python-julia">
<h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 38 in Python and 39 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_a88202cfa16b4d3daf645dd8d09845fe-1"></a><span class="o">%</span><span class="k">timeit</span> broyden(fun, jaco, [1.0, 2.0])
</pre>
<p>with result</p>
<pre class="code text"><a name="rest_code_23e9e6a3b1434df0807f4708f2e4e451-1"></a>1000 loops, best of 3: 703 µs per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_bb714f9e63cc4908af01ac648767d946-1"></a><span class="nd">@benchmark</span> <span class="n">broyden</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_b323e375a4464a8da6444022eef5cf14-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">14.41</span> <span class="n">KiB</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">220</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-4"></a>  <span class="o">--------------</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">12.099</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">12.867</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">15.378</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">10.78</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">3.511</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">97.53</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-9"></a>  <span class="o">--------------</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_b323e375a4464a8da6444022eef5cf14-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 50 times slower
than the Julia one.</p>
</div>
<div class="section" id="comparison-newton-broyden">
<h3>Comparison Newton/Broyden</h3>
<p>Following, we are comparing Newton's and Broyden's method. We are using
the function <span class="math">\(\mathbf{x}^T \mathbf{x} + \mathbf{x}\)</span> for this test.</p>
<div class="section" id="id2">
<h4>Python</h4>
<p>The code for the function and Jacobian is</p>
<pre class="code Python"><a name="rest_code_7d9565a2de9b4460a0290017351c6568-1"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">diag</span>
<a name="rest_code_7d9565a2de9b4460a0290017351c6568-2"></a><span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span>
<a name="rest_code_7d9565a2de9b4460a0290017351c6568-3"></a><span class="n">jaco</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">diag</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre>
<p>and the results are:</p>
<table>
<colgroup>
<col style="width: 15%">
<col style="width: 44%">
<col style="width: 41%">
</colgroup>
<tbody>
<tr>
<td><p>n</p></td>
<td><p>Newton (μs)</p></td>
<td><p>Broyden (μs)</p></td>
</tr>
<tr>
<td><p>2</p></td>
<td><p>500</p></td>
<td><p>664</p></td>
</tr>
<tr>
<td><p>10</p></td>
<td><p>541</p></td>
<td><p>717</p></td>
</tr>
<tr>
<td><p>100</p></td>
<td><p>3450</p></td>
<td><p>4800</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id3">
<h4>Julia</h4>
<p>The code for the function and Jacobian is</p>
<pre class="code julia"><a name="rest_code_1db1671e9adf40babf52f396cdac573e-1"></a><span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">'</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
<a name="rest_code_1db1671e9adf40babf52f396cdac573e-2"></a><span class="n">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">diagm</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre>
<p>and the results are:</p>
<table>
<colgroup>
<col style="width: 15%">
<col style="width: 44%">
<col style="width: 41%">
</colgroup>
<tbody>
<tr>
<td><p>n</p></td>
<td><p>Newton (μs)</p></td>
<td><p>Broyden (μs)</p></td>
</tr>
<tr>
<td><p>2</p></td>
<td><p>1.76</p></td>
<td><p>1.65</p></td>
</tr>
<tr>
<td><p>10</p></td>
<td><p>56.42</p></td>
<td><p>5.12</p></td>
</tr>
<tr>
<td><p>100</p></td>
<td><p>1782</p></td>
<td><p>367</p></td>
</tr>
</tbody>
</table>
<p>In this case, we are comparing the mean values of the results from
<code class="docutils literal">@benchmark</code>.</p>
</div>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-04/" class="u-url">Numerical methods challenge: Day 4</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-04/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-04T21:30:15-05:00" title="2017-10-04 21:30">2017-10-04 21:30</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-04/#disqus_thread" data-disqus-identifier="cache/posts/numerical-04.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="newton-s-method-vector-case">
<h2>Newton's method: vector case</h2>
<p>Today we have
<a class="reference external" href="https://en.wikipedia.org/wiki/Newton%27s_method">Newton's method</a>
one more time. In this case, the function is vector-valued. This implies
a slight modification over the original post. The new approximation is
computed from the old one using</p>
<div class="math">
\begin{equation*}
\mathbf{x}_k = \mathbf{x}_{k-1} -
    J(\mathbf{x}_k)^{-1} \mathbf{F}(\mathbf{x_k})
\end{equation*}
</div>
<p>where we need to use the Jacobian matrix <span class="math">\(J\)</span>.</p>
<p>We will test the method with the function
<span class="math">\(\mathbf{F}(x, y) = (x + 2y - 2, x^2 + 4x - 4)\)</span>
with solution <span class="math">\(\mathbf{x} = (0, 1)\)</span>.</p>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-3"></a><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">solve</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">det</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-4"></a>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-5"></a><span class="k">def</span> <span class="nf">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-6"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Maximum number of iterations reached."</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-7"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-8"></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-9"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-10"></a>        <span class="k">if</span> <span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ftol</span><span class="p">:</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-11"></a>            <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-12"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Derivative near to zero."</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-13"></a>            <span class="k">break</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-14"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-15"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"n: </span><span class="si">{}</span><span class="s2">, x: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-16"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">solve</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-17"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ftol</span><span class="p">:</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-18"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Root found with desired accuracy."</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-19"></a>            <span class="k">break</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-20"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">msg</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-21"></a>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-22"></a>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-23"></a><span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-24"></a>    <span class="k">return</span> <span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="p">])</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-25"></a>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-26"></a>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-27"></a><span class="k">def</span> <span class="nf">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-28"></a>    <span class="k">return</span> <span class="n">array</span><span class="p">([</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-29"></a>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-30"></a>            <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">8</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]])</span>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-31"></a>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-32"></a>
<a name="rest_code_32d3cf79b80c49d7a7aae15dafa938a1-33"></a><span class="nb">print</span><span class="p">(</span><span class="n">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]))</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_90dd2afd839340fead560cf8a5617ef4-1"></a><span class="k">function</span> <span class="n">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-2"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s">"Maximum number of iterations reached."</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-3"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">niter</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-4"></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-5"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-6"></a>        <span class="k">if</span> <span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ftol</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-7"></a>            <span class="n">x</span> <span class="o">=</span> <span class="nb">nothing</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-8"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Derivative near to zero."</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-9"></a>            <span class="k">break</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-10"></a>        <span class="k">end</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-11"></a>        <span class="k">if</span> <span class="n">verbose</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-12"></a>            <span class="n">println</span><span class="p">(</span><span class="s">"n: </span><span class="si">$</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span><span class="s">, x: </span><span class="si">$</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="s">"</span><span class="p">)</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-13"></a>        <span class="k">end</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-14"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">J</span><span class="o">\</span><span class="n">f</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-15"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ftol</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-16"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Root found with desired accuracy."</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-17"></a>            <span class="k">break</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-18"></a>        <span class="k">end</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-19"></a>    <span class="k">end</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-20"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">msg</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-21"></a><span class="k">end</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-22"></a>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-23"></a>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-24"></a><span class="k">function</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-25"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-26"></a><span class="k">end</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-27"></a>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-28"></a>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-29"></a><span class="k">function</span> <span class="n">jaco</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-30"></a>    <span class="k">return</span> <span class="p">[</span><span class="mf">1.0</span> <span class="mf">2.0</span><span class="p">;</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-31"></a>            <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">8</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-32"></a><span class="k">end</span>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-33"></a>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-34"></a>
<a name="rest_code_90dd2afd839340fead560cf8a5617ef4-35"></a><span class="n">println</span><span class="p">(</span><span class="n">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]))</span>
</pre>
</div>
<div class="section" id="comparison">
<h3>Comparison</h3>
<p>Regarding number of lines we have: 31 in Python and 33 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_e5c555b9614f42539215602ea4b384a3-1"></a><span class="o">%</span><span class="k">timeit</span> newton(fun, jaco, [1.0, 10.0])
</pre>
<p>with result</p>
<pre class="code IPython"><a name="rest_code_ffedc7eeb9244fa1b6380a3a5194db31-1"></a><span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">284</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span>
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_619950ce216242f5bae94ac8a1822dbf-1"></a><span class="nd">@benchmark</span> <span class="n">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">jaco</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">10.44</span> <span class="n">KiB</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">192</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-4"></a>  <span class="o">--------------</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">6.818</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">7.167</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">9.607</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">16.53</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">2.953</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">97.40</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-9"></a>  <span class="o">--------------</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_fcd1ed966d5b48a3b7a19ffd3711b0bf-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">4</span>
</pre>
<p>In this case, we can say that the Python code is roughly 40 times slower
than the Julia one. This is an improvement compared to the previous examples,
where the ratio was around 100. The reason for this "improvement" might be
in the inversion of the Jacobian, that calls a <code class="docutils literal">numpy</code> routine, doing
the weight-lifting for us.</p>
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical-03/" class="u-url">Numerical methods challenge: Day 3</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical-03/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-03T19:26:13-05:00" title="2017-10-03 19:26">2017-10-03 19:26</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical-03/#disqus_thread" data-disqus-identifier="cache/posts/numerical-03.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<div class="section" id="newton-s-method">
<h2>Newton's method</h2>
<p>Today's method is
<a class="reference external" href="https://en.wikipedia.org/wiki/Newton%27s_method">Newton's method</a>.
This method is used to solve the equation <span class="math">\(f(x) = 0\)</span>
for <span class="math">\(x\)</span> real, and <span class="math">\(f\)</span>  a differentiable function.
It starts with an initial guess <span class="math">\(x_0\)</span> and it succesively refine it
by finding the intercept of the tangent line to the function with zero.
The new approximation is computed from the old one using</p>
<div class="math">
\begin{equation*}
x_k = x_{k-1} - \frac{f(x)}{f'(x)}
\end{equation*}
</div>
<p>Convergence of this method is generally faster than bisection method.
Nevertheless, the convergence is not guaranteed. Another drawback is the
need of the derivative of the function.</p>
<p>We will use the function <span class="math">\(f(x) = \cos(x) - x\)</span> to test the codes,
and the initial guess is 1.0.</p>
<p>Following are the codes.</p>
<div class="section" id="python">
<h3>Python</h3>
<pre class="code python"><a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-3"></a>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-4"></a><span class="k">def</span> <span class="nf">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-5"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Maximum number of iterations reached."</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-6"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-7"></a>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">ftol</span><span class="p">:</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-8"></a>            <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-9"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Derivative near to zero."</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-10"></a>            <span class="k">break</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-11"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-12"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"n: </span><span class="si">{}</span><span class="s2">, x: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-13"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-14"></a>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">ftol</span><span class="p">:</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-15"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Root found with desired accuracy."</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-16"></a>            <span class="k">break</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-17"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">msg</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-18"></a>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-19"></a>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-20"></a><span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-21"></a>    <span class="k">return</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-22"></a>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-23"></a>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-24"></a><span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-25"></a>    <span class="k">return</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-26"></a>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-27"></a>
<a name="rest_code_8d23ca01166c48c8a6e8b5e04bd4d51b-28"></a><span class="nb">print</span><span class="p">(</span><span class="n">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</pre>
</div>
<div class="section" id="julia">
<h3>Julia</h3>
<pre class="code julia"><a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-1"></a><span class="k">function</span> <span class="n">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-2"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s">"Maximum number of iterations reached."</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-3"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">niter</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-4"></a>        <span class="k">if</span> <span class="n">abs</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">ftol</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-5"></a>            <span class="n">x</span> <span class="o">=</span> <span class="nb">nothing</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-6"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Derivative near to zero."</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-7"></a>            <span class="k">break</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-8"></a>        <span class="k">end</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-9"></a>        <span class="k">if</span> <span class="n">verbose</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-10"></a>            <span class="n">println</span><span class="p">(</span><span class="s">"n: </span><span class="si">$</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span><span class="s">, x: </span><span class="si">$</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="s">"</span><span class="p">)</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-11"></a>        <span class="k">end</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-12"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-13"></a>        <span class="k">if</span> <span class="n">abs</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">ftol</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-14"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s">"Root found with desired accuracy."</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-15"></a>            <span class="k">break</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-16"></a>        <span class="k">end</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-17"></a>    <span class="k">end</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-18"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">msg</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-19"></a><span class="k">end</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-20"></a>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-21"></a>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-22"></a><span class="k">function</span> <span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-23"></a>    <span class="k">return</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-24"></a><span class="k">end</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-25"></a>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-26"></a>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-27"></a><span class="k">function</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-28"></a>    <span class="k">return</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-29"></a><span class="k">end</span>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-30"></a>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-31"></a>
<a name="rest_code_4d7cf09dd3db46b4adc0e338512a44a2-32"></a><span class="n">println</span><span class="p">(</span><span class="n">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</pre>
</div>
<div class="section" id="comparison">
<h3>Comparison</h3>
<p>Regarding number of lines we have: 28 in Python and 32 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a name="rest_code_949518b9bfef4f388a832ddf499f4e45-1"></a><span class="o">%</span><span class="k">timeit</span> newton(fun, grad, 1.0)
</pre>
<p>with result</p>
<pre class="code IPython"><a name="rest_code_e00b6dd53b4545939bb697bcacd66c87-1"></a><span class="mi">10000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">27.3</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span>
</pre>
<p>For Julia:</p>
<pre class="code julia"><a name="rest_code_84cb9b375ae24623ac756ecb9364a9d9-1"></a><span class="nd">@benchmark</span> <span class="n">newton</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code julia"><a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">48</span> <span class="n">bytes</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">2</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-4"></a>  <span class="o">--------------</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">327.925</span> <span class="n">ns</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">337.956</span> <span class="n">ns</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">351.064</span> <span class="n">ns</span> <span class="p">(</span><span class="mf">0.80</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">8.118</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">92.60</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-9"></a>  <span class="o">--------------</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a name="rest_code_598b2743848c41e49da4c5fed9da6bf9-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">226</span>
</pre>
</div>
</div>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-3.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="nicoguaro-github";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script><footer id="footer"><p>Contents © 2021 <a href="mailto:nicoguarin@gmail.com">Nicolás Guarín-Zapata</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a></p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145359674-1', 'auto');
ga('send', 'pageview');
</script><script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
