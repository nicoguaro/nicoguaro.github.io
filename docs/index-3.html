<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Personal blog and website">
<meta name="viewport" content="width=device-width">
<title>Nicolás' blog (old posts, page 3) | Nicolás' blog</title>
<link href="assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" href="es/rss.xml">
<link rel="canonical" href="https://nicoguaro.github.io/index-3.html">
<link rel="prev" href="index-4.html" type="text/html">
<link rel="next" href="index-2.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>This is my personal website and blog.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="pages/about/">About</a>
        <a class="sidebar-nav-item" href="index.html">Blog</a>
        <a class="sidebar-nav-item" href="pages/preprints-archive/">Preprints</a>
        <a class="sidebar-nav-item" href="pages/links/">Links</a>
        <a class="sidebar-nav-item" href="archive.html">Archive</a>
        <a class="sidebar-nav-item" href="categories/">Tags</a>
        <a class="sidebar-nav-item" href="rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://nicoguaro.github.io/" title="Nicolás' blog" rel="home">Nicolás' blog</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        

<div class="posts">
    <article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-22/" class="u-url">Numerical methods challenge: Day 22</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-22/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-22T10:51:10-05:00" title="2017-10-22 10:51">2017-10-22 10:51</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-22/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-22.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="finite-difference-eigenproblems"><h2>Finite Difference: Eigenproblems</h2>
<p>Today we have a <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_difference_method">Finite difference method</a>
to compute the vibration modes of a beam. The equation of interest is</p>
<div class="math">
\begin{equation*}
\nabla^ 4 u = k^2 u
\end{equation*}
</div>
<p>with</p>
<div class="math">
\begin{equation*}
u(0) = u(L)  = 0
\end{equation*}
</div>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-1" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-2" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-3" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-3"></a><span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">eigh</span> <span class="k">as</span> <span class="n">eigsh</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-4" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-5" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-5"></a>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-6" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-6"></a>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-7" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-7"></a><span class="k">def</span> <span class="nf">beam_FDM_eigs</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-8" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-8"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-9" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-9"></a>    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-10" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-10"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span>\
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-11" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-11"></a>            <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>\
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-12" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-12"></a>            <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-13" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-13"></a>    <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">stiff</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-14" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-14"></a>    <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span><span class="p">,</span> <span class="n">x</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-15" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-15"></a>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-16" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-16"></a>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-17" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-17"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">1001</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-18" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-18"></a><span class="n">nvals</span> <span class="o">=</span> <span class="mi">20</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-19" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-19"></a><span class="n">nvecs</span> <span class="o">=</span> <span class="mi">4</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-20" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-20"></a><span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">beam_FDM_eigs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-21" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-21"></a>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-22" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-22"></a><span class="c1">#%% Plotting</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-23" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-23"></a><span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nvals</span><span class="p">,</span> <span class="n">nvals</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-24" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-24"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"mathtext.fontset"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"cm"</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-25" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-25"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-26" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-26"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-27" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-27"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nvals</span><span class="p">]),</span> <span class="s2">"o"</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-28" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-28"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$N$"</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-29" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-29"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\omega\sqrt{\frac{\lambda}</span><span class="si">{EI}</span><span class="s2">}$"</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-30" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-30"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-31" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-31"></a><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvecs</span><span class="p">):</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-32" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-32"></a>    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-33" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-33"></a>    <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vecs</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-34" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-34"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$n=</span><span class="si">%i</span><span class="s1">$'</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-35" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-35"></a>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-36" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-36"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-37" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-37"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$w$"</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-38" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-38"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-39" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-39"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-40" name="rest_code_b6fdaa82b7d2481eb1c35494ca01a71c-40"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-1" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-2" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-2"></a>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-3" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-3"></a>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-4" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-4"></a><span class="k">function</span> <span class="n">beam_FDM_eigs</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-5" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-5"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-6" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-6"></a>    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-7" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-7"></a>    <span class="n">stiff</span> <span class="o">=</span> <span class="n">diagm</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-8" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-8"></a>            <span class="n">diagm</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">diagm</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-9" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-9"></a>            <span class="n">diagm</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">diagm</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-10" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-10"></a>    <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">stiff</span><span class="o">/</span><span class="n">dx</span><span class="o">^</span><span class="mi">4</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-11" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-11"></a>    <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span><span class="p">,</span> <span class="n">x</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-12" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-12"></a><span class="k">end</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-13" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-13"></a>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-14" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-14"></a>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-15" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-15"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">1001</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-16" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-16"></a><span class="n">nvals</span> <span class="o">=</span> <span class="mi">20</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-17" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-17"></a><span class="n">nvecs</span> <span class="o">=</span> <span class="mi">4</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-18" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-18"></a><span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">beam_FDM_eigs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-19" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-19"></a>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-20" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-20"></a><span class="c">#%% Plotting</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-21" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-21"></a><span class="n">num</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">nvals</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-22" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-22"></a><span class="c"># Missing line for setting the math font</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-23" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-23"></a><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-24" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-24"></a><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-25" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-25"></a><span class="n">plot</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">sqrt</span><span class="o">.</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">nvals</span><span class="p">]),</span> <span class="s">"o"</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-26" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-26"></a><span class="n">xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">"</span><span class="si">$N</span><span class="s">$"</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-27" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-27"></a><span class="n">ylabel</span><span class="p">(</span><span class="sa">L</span><span class="s">"$\omega\sqrt{</span><span class="se">\f</span><span class="s">rac{\lambda}{EI}}$"</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-28" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-28"></a><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-29" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-29"></a><span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">nvecs</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-30" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-30"></a>    <span class="n">vec</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-31" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-31"></a>    <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vecs</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-32" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-32"></a>    <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"n=</span><span class="si">$</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="s">"</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-33" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-33"></a><span class="k">end</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-34" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-34"></a>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-35" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-35"></a><span class="n">xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">"</span><span class="si">$x</span><span class="s">$"</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-36" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-36"></a><span class="n">ylabel</span><span class="p">(</span><span class="sa">L</span><span class="s">"</span><span class="si">$w</span><span class="s">$"</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-37" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-37"></a><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-38" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-38"></a><span class="n">tight_layout</span><span class="p">()</span>
<a id="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-39" name="rest_code_7a21ebea078d44bf9c3a56d6f7890c8a-39"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>Both have (almost) the same result, as follows</p>
<img alt="Vibration modes of an encastred beam." class="align-center" src="images/beam_modes.svg" style="width: 800px;"></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 40 in Python and 39 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_9e28c37572b24d41a45e296fa4f8e348-1" name="rest_code_9e28c37572b24d41a45e296fa4f8e348-1"></a><span class="o">%</span><span class="k">timeit</span> beam_FDM_eigs(1.0, N)
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_e7dc58f704b24c6eb912398b04327328-1" name="rest_code_e7dc58f704b24c6eb912398b04327328-1"></a>10 loops, best of 3: 196 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_022f627f23bb43a48e609671e25dbed5-1" name="rest_code_022f627f23bb43a48e609671e25dbed5-1"></a><span class="nd">@benchmark</span> <span class="n">beam_FDM_eigs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-1" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-2" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">99.42</span> <span class="n">MiB</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-3" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">55</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-4" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-4"></a>  <span class="o">--------------</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-5" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">665.152</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">17.14</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-6" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">775.441</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">21.76</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-7" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">853.401</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">16.86</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-8" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">1.236</span> <span class="n">s</span> <span class="p">(</span><span class="mf">15.68</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-9" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-9"></a>  <span class="o">--------------</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-10" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">6</span>
<a id="rest_code_2ad46a2d799b46eaa964eac5148999a3-11" name="rest_code_2ad46a2d799b46eaa964eac5148999a3-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 4 times faster than
Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-21/" class="u-url">Numerical methods challenge: Day 21</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-21/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-21T14:57:55-05:00" title="2017-10-21 14:57">2017-10-21 14:57</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-21/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-21.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="jacobi-iteration"><h2>Jacobi iteration</h2>
<p>Today we have a <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_difference_method">Finite difference method</a>
combined with <a class="reference external" href="https://en.wikipedia.org/wiki/Jacobi_method">Jacobi method</a>
We are solving the Laplace equation.</p>
<div class="math">
\begin{equation*}
\nabla^ 2 u = 0
\end{equation*}
</div>
<p>with</p>
<div class="math">
\begin{align*}
u(0, y) = 1 -y,\quad u(x, 0) = 1 - x,\\
u(1, y) = u(x, 1) = 0
\end{align*}
</div>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_6150b6d14a9d4709a908b9227d87beca-1" name="rest_code_6150b6d14a9d4709a908b9227d87beca-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-2" name="rest_code_6150b6d14a9d4709a908b9227d87beca-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-3" name="rest_code_6150b6d14a9d4709a908b9227d87beca-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-4" name="rest_code_6150b6d14a9d4709a908b9227d87beca-4"></a>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-5" name="rest_code_6150b6d14a9d4709a908b9227d87beca-5"></a>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-6" name="rest_code_6150b6d14a9d4709a908b9227d87beca-6"></a><span class="k">def</span> <span class="nf">jacobi</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-7" name="rest_code_6150b6d14a9d4709a908b9227d87beca-7"></a>    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-8" name="rest_code_6150b6d14a9d4709a908b9227d87beca-8"></a>        <span class="n">u_new</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-9" name="rest_code_6150b6d14a9d4709a908b9227d87beca-9"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u_new</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-10" name="rest_code_6150b6d14a9d4709a908b9227d87beca-10"></a>            <span class="k">break</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-11" name="rest_code_6150b6d14a9d4709a908b9227d87beca-11"></a>        <span class="k">else</span><span class="p">:</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-12" name="rest_code_6150b6d14a9d4709a908b9227d87beca-12"></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-13" name="rest_code_6150b6d14a9d4709a908b9227d87beca-13"></a>    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">n</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-14" name="rest_code_6150b6d14a9d4709a908b9227d87beca-14"></a>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-15" name="rest_code_6150b6d14a9d4709a908b9227d87beca-15"></a>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-16" name="rest_code_6150b6d14a9d4709a908b9227d87beca-16"></a><span class="k">def</span> <span class="nf">heat_FDM</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-17" name="rest_code_6150b6d14a9d4709a908b9227d87beca-17"></a>    <span class="n">u_new</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-18" name="rest_code_6150b6d14a9d4709a908b9227d87beca-18"></a>    <span class="n">u_new</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">u_new</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u_new</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>\
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-19" name="rest_code_6150b6d14a9d4709a908b9227d87beca-19"></a>         <span class="n">u_new</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">u_new</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:])</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-20" name="rest_code_6150b6d14a9d4709a908b9227d87beca-20"></a>    <span class="k">return</span> <span class="n">u_new</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-21" name="rest_code_6150b6d14a9d4709a908b9227d87beca-21"></a>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-22" name="rest_code_6150b6d14a9d4709a908b9227d87beca-22"></a>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-23" name="rest_code_6150b6d14a9d4709a908b9227d87beca-23"></a><span class="n">nx</span> <span class="o">=</span> <span class="mi">50</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-24" name="rest_code_6150b6d14a9d4709a908b9227d87beca-24"></a><span class="n">ny</span> <span class="o">=</span> <span class="mi">50</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-25" name="rest_code_6150b6d14a9d4709a908b9227d87beca-25"></a><span class="n">x_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-26" name="rest_code_6150b6d14a9d4709a908b9227d87beca-26"></a><span class="n">y_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-27" name="rest_code_6150b6d14a9d4709a908b9227d87beca-27"></a><span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-28" name="rest_code_6150b6d14a9d4709a908b9227d87beca-28"></a><span class="n">u0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x_vec</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-29" name="rest_code_6150b6d14a9d4709a908b9227d87beca-29"></a><span class="n">u0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y_vec</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-30" name="rest_code_6150b6d14a9d4709a908b9227d87beca-30"></a><span class="n">nvec</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">]</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-31" name="rest_code_6150b6d14a9d4709a908b9227d87beca-31"></a><span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">niter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nvec</span><span class="p">):</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-32" name="rest_code_6150b6d14a9d4709a908b9227d87beca-32"></a>    <span class="n">u</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">jacobi</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">heat_FDM</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="n">niter</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-33" name="rest_code_6150b6d14a9d4709a908b9227d87beca-33"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-34" name="rest_code_6150b6d14a9d4709a908b9227d87beca-34"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'hot'</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-35" name="rest_code_6150b6d14a9d4709a908b9227d87beca-35"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-36" name="rest_code_6150b6d14a9d4709a908b9227d87beca-36"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$y$"</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-37" name="rest_code_6150b6d14a9d4709a908b9227d87beca-37"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1"> iterations'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-38" name="rest_code_6150b6d14a9d4709a908b9227d87beca-38"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'image'</span><span class="p">)</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-39" name="rest_code_6150b6d14a9d4709a908b9227d87beca-39"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="rest_code_6150b6d14a9d4709a908b9227d87beca-40" name="rest_code_6150b6d14a9d4709a908b9227d87beca-40"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_5c1abf0313404709af694f90a7a780b9-1" name="rest_code_5c1abf0313404709af694f90a7a780b9-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-2" name="rest_code_5c1abf0313404709af694f90a7a780b9-2"></a>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-3" name="rest_code_5c1abf0313404709af694f90a7a780b9-3"></a>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-4" name="rest_code_5c1abf0313404709af694f90a7a780b9-4"></a><span class="k">function</span> <span class="n">jacobi</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">update</span><span class="p">;</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-5" name="rest_code_5c1abf0313404709af694f90a7a780b9-5"></a>    <span class="n">num</span> <span class="o">=</span> <span class="n">niter</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-6" name="rest_code_5c1abf0313404709af694f90a7a780b9-6"></a>    <span class="k">for</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">niter</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-7" name="rest_code_5c1abf0313404709af694f90a7a780b9-7"></a>        <span class="n">u_new</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-8" name="rest_code_5c1abf0313404709af694f90a7a780b9-8"></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">u_new</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-9" name="rest_code_5c1abf0313404709af694f90a7a780b9-9"></a>            <span class="n">num</span> <span class="o">=</span> <span class="n">n</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-10" name="rest_code_5c1abf0313404709af694f90a7a780b9-10"></a>            <span class="k">break</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-11" name="rest_code_5c1abf0313404709af694f90a7a780b9-11"></a>        <span class="k">else</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-12" name="rest_code_5c1abf0313404709af694f90a7a780b9-12"></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">u_new</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-13" name="rest_code_5c1abf0313404709af694f90a7a780b9-13"></a>        <span class="k">end</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-14" name="rest_code_5c1abf0313404709af694f90a7a780b9-14"></a>    <span class="k">end</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-15" name="rest_code_5c1abf0313404709af694f90a7a780b9-15"></a>    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">num</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-16" name="rest_code_5c1abf0313404709af694f90a7a780b9-16"></a><span class="k">end</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-17" name="rest_code_5c1abf0313404709af694f90a7a780b9-17"></a>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-18" name="rest_code_5c1abf0313404709af694f90a7a780b9-18"></a>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-19" name="rest_code_5c1abf0313404709af694f90a7a780b9-19"></a><span class="k">function</span> <span class="n">heat_FDM</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-20" name="rest_code_5c1abf0313404709af694f90a7a780b9-20"></a>    <span class="n">u_new</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-21" name="rest_code_5c1abf0313404709af694f90a7a780b9-21"></a>    <span class="n">u_new</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">u_new</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-22" name="rest_code_5c1abf0313404709af694f90a7a780b9-22"></a>        <span class="n">u_new</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="k">end</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u_new</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">u_new</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-23" name="rest_code_5c1abf0313404709af694f90a7a780b9-23"></a>    <span class="k">return</span> <span class="n">u_new</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-24" name="rest_code_5c1abf0313404709af694f90a7a780b9-24"></a><span class="k">end</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-25" name="rest_code_5c1abf0313404709af694f90a7a780b9-25"></a>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-26" name="rest_code_5c1abf0313404709af694f90a7a780b9-26"></a>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-27" name="rest_code_5c1abf0313404709af694f90a7a780b9-27"></a><span class="n">nx</span> <span class="o">=</span> <span class="mi">50</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-28" name="rest_code_5c1abf0313404709af694f90a7a780b9-28"></a><span class="n">ny</span> <span class="o">=</span> <span class="mi">50</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-29" name="rest_code_5c1abf0313404709af694f90a7a780b9-29"></a><span class="n">x_vec</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-30" name="rest_code_5c1abf0313404709af694f90a7a780b9-30"></a><span class="n">y_vec</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-31" name="rest_code_5c1abf0313404709af694f90a7a780b9-31"></a><span class="n">u0</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-32" name="rest_code_5c1abf0313404709af694f90a7a780b9-32"></a><span class="n">u0</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x_vec</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-33" name="rest_code_5c1abf0313404709af694f90a7a780b9-33"></a><span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y_vec</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-34" name="rest_code_5c1abf0313404709af694f90a7a780b9-34"></a><span class="n">nvec</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">]</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-35" name="rest_code_5c1abf0313404709af694f90a7a780b9-35"></a><span class="k">for</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">niter</span><span class="p">)</span> <span class="o">=</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">nvec</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-36" name="rest_code_5c1abf0313404709af694f90a7a780b9-36"></a>    <span class="n">u</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">jacobi</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">heat_FDM</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="n">niter</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-37" name="rest_code_5c1abf0313404709af694f90a7a780b9-37"></a>    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-38" name="rest_code_5c1abf0313404709af694f90a7a780b9-38"></a>    <span class="n">contourf</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"hot"</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-39" name="rest_code_5c1abf0313404709af694f90a7a780b9-39"></a>    <span class="n">xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">"</span><span class="si">$x</span><span class="s">$"</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-40" name="rest_code_5c1abf0313404709af694f90a7a780b9-40"></a>    <span class="n">ylabel</span><span class="p">(</span><span class="sa">L</span><span class="s">"</span><span class="si">$y</span><span class="s">$"</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-41" name="rest_code_5c1abf0313404709af694f90a7a780b9-41"></a>    <span class="n">title</span><span class="p">(</span><span class="s">"</span><span class="si">$</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="s"> iterations"</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-42" name="rest_code_5c1abf0313404709af694f90a7a780b9-42"></a>    <span class="n">axis</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-43" name="rest_code_5c1abf0313404709af694f90a7a780b9-43"></a><span class="k">end</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-44" name="rest_code_5c1abf0313404709af694f90a7a780b9-44"></a><span class="n">tight_layout</span><span class="p">()</span>
<a id="rest_code_5c1abf0313404709af694f90a7a780b9-45" name="rest_code_5c1abf0313404709af694f90a7a780b9-45"></a><span class="n">show</span><span class="p">()</span>
</pre>
<img alt="Solution of the differential equation that satisfy the boundary conditions." class="align-center" src="images/jacobi_heat.svg" style="width: 600px;"></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 40 in Python and 45 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_ad5a0c721880475186d255a3fd63e3fb-1" name="rest_code_ad5a0c721880475186d255a3fd63e3fb-1"></a><span class="o">%</span><span class="k">timeit</span> jacobi(u0, heat_FDM, tol=1e-12, niter=1000)
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_272a3c6a4ab4441daa2179452f4b7699-1" name="rest_code_272a3c6a4ab4441daa2179452f4b7699-1"></a>10 loops, best of 3: 29.6 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_03964ae5575949498d2d4ef7153ea0be-1" name="rest_code_03964ae5575949498d2d4ef7153ea0be-1"></a><span class="nd">@benchmark</span> <span class="n">jacobi</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">heat_FDM</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-1" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-2" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">247.89</span> <span class="n">MiB</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-3" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">43002</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-4" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-4"></a>  <span class="o">--------------</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-5" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">196.943</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">5.66</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-6" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">203.230</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">5.74</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-7" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">203.060</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">6.01</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-8" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">208.017</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">5.51</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-9" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-9"></a>  <span class="o">--------------</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-10" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">25</span>
<a id="rest_code_4257a396bd2b4c77a592d49f3dc1986e-11" name="rest_code_4257a396bd2b4c77a592d49f3dc1986e-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 10 times faster than
Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-20/" class="u-url">Numerical methods challenge: Day 20</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-20/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-20T20:10:43-05:00" title="2017-10-20 20:10">2017-10-20 20:10</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-20/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-20.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="shooting-method"><h2>Shooting method</h2>
<p>Today we have the <a class="reference external" href="https://en.wikipedia.org/wiki/Shooting_method">shooting method</a>.
This is a method for solving boundary value problems by turning them into
a sequence of initial value problems.</p>
<p>Loosely speaking, for a second order equation we have</p>
<div class="math">
\begin{equation*}
y''(x) = f(x, y(x), y'(x)),\quad y(x_0) = y_0,\quad y(x_1) = y_1\, ,
\end{equation*}
</div>
<p>and we solve the sequence of problems</p>
<div class="math">
\begin{equation*}
y''(x) = f(x, y(x), y'(x)),\quad y(x_0) = y_0,\quad y'(x_0) = a
\end{equation*}
</div>
<p>until the function <span class="math">\(F(a) = y(x_1; a) - y_1\)</span> has a root.</p>
<p>We will test the method with the boundary value problem</p>
<div class="math">
\begin{equation*}
y''(x) = \frac{3}{2} y^2,\quad w(0) = 4,\quad w(1) = 1\, .
\end{equation*}
</div>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-1" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-2" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-3" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-4" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-4"></a><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">newton</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-5" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-5"></a><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-6" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-6"></a>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-7" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-7"></a>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-8" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-8"></a><span class="k">def</span> <span class="nf">shooting</span><span class="p">(</span><span class="n">dydx</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">shoot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-9" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-9"></a>    <span class="k">if</span> <span class="n">shoot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-10" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-10"></a>        <span class="n">shoot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-11" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-11"></a>    <span class="n">F</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">odeint</span><span class="p">(</span><span class="n">dydx</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="n">x</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xf</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-12" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-12"></a>    <span class="n">shoot</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">shoot</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-13" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-13"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">dydx</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">shoot</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-14" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-14"></a>    <span class="k">return</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">shoot</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-15" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-15"></a>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-16" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-16"></a>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-17" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-17"></a><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-18" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-18"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-19" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-19"></a><span class="n">y</span><span class="p">,</span> <span class="n">shoot</span> <span class="o">=</span> <span class="n">shooting</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shoot</span><span class="o">=-</span><span class="mi">5</span><span class="p">)</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-20" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-20"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-21" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-21"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">)</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-22" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-22"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$y$"</span><span class="p">)</span>
<a id="rest_code_e7d6b7b420f8474c98cd087211a5ce48-23" name="rest_code_e7d6b7b420f8474c98cd087211a5ce48-23"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-1" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-1"></a><span class="k">using</span> <span class="n">PyPlot</span><span class="p">,</span> <span class="n">DifferentialEquations</span><span class="p">,</span> <span class="n">Roots</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-2" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-2"></a>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-3" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-3"></a>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-4" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-4"></a><span class="k">function</span> <span class="n">shooting</span><span class="p">(</span><span class="n">dydx</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">yf</span><span class="p">;</span> <span class="n">shoot</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-5" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-5"></a>    <span class="k">if</span> <span class="n">shoot</span> <span class="o">==</span> <span class="nb">nothing</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-6" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-6"></a>        <span class="n">shoot</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="o">:</span><span class="mf">0.1</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-7" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-7"></a>    <span class="k">end</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-8" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-8"></a>    <span class="k">function</span> <span class="n">F</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-9" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-9"></a>        <span class="n">prob</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="p">(</span><span class="n">dydx</span><span class="p">,</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="k">end</span><span class="p">]))</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-10" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-10"></a>        <span class="n">sol</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-11" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-11"></a>        <span class="k">return</span> <span class="n">sol</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="k">end</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yf</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-12" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-12"></a>    <span class="k">end</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-13" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-13"></a>    <span class="n">shoot</span> <span class="o">=</span> <span class="n">fzero</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">shoot</span><span class="p">)</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-14" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-14"></a>    <span class="n">prob</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="p">(</span><span class="n">dydx</span><span class="p">,</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">shoot</span><span class="p">],</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="k">end</span><span class="p">]))</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-15" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-15"></a>    <span class="n">sol</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">solveat</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-16" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-16"></a>    <span class="k">return</span> <span class="n">sol</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">shoot</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-17" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-17"></a><span class="k">end</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-18" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-18"></a>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-19" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-19"></a>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-20" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-20"></a><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">]</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-21" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-21"></a><span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-22" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-22"></a><span class="n">y</span><span class="p">,</span> <span class="n">shoot</span> <span class="o">=</span> <span class="n">shooting</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span> <span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">shoot</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">)</span>
<a id="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-23" name="rest_code_1ce42336cd86437aa77d4dc2cbbd21dd-23"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre>
<p>In both cases the result is the following plot, and the slope is
-7.9999999657800833.</p>
<img alt="Solution of the differential equation that satisfy the boundary conditions." class="align-center" src="images/shooting.svg" style="width: 600px;"><p>We should mention that the convergence of the method relies on the selection
of initial guesses. For example, if we choose as initial parameter -50
in the previous problem, we obtain a completely differente solution.</p>
<pre class="code text"><a id="rest_code_bc805ebe18c841cd8648fd67652bf5e5-1" name="rest_code_bc805ebe18c841cd8648fd67652bf5e5-1"></a>y, shoot = shooting(func, x , 4.0, 1.0, shoot=-50.0)
</pre>
<img alt="Solution of the differential equation that satisfy the boundary conditions." class="align-center" src="images/shooting-s-50.svg" style="width: 600px;"><p>And the obtained slope is -35.858547970130971.</p>
</section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 20 in Python and 23 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_89eb4e7f84494b2f9fba9997b902d8b8-1" name="rest_code_89eb4e7f84494b2f9fba9997b902d8b8-1"></a><span class="o">%</span><span class="k">timeit</span> shooting(func, x, 4, 1, shoot=-5)
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_805751aa3bb7473480d5088f8de0fc8b-1" name="rest_code_805751aa3bb7473480d5088f8de0fc8b-1"></a>100 loops, best of 3: 1.9 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_17615b80fe9743558e034f4ff7a95a90-1" name="rest_code_17615b80fe9743558e034f4ff7a95a90-1"></a><span class="nd">@benchmark</span> <span class="n">shooting</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">shoot</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_8bc7c0bba825483ca6107b82e613768c-1" name="rest_code_8bc7c0bba825483ca6107b82e613768c-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-2" name="rest_code_8bc7c0bba825483ca6107b82e613768c-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">4.18</span> <span class="n">MiB</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-3" name="rest_code_8bc7c0bba825483ca6107b82e613768c-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">78552</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-4" name="rest_code_8bc7c0bba825483ca6107b82e613768c-4"></a>  <span class="o">--------------</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-5" name="rest_code_8bc7c0bba825483ca6107b82e613768c-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">10.065</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-6" name="rest_code_8bc7c0bba825483ca6107b82e613768c-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">10.593</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-7" name="rest_code_8bc7c0bba825483ca6107b82e613768c-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">11.769</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-8" name="rest_code_8bc7c0bba825483ca6107b82e613768c-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">22.252</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">48.58</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-9" name="rest_code_8bc7c0bba825483ca6107b82e613768c-9"></a>  <span class="o">--------------</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-10" name="rest_code_8bc7c0bba825483ca6107b82e613768c-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">425</span>
<a id="rest_code_8bc7c0bba825483ca6107b82e613768c-11" name="rest_code_8bc7c0bba825483ca6107b82e613768c-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 5 times faster than
Julia. Although, the codes are more different than in the other challenges.
For example, I am not using <code class="docutils literal">newton</code> in Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-19/" class="u-url">Numerical methods challenge: Day 19</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-19/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-19T15:24:57-05:00" title="2017-10-19 15:24">2017-10-19 15:24</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-19/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-19.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="verlet-integration"><h2>Verlet integration</h2>
<p>Today we have the <a class="reference external" href="https://en.wikipedia.org/wiki/Verlet_integration">Verlet integration</a>
technique. This method is widely used to integrate equations of motion of
several systems, such as orbital mechanics or molecular dynamics. One of the
main reasons for choosing this method is that it is a
<a class="reference external" href="https://en.wikipedia.org/wiki/Symplectic_integrator">symplectic integrator</a>.</p>
<p>The stepping is done with the formula</p>
<div class="math">
\begin{equation*}
\mathbf{x}_{n+1}=2 \mathbf{x}_n- \mathbf{x}_{n-1}+ A(\mathbf{x}_n)\,\Delta t^2.
\end{equation*}
</div>
<p>where <span class="math">\(A(\mathbf{x}_n)\)</span> is the aceleration for that time-step.</p>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-1" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-2" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-3" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-4" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-4"></a>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-5" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-5"></a>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-6" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-6"></a><span class="k">def</span> <span class="nf">verlet</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-7" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-7"></a>    <span class="n">ndof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-8" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-8"></a>    <span class="n">ntimes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-9" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-9"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ndof</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">))</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-10" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-10"></a>    <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-11" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-11"></a>    <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-12" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-12"></a>    <span class="n">F</span> <span class="o">=</span> <span class="n">force</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-13" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-13"></a>    <span class="n">x</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">v0</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">F</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">m</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-14" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-14"></a>    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">v0</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">m</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-15" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-15"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">):</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-16" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-16"></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-17" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-17"></a>        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">dt</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-18" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-18"></a>        <span class="n">acel</span> <span class="o">=</span> <span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-19" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-19"></a>        <span class="n">acel</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">acel</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">m</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-20" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-20"></a>        <span class="n">acel</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">acel</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">m</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-21" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-21"></a>        <span class="n">x</span><span class="p">[:,</span> <span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">acel</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-22" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-22"></a>    <span class="k">return</span> <span class="n">x</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-23" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-23"></a>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-24" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-24"></a>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-25" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-25"></a><span class="n">spring_force</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-26" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-26"></a><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-27" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-27"></a><span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-28" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-28"></a><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">])</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-29" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-29"></a><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-30" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-30"></a><span class="n">k</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-31" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-31"></a><span class="n">x</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="n">spring_force</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="p">,))</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-32" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-32"></a>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-33" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-33"></a><span class="c1">#%% Plot</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-34" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-34"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-35" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-35"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-36" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-36"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-37" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-37"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-38" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-38"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-39" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-39"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
<a id="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-40" name="rest_code_ac98a58ff5b34397a5aa47f6fefada6e-40"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-1" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-2" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-2"></a>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-3" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-3"></a>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-4" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-4"></a><span class="k">function</span> <span class="n">verlet</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-5" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-5"></a>    <span class="n">ndof</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-6" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-6"></a>    <span class="n">ntimes</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-7" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-7"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">ndof</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">)</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-8" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-8"></a>    <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-9" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-9"></a>    <span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-10" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-10"></a>    <span class="n">F</span> <span class="o">=</span> <span class="n">force</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">...</span><span class="p">)</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-11" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-11"></a>    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">+</span> <span class="n">v0</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">^</span><span class="mf">2.</span><span class="o">/</span><span class="n">m</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-12" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-12"></a>    <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">+</span> <span class="n">v0</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">^</span><span class="mf">2.</span><span class="o">/</span><span class="n">m</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-13" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-13"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">3</span><span class="o">:</span><span class="n">ntimes</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-14" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-14"></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-15" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-15"></a>        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">dt</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-16" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-16"></a>        <span class="n">acel</span> <span class="o">=</span> <span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">...</span><span class="p">)</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-17" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-17"></a>        <span class="n">acel</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">acel</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">./</span><span class="n">m</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-18" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-18"></a>        <span class="n">acel</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">acel</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">./</span><span class="n">m</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-19" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-19"></a>        <span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">acel</span><span class="o">*</span><span class="n">dt</span><span class="o">^</span><span class="mi">2</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-20" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-20"></a>    <span class="k">end</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-21" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-21"></a>    <span class="k">return</span> <span class="n">x</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-22" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-22"></a><span class="k">end</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-23" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-23"></a>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-24" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-24"></a>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-25" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-25"></a><span class="n">spring_force</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-26" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-26"></a><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-27" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-27"></a><span class="n">v0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-28" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-28"></a><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-29" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-29"></a><span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-30" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-30"></a><span class="n">k</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-31" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-31"></a><span class="n">x</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="n">spring_force</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="p">,))</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-32" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-32"></a>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-33" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-33"></a><span class="c">#%% Plot</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-34" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-34"></a><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-35" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-35"></a><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-36" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-36"></a><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-37" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-37"></a><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-38" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-38"></a><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-39" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-39"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span>
<a id="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-40" name="rest_code_a9172d911bac4ac09cfeaf8658ebf50a-40"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>In both cases the result is the following plot</p>
<img alt="Verlet integration for a mass with two orthogonal springs." class="align-center" src="images/verlet.svg" style="width: 600px;"></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 40 in Python and 40 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_0b97bab6b5b74dadb1e161404994cd7c-1" name="rest_code_0b97bab6b5b74dadb1e161404994cd7c-1"></a><span class="o">%</span><span class="k">timeit</span> -n 100 verlet(spring_force, x0, v0, m, t, args=(k,))
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_66aa6394861e4bc8af3be7c6b3d190db-1" name="rest_code_66aa6394861e4bc8af3be7c6b3d190db-1"></a>100 loops, best of 3: 26.5 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_da5ad5304ce843fbaa2dd350800732be-1" name="rest_code_da5ad5304ce843fbaa2dd350800732be-1"></a><span class="nd">@benchmark</span> <span class="n">verlet</span><span class="p">(</span><span class="n">spring_force</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="p">,))</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-1" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-2" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">4.36</span> <span class="n">MiB</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-3" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">101839</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-4" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-4"></a>  <span class="o">--------------</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-5" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">73.159</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-6" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">74.883</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-7" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">75.464</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">1.02</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-8" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">80.017</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">4.87</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-9" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-9"></a>  <span class="o">--------------</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-10" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">67</span>
<a id="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-11" name="rest_code_b95edf25fc934d50b2a8dae7cd0de9ac-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 3 times faster than Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-18/" class="u-url">Numerical methods challenge: Day 18</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-18/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-18T19:58:37-05:00" title="2017-10-18 19:58">2017-10-18 19:58</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-18/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-18.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="the-runke-kutta"><h2>
<em>The</em> Runke-Kutta</h2>
<p>Today we have <em>the</em> <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta method</a>.
This is the most popular Runge-Kutta out there, and it used a weighted average
of four (smaller) increments.</p>
<p>The increments are done with the formula</p>
<div class="math">
\begin{equation*}
y_{n+1} = y_n + \tfrac{h}{6}\left(k_1 + 2k_2 + 2k_3 + k_4 \right)
\end{equation*}
</div>
<p>where</p>
<div class="math">
\begin{align*}
k_1 &amp;= f(t_n, y_n), \\
k_2 &amp;= f\left(t_n + \frac{h}{2}, y_n + \frac{h}{2}k_1\right), \\
k_3 &amp;= f\left(t_n + \frac{h}{2}, y_n + \frac{h}{2}k_2\right), \\
k_4 &amp;= f\left(t_n + h, y_n + h k_3\right).
\end{align*}
</div>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-1" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-2" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-3" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-4" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-4"></a>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-5" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-5"></a>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-6" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-6"></a><span class="k">def</span> <span class="nf">RK4</span><span class="p">(</span><span class="n">dydt</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-7" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-7"></a>    <span class="n">ndof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-8" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-8"></a>    <span class="n">ntimes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-9" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-9"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ndof</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">))</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-10" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-10"></a>    <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-11" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-11"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">):</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-12" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-12"></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-13" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-13"></a>        <span class="n">k1</span> <span class="o">=</span> <span class="n">dydt</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-14" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-14"></a>        <span class="n">k2</span> <span class="o">=</span> <span class="n">dydt</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-15" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-15"></a>        <span class="n">k3</span> <span class="o">=</span> <span class="n">dydt</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">k2</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-16" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-16"></a>        <span class="n">k4</span> <span class="o">=</span> <span class="n">dydt</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">k3</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-17" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-17"></a>        <span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">/</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-18" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-18"></a>    <span class="k">return</span> <span class="n">y</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-19" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-19"></a>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-20" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-20"></a>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-21" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-21"></a><span class="k">def</span> <span class="nf">pend</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-22" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-22"></a>    <span class="n">theta</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">y</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-23" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-23"></a>    <span class="n">dydt</span> <span class="o">=</span> <span class="p">[</span><span class="n">omega</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">omega</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-24" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-24"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dydt</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-25" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-25"></a>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-26" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-26"></a>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-27" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-27"></a><span class="n">b</span> <span class="o">=</span> <span class="mf">0.25</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-28" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-28"></a><span class="n">c</span> <span class="o">=</span> <span class="mf">5.0</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-29" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-29"></a><span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-30" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-30"></a><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-31" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-31"></a><span class="n">y</span> <span class="o">=</span> <span class="n">RK4</span><span class="p">(</span><span class="n">pend</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-32" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-32"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-33" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-33"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-34" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-34"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$t$"</span><span class="p">)</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-35" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-35"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="sa">r</span><span class="s2">"$\theta(t)$"</span><span class="p">,</span> <span class="sa">r</span><span class="s2">"$\omega(t)$"</span><span class="p">])</span>
<a id="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-36" name="rest_code_76d6c5a3e5cb4b118bbd527693c4b20a-36"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-1" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-2" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-2"></a>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-3" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-3"></a>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-4" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-4"></a><span class="k">function</span> <span class="n">euler</span><span class="p">(</span><span class="n">dydt</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-5" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-5"></a>    <span class="n">ndof</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-6" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-6"></a>    <span class="n">ntimes</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-7" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-7"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">ndof</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">)</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-8" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-8"></a>    <span class="n">y</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-9" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-9"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">ntimes</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-10" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-10"></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-11" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-11"></a>        <span class="n">y</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">dydt</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="n">args</span><span class="o">...</span><span class="p">)</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-12" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-12"></a>    <span class="k">end</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-13" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-13"></a>    <span class="k">return</span> <span class="n">y</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-14" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-14"></a><span class="k">end</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-15" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-15"></a>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-16" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-16"></a>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-17" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-17"></a><span class="k">function</span> <span class="n">pend</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-18" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-18"></a>    <span class="n">theta</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">y</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-19" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-19"></a>    <span class="n">dydt</span> <span class="o">=</span> <span class="p">[</span><span class="n">omega</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">omega</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-20" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-20"></a>    <span class="k">return</span> <span class="n">dydt</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-21" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-21"></a><span class="k">end</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-22" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-22"></a>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-23" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-23"></a>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-24" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-24"></a><span class="n">b</span> <span class="o">=</span> <span class="mf">0.25</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-25" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-25"></a><span class="n">c</span> <span class="o">=</span> <span class="mf">5.0</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-26" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-26"></a><span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">pi</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-27" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-27"></a><span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-28" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-28"></a><span class="n">y</span> <span class="o">=</span> <span class="n">euler</span><span class="p">(</span><span class="n">pend</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-29" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-29"></a><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-30" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-30"></a><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-31" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-31"></a><span class="n">xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">"</span><span class="si">$t</span><span class="s">$"</span><span class="p">)</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-32" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-32"></a><span class="n">legend</span><span class="p">([</span><span class="sa">L</span><span class="s">"$</span><span class="se">\t</span><span class="s">heta(t)$"</span><span class="p">,</span> <span class="sa">L</span><span class="s">"$\omega(t)$"</span><span class="p">])</span>
<a id="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-33" name="rest_code_cdfe99cb9bba450b8a04c6d45585e0e2-33"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>In both cases the result is the following plot</p>
<img alt="Solution for a pendulum using Runge-Kutta method." class="align-center" src="images/RK4.svg" style="width: 500px;"></section><section id="comparison-euler-runge-kutta"><h3>Comparison Euler/Runge-Kutta</h3>
<p>If we compare Euler and Runge-Kutta methods for the previous example using
101 timesteps, 10 times less than before, we obtain
the results below. The upper one is the one obtained with Euler method.
We can see that the result is not the same. We can (loosely) say that
we need less steps in Runge-Kutta method than in Euler method.</p>
<img alt="Comparison: Euler method." class="align-center" src="images/euler-101.svg" style="width: 500px;"><img alt="Comparison: Runge-Kutta method." class="align-center" src="images/RK4-101.svg" style="width: 500px;"></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 36 in Python and 37 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_29a73149758d4b4d9543e18d127f8bb4-1" name="rest_code_29a73149758d4b4d9543e18d127f8bb4-1"></a><span class="o">%</span><span class="k">timeit</span> RK4(pend, y0, t, args=(b, c))
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_8749c6f475694051ac42e38ce1b4e556-1" name="rest_code_8749c6f475694051ac42e38ce1b4e556-1"></a>100 loops, best of 3: 7.62 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_ce15d0aa4a7b4c0898c040c7afd71809-1" name="rest_code_ce15d0aa4a7b4c0898c040c7afd71809-1"></a><span class="nd">@benchmark</span> <span class="n">RK4</span><span class="p">(</span><span class="n">pend</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-1" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-2" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">255.09</span> <span class="n">KiB</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-3" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">5205</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-4" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-4"></a>  <span class="o">--------------</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-5" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">152.881</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-6" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">159.939</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-7" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">202.514</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">16.55</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-8" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">3.785</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">91.79</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-9" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-9"></a>  <span class="o">--------------</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-10" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a id="rest_code_bd2aecea5b064a75b24fc86976b1839a-11" name="rest_code_bd2aecea5b064a75b24fc86976b1839a-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 50 times slower than Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-17/" class="u-url">Numerical methods challenge: Day 17</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-17/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-17T16:29:05-05:00" title="2017-10-17 16:29">2017-10-17 16:29</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-17/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-17.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="euler-method"><h2>Euler method</h2>
<p>Today we have the <a class="reference external" href="https://en.wikipedia.org/wiki/Euler_method">Euler method</a>.
Which is the simplest of <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_method">Runge-Kutta methods</a>, and was named after
Leonhard Euler who used in the 18th century.</p>
<p>The method consist in making updates of the function using the slope
value with the formula</p>
<div class="math">
\begin{equation*}
y_{n + 1} = y_n + hf(t_n, y_n)
\end{equation*}
</div>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_132ece34a362423cbb5695de3c05ea2c-1" name="rest_code_132ece34a362423cbb5695de3c05ea2c-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-2" name="rest_code_132ece34a362423cbb5695de3c05ea2c-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-3" name="rest_code_132ece34a362423cbb5695de3c05ea2c-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-4" name="rest_code_132ece34a362423cbb5695de3c05ea2c-4"></a>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-5" name="rest_code_132ece34a362423cbb5695de3c05ea2c-5"></a>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-6" name="rest_code_132ece34a362423cbb5695de3c05ea2c-6"></a><span class="k">def</span> <span class="nf">euler</span><span class="p">(</span><span class="n">dydt</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-7" name="rest_code_132ece34a362423cbb5695de3c05ea2c-7"></a>    <span class="n">ndof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-8" name="rest_code_132ece34a362423cbb5695de3c05ea2c-8"></a>    <span class="n">ntimes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-9" name="rest_code_132ece34a362423cbb5695de3c05ea2c-9"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ndof</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">))</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-10" name="rest_code_132ece34a362423cbb5695de3c05ea2c-10"></a>    <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-11" name="rest_code_132ece34a362423cbb5695de3c05ea2c-11"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">):</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-12" name="rest_code_132ece34a362423cbb5695de3c05ea2c-12"></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-13" name="rest_code_132ece34a362423cbb5695de3c05ea2c-13"></a>        <span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">dydt</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-14" name="rest_code_132ece34a362423cbb5695de3c05ea2c-14"></a>    <span class="k">return</span> <span class="n">y</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-15" name="rest_code_132ece34a362423cbb5695de3c05ea2c-15"></a>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-16" name="rest_code_132ece34a362423cbb5695de3c05ea2c-16"></a>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-17" name="rest_code_132ece34a362423cbb5695de3c05ea2c-17"></a><span class="k">def</span> <span class="nf">pend</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-18" name="rest_code_132ece34a362423cbb5695de3c05ea2c-18"></a>    <span class="n">theta</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">y</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-19" name="rest_code_132ece34a362423cbb5695de3c05ea2c-19"></a>    <span class="n">dydt</span> <span class="o">=</span> <span class="p">[</span><span class="n">omega</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">omega</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-20" name="rest_code_132ece34a362423cbb5695de3c05ea2c-20"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dydt</span><span class="p">)</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-21" name="rest_code_132ece34a362423cbb5695de3c05ea2c-21"></a>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-22" name="rest_code_132ece34a362423cbb5695de3c05ea2c-22"></a>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-23" name="rest_code_132ece34a362423cbb5695de3c05ea2c-23"></a><span class="n">b</span> <span class="o">=</span> <span class="mf">0.25</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-24" name="rest_code_132ece34a362423cbb5695de3c05ea2c-24"></a><span class="n">c</span> <span class="o">=</span> <span class="mf">5.0</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-25" name="rest_code_132ece34a362423cbb5695de3c05ea2c-25"></a><span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-26" name="rest_code_132ece34a362423cbb5695de3c05ea2c-26"></a><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10001</span><span class="p">)</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-27" name="rest_code_132ece34a362423cbb5695de3c05ea2c-27"></a><span class="n">y</span> <span class="o">=</span> <span class="n">euler</span><span class="p">(</span><span class="n">pend</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-28" name="rest_code_132ece34a362423cbb5695de3c05ea2c-28"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-29" name="rest_code_132ece34a362423cbb5695de3c05ea2c-29"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-30" name="rest_code_132ece34a362423cbb5695de3c05ea2c-30"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$t$"</span><span class="p">)</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-31" name="rest_code_132ece34a362423cbb5695de3c05ea2c-31"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="sa">r</span><span class="s2">"$\theta(t)$"</span><span class="p">,</span> <span class="sa">r</span><span class="s2">"$\omega(t)$"</span><span class="p">])</span>
<a id="rest_code_132ece34a362423cbb5695de3c05ea2c-32" name="rest_code_132ece34a362423cbb5695de3c05ea2c-32"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-1" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-2" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-2"></a>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-3" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-3"></a>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-4" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-4"></a><span class="k">function</span> <span class="n">euler</span><span class="p">(</span><span class="n">dydt</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-5" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-5"></a>    <span class="n">ndof</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-6" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-6"></a>    <span class="n">ntimes</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-7" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-7"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">ndof</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">)</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-8" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-8"></a>    <span class="n">y</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-9" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-9"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">ntimes</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-10" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-10"></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-11" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-11"></a>        <span class="n">y</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">dydt</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">cont</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="n">args</span><span class="o">...</span><span class="p">)</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-12" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-12"></a>    <span class="k">end</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-13" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-13"></a>    <span class="k">return</span> <span class="n">y</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-14" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-14"></a><span class="k">end</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-15" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-15"></a>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-16" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-16"></a>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-17" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-17"></a><span class="k">function</span> <span class="n">pend</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-18" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-18"></a>    <span class="n">theta</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">y</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-19" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-19"></a>    <span class="n">dydt</span> <span class="o">=</span> <span class="p">[</span><span class="n">omega</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">omega</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-20" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-20"></a>    <span class="k">return</span> <span class="n">dydt</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-21" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-21"></a><span class="k">end</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-22" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-22"></a>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-23" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-23"></a>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-24" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-24"></a><span class="n">b</span> <span class="o">=</span> <span class="mf">0.25</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-25" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-25"></a><span class="n">c</span> <span class="o">=</span> <span class="mf">5.0</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-26" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-26"></a><span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">pi</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-27" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-27"></a><span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-28" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-28"></a><span class="n">y</span> <span class="o">=</span> <span class="n">euler</span><span class="p">(</span><span class="n">pend</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-29" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-29"></a><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-30" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-30"></a><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-31" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-31"></a><span class="n">xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">"</span><span class="si">$t</span><span class="s">$"</span><span class="p">)</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-32" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-32"></a><span class="n">legend</span><span class="p">([</span><span class="sa">L</span><span class="s">"$</span><span class="se">\t</span><span class="s">heta(t)$"</span><span class="p">,</span> <span class="sa">L</span><span class="s">"$\omega(t)$"</span><span class="p">])</span>
<a id="rest_code_ccf0ea63123a40a9b9f0057112b28a72-33" name="rest_code_ccf0ea63123a40a9b9f0057112b28a72-33"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>In both cases the result is the following plot</p>
<img alt="Solution for a pendulum using Euler method." class="align-center" src="images/euler.svg" style="width: 500px;"></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 32 in Python and 33 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_cc9ebde07c63462c835c618f294b4476-1" name="rest_code_cc9ebde07c63462c835c618f294b4476-1"></a><span class="o">%</span><span class="k">timeit</span> euler(pend, y0, t, args=(b, c))
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_bb2acf90c97e4d19b7efec09882ba1b7-1" name="rest_code_bb2acf90c97e4d19b7efec09882ba1b7-1"></a>100 loops, best of 3: 18.5 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_229636e2ac7946bab1c2227c5fedb499-1" name="rest_code_229636e2ac7946bab1c2227c5fedb499-1"></a><span class="nd">@benchmark</span> <span class="n">euler</span><span class="p">(</span><span class="n">pend</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-1" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-2" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">648.33</span> <span class="n">KiB</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-3" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">15473</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-4" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-4"></a>  <span class="o">--------------</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-5" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">366.236</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-6" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">399.615</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-7" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">486.364</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">16.96</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-8" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">4.613</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">80.26</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-9" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-9"></a>  <span class="o">--------------</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-10" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a id="rest_code_dd1d2921a0cf40568faaef3af7fac167-11" name="rest_code_dd1d2921a0cf40568faaef3af7fac167-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 40 times slower than Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-16/" class="u-url">Numerical methods challenge: Day 16</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-16/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-17T16:29:00-05:00" title="2017-10-17 16:29">2017-10-17 16:29</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-16/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-16.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="clenshaw-curtis-quadrature"><h2>Clenshaw-Curtis quadrature</h2>
<p>Today we have the <a class="reference external" href="https://en.wikipedia.org/wiki/Clenshaw%E2%80%93Curtis_quadrature">Clenshaw-Curtis quadrature</a>.
This method is based in the expansion of the integrand in
<a class="reference external" href="https://en.wikipedia.org/wiki/Chebyshev_polynomials">Chebyshev polynomials</a>.</p>
<p>We will test the quadrature with the integral</p>
<div class="math">
\begin{equation*}
\int_0^3 e^{-x^2} \mathrm{d}x \approx 0.8862073482595214
\end{equation*}
</div>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-1" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-2" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="nb">sum</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-3" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-3"></a>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-4" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-4"></a>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-5" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-5"></a><span class="k">def</span> <span class="nf">clenshaw_curtis</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-6" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-6"></a>    <span class="n">nodes</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-7" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-7"></a>    <span class="n">jac</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-8" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-8"></a>    <span class="n">tfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">jac</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-9" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-9"></a>    <span class="n">inte</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-10" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-10"></a>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-11" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-11"></a>        <span class="n">coef</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">tfun</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">tfun</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="o">+</span>\
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-12" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-12"></a>            <span class="mi">2</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">tfun</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-13" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-13"></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-14" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-14"></a>            <span class="n">inte</span> <span class="o">+=</span> <span class="n">coef</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-15" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-15"></a>        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="n">N</span><span class="p">:</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-16" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-16"></a>            <span class="n">inte</span> <span class="o">+=</span> <span class="n">coef</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-17" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-17"></a>        <span class="k">else</span><span class="p">:</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-18" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-18"></a>            <span class="n">inte</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">coef</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-19" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-19"></a>    <span class="k">return</span> <span class="n">inte</span><span class="o">*</span><span class="n">jac</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-20" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-20"></a>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-21" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-21"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-22" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-22"></a><span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_a99604040d4a4be6a79e802cd2c02ef8-23" name="rest_code_a99604040d4a4be6a79e802cd2c02ef8-23"></a><span class="nb">print</span><span class="p">(</span><span class="n">clenshaw_curtis</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code python"><a id="rest_code_eed4d22f24734cb099130deb1e512128-1" name="rest_code_eed4d22f24734cb099130deb1e512128-1"></a><span class="mf">0.885906202792</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-1" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-1"></a><span class="k">function</span> <span class="n">clenshaw_curtis</span><span class="p">(</span><span class="n">fun</span><span class="p">;</span> <span class="n">N</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-2" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-2"></a>    <span class="n">nodes</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">pi</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-3" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-3"></a>    <span class="n">jac</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-4" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-4"></a>    <span class="n">tfun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">jac</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-5" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-5"></a>    <span class="n">inte</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-6" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-6"></a>    <span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">N</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-7" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-7"></a>        <span class="n">coef</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">tfun</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">tfun</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-8" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-8"></a>            <span class="mi">2</span><span class="o">*</span><span class="n">sum</span><span class="p">(</span><span class="n">tfun</span><span class="p">(</span><span class="n">cos</span><span class="o">.</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.*</span><span class="n">cos</span><span class="o">.</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-9" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-9"></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-10" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-10"></a>            <span class="n">inte</span> <span class="o">+=</span> <span class="n">coef</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-11" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-11"></a>        <span class="k">elseif</span> <span class="n">k</span> <span class="o">==</span> <span class="n">N</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-12" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-12"></a>            <span class="n">inte</span> <span class="o">+=</span> <span class="n">coef</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">N</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-13" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-13"></a>        <span class="k">else</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-14" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-14"></a>            <span class="n">inte</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">coef</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">k</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-15" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-15"></a>        <span class="k">end</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-16" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-16"></a>    <span class="k">end</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-17" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-17"></a>    <span class="k">return</span> <span class="n">inte</span><span class="o">*</span><span class="n">jac</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-18" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-18"></a><span class="k">end</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-19" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-19"></a>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-20" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-20"></a><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-21" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-21"></a><span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_fbcf1897df9a4085a677f1a1a1226688-22" name="rest_code_fbcf1897df9a4085a677f1a1a1226688-22"></a><span class="n">print</span><span class="p">(</span><span class="n">clenshaw_curtis</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_5fbab920473c47eaabfafd6bfb25819e-1" name="rest_code_5fbab920473c47eaabfafd6bfb25819e-1"></a><span class="mf">0.8859062027920102</span>
</pre></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 24 in Python and 23 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_a41e887292804ab384618717c2fcfa9f-1" name="rest_code_a41e887292804ab384618717c2fcfa9f-1"></a><span class="o">%</span><span class="k">timeit</span> -n 10000 clenshaw_curtis(fun, N=N, a=0, b=3)
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_e023e64c0efe4ff79df87f6c5bf82204-1" name="rest_code_e023e64c0efe4ff79df87f6c5bf82204-1"></a>10000 loops, best of 3: 2.4 ms per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_b31bc859fbf345fea556855a2d6bd935-1" name="rest_code_b31bc859fbf345fea556855a2d6bd935-1"></a><span class="nd">@benchmark</span> <span class="n">clenshaw_curtis</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-1" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-2" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">359.56</span> <span class="n">KiB</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-3" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">565</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-4" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-4"></a>  <span class="o">--------------</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-5" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">381.676</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-6" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">388.497</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-7" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">413.471</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">1.77</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-8" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">1.298</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">49.07</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-9" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-9"></a>  <span class="o">--------------</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-10" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a id="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-11" name="rest_code_ab2629da9ddf44a8a8744ecb63464a2a-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 6 times slower than Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-15/" class="u-url">Numerical methods challenge: Day 15</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-15/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-17T16:22:06-05:00" title="2017-10-17 16:22">2017-10-17 16:22</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-15/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-15.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="simpson-s-rule"><h2>Simpson's rule</h2>
<p>Today we have the <a class="reference external" href="https://en.wikipedia.org/wiki/Simpson%27s_rule">Simpson's rule</a>.
This is another <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%E2%80%93Cotes_formulas">Newton-Cotes formulas</a>, used for numerical integration. Newton-Cotes is related to
Lagrange interpolation with equidistant points.</p>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-1" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-2" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-3" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-3"></a>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-4" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-4"></a>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-5" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-5"></a><span class="k">def</span> <span class="nf">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-6" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-6"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-7" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-7"></a>    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-8" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-8"></a>        <span class="n">inte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">dx</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-9" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-9"></a>    <span class="k">else</span><span class="p">:</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-10" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-10"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-11" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-11"></a>        <span class="n">inte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dx</span><span class="p">)</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-12" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-12"></a>    <span class="k">return</span> <span class="n">inte</span><span class="o">/</span><span class="mi">3</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-13" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-13"></a>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-14" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-14"></a>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-15" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-15"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">21</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-16" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-16"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-17" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-17"></a><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-18" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">))</span>
<a id="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-19" name="rest_code_ed3abb02ff7a4b74a6c8837b6447a3bd-19"></a><span class="nb">print</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code python"><a id="rest_code_be42eac1a159429f9e0ac66b8fc725b5-1" name="rest_code_be42eac1a159429f9e0ac66b8fc725b5-1"></a><span class="mf">1.8397296125</span>
<a id="rest_code_be42eac1a159429f9e0ac66b8fc725b5-2" name="rest_code_be42eac1a159429f9e0ac66b8fc725b5-2"></a><span class="mf">1.83907152908</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-1" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-1"></a><span class="k">function</span> <span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">;</span> <span class="n">x</span><span class="o">=</span><span class="nb">nothing</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-2" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-2"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-3" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-3"></a>    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="nb">nothing</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-4" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-4"></a>        <span class="n">inte</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">n</span><span class="p">])</span><span class="o">*</span><span class="n">dx</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-5" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-5"></a>    <span class="k">else</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-6" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-6"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-7" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-7"></a>        <span class="n">inte</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">n</span><span class="p">])</span><span class="o">'</span> <span class="o">*</span> <span class="n">dx</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-8" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-8"></a>    <span class="k">end</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-9" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-9"></a>    <span class="k">return</span> <span class="n">inte</span><span class="o">/</span><span class="mi">3</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-10" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-10"></a><span class="k">end</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-11" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-11"></a>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-12" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-12"></a>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-13" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-13"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">21</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-14" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-14"></a><span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-15" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-15"></a><span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-16" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-16"></a><span class="n">println</span><span class="p">(</span><span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">))</span>
<a id="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-17" name="rest_code_d1089fb0f08d4d17a78e59c9bf9b1918-17"></a><span class="n">println</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre>
<pre class="code julia"><a id="rest_code_00e2cb2c88cd4d5c8e881bcfbb965b6e-1" name="rest_code_00e2cb2c88cd4d5c8e881bcfbb965b6e-1"></a><span class="mf">1.8397296124951257</span>
<a id="rest_code_00e2cb2c88cd4d5c8e881bcfbb965b6e-2" name="rest_code_00e2cb2c88cd4d5c8e881bcfbb965b6e-2"></a><span class="mf">1.8390715290764525</span>
</pre></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 19 in Python and 17 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_9975464b73d44f49b8575581ee795e2c-1" name="rest_code_9975464b73d44f49b8575581ee795e2c-1"></a><span class="o">%</span><span class="k">timeit</span> simps(y, x=x)
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_9121aa5cc1624125af90e0dbaf3baaa6-1" name="rest_code_9121aa5cc1624125af90e0dbaf3baaa6-1"></a>100000 loops, best of 3: 13.8 µs per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_98f1ae722428468b8bbe7f3487b32135-1" name="rest_code_98f1ae722428468b8bbe7f3487b32135-1"></a><span class="nd">@benchmark</span> <span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_784d948b762143dc98652b13d489b5cd-1" name="rest_code_784d948b762143dc98652b13d489b5cd-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-2" name="rest_code_784d948b762143dc98652b13d489b5cd-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">1.23</span> <span class="n">KiB</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-3" name="rest_code_784d948b762143dc98652b13d489b5cd-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">14</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-4" name="rest_code_784d948b762143dc98652b13d489b5cd-4"></a>  <span class="o">--------------</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-5" name="rest_code_784d948b762143dc98652b13d489b5cd-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">1.117</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-6" name="rest_code_784d948b762143dc98652b13d489b5cd-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">1.200</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-7" name="rest_code_784d948b762143dc98652b13d489b5cd-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">1.404</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">7.04</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-8" name="rest_code_784d948b762143dc98652b13d489b5cd-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">222.286</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">96.45</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-9" name="rest_code_784d948b762143dc98652b13d489b5cd-9"></a>  <span class="o">--------------</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-10" name="rest_code_784d948b762143dc98652b13d489b5cd-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a id="rest_code_784d948b762143dc98652b13d489b5cd-11" name="rest_code_784d948b762143dc98652b13d489b5cd-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">10</span>
</pre>
<p>In this case, we can say that the Python code is 10 times slower than Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-14/" class="u-url">Numerical methods challenge: Day 14</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-14/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-14T14:00:42-05:00" title="2017-10-14 14:00">2017-10-14 14:00</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-14/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-14.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="trapezoidal-rule"><h2>Trapezoidal rule</h2>
<p>Today we have the <a class="reference external" href="https://en.wikipedia.org/wiki/Trapezoidal_rule">trapezoidal rule</a>.
This is the simplest of <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%E2%80%93Cotes_formulas">Newton-Cotes formulas</a> for numerical integration. Newton-Cotes is related to
Lagrange interpolation with equidistant points.</p>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-1" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-2" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-3" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-3"></a>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-4" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-4"></a>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-5" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-5"></a><span class="k">def</span> <span class="nf">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-6" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-6"></a>    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-7" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-7"></a>        <span class="n">inte</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-8" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-8"></a>    <span class="k">else</span><span class="p">:</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-9" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-9"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-10" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-10"></a>        <span class="n">inte</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dx</span><span class="p">)</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-11" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-11"></a>    <span class="k">return</span> <span class="n">inte</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-12" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-12"></a>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-13" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-13"></a>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-14" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-14"></a><span class="n">dx</span> <span class="o">=</span> <span class="mf">0.001</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-15" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-15"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-16" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-16"></a><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-17" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-17"></a><span class="nb">print</span><span class="p">(</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">))</span>
<a id="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-18" name="rest_code_dd011eacc19f47dd8744a8c3ff11ad4c-18"></a><span class="nb">print</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre>
<p>with result</p>
<pre class="code python"><a id="rest_code_39b05b29ef554de2a3a1694c9e5a9f97-1" name="rest_code_39b05b29ef554de2a3a1694c9e5a9f97-1"></a><span class="mf">1.83961497726</span>
<a id="rest_code_39b05b29ef554de2a3a1694c9e5a9f97-2" name="rest_code_39b05b29ef554de2a3a1694c9e5a9f97-2"></a><span class="mf">1.83907152908</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-1" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-1"></a><span class="k">function</span> <span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">;</span> <span class="n">x</span><span class="o">=</span><span class="nb">nothing</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-2" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-2"></a>    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="nb">nothing</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-3" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-3"></a>        <span class="n">inte</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-4" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-4"></a>    <span class="k">else</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-5" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-5"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-6" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-6"></a>        <span class="n">inte</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">])</span><span class="o">'</span> <span class="o">*</span> <span class="n">dx</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-7" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-7"></a>    <span class="k">end</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-8" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-8"></a>    <span class="k">return</span> <span class="n">inte</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-9" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-9"></a><span class="k">end</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-10" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-10"></a>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-11" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-11"></a>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-12" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-12"></a><span class="n">dx</span> <span class="o">=</span> <span class="mf">0.001</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-13" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-13"></a><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="n">dx</span><span class="o">:</span><span class="mi">10</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-14" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-14"></a><span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-15" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-15"></a><span class="n">println</span><span class="p">(</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">))</span>
<a id="rest_code_44a852f1e7f84b82a9cada0fe3310566-16" name="rest_code_44a852f1e7f84b82a9cada0fe3310566-16"></a><span class="n">println</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre>
<p>with results</p>
<pre class="code julia"><a id="rest_code_a4dfce4efe01420da24298be0ca258eb-1" name="rest_code_a4dfce4efe01420da24298be0ca258eb-1"></a><span class="mf">1.8390713758204895</span>
<a id="rest_code_a4dfce4efe01420da24298be0ca258eb-2" name="rest_code_a4dfce4efe01420da24298be0ca258eb-2"></a><span class="mf">1.8390715290764525</span>
</pre></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 18 in Python and 16 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_99e709c271784381abeed501cfc73bd9-1" name="rest_code_99e709c271784381abeed501cfc73bd9-1"></a><span class="o">%</span><span class="k">timeit</span> trapz(y, dx=dx)
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_b63db1a094724427b97259a522907698-1" name="rest_code_b63db1a094724427b97259a522907698-1"></a>100000 loops, best of 3: 16.9 µs per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_adadffe2eecb4708aaf77573dac2982f-1" name="rest_code_adadffe2eecb4708aaf77573dac2982f-1"></a><span class="nd">@benchmark</span> <span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-1" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-2" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">78.31</span> <span class="n">KiB</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-3" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">4</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-4" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-4"></a>  <span class="o">--------------</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-5" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">13.080</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-6" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">16.333</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-7" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">20.099</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">12.66</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-8" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">963.732</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">90.60</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-9" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-9"></a>  <span class="o">--------------</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-10" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a id="rest_code_6dd49235678c42249e0df8587cbd6ca2-11" name="rest_code_6dd49235678c42249e0df8587cbd6ca2-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly as fast as Julia.</p>
</section></section>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/numerical_challenge/numerical-13/" class="u-url">Numerical methods challenge: Day 13</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/numerical_challenge/numerical-13/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-10-13T19:20:06-05:00" title="2017-10-13 19:20">2017-10-13 19:20</time></a></p>
                <p class="commentline">
        
    <a href="posts/numerical_challenge/numerical-13/#disqus_thread" data-disqus-identifier="cache/posts/numerical_challenge/numerical-13.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>During October (2017) I will write a program per day for some well-known
numerical methods in both Python and Julia. It is intended to be an exercise
then don't expect the code to be good enough for real use. Also,
I should mention that I have almost no experience with Julia, so it
probably won't be idiomatic Julia but more Python-like Julia.</p>
<section id="cubic-splines"><h2>Cubic splines</h2>
<p>Today we have <a class="reference external" href="https://en.wikipedia.org/wiki/Spline_(mathematics)">cubic spline interpolation</a>.
Cubic splines are commonly  used because it provides
an approximation of a function with continuity up to second derivatives.
For more details you can check <a class="reference external" href="https://en.wikipedia.org/wiki/Spline_(mathematics)#Algorithm_for_computing_natural_cubic_splines">this algorithm</a>.
Our main difference is that we will form the matrix and then solve the system.
It is more common to directly solve the system of equation since it is
a tridiagonal one.</p>
<p>Following are the codes.</p>
<section id="python"><h3>Python</h3>
<pre class="code python"><a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-1" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-2" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-3" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-4" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-4"></a>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-5" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-5"></a>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-6" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-6"></a><span class="k">def</span> <span class="nf">spline_coeff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-7" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-7"></a>    <span class="n">h</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-8" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-8"></a>    <span class="n">d_up</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-9" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-9"></a>    <span class="n">d_up</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-10" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-10"></a>    <span class="n">d_down</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-11" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-11"></a>    <span class="n">d_down</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-12" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-12"></a>    <span class="n">d_cent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-13" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-13"></a>    <span class="n">d_cent</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-14" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-14"></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d_cent</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d_up</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d_down</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-15" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-15"></a>    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-16" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-16"></a>    <span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">3</span><span class="o">/</span><span class="n">h</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-17" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-17"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-18" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-18"></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-19" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-19"></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-20" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-20"></a>    <span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">h</span> <span class="o">-</span> <span class="n">h</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-21" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-21"></a>    <span class="n">d</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-22" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-22"></a>    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-23" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-23"></a>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-24" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-24"></a>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-25" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-25"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-26" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-26"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-27" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-27"></a><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-28" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-28"></a><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">spline_coeff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-29" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-29"></a><span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-30" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-30"></a>    <span class="n">x_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-31" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-31"></a>    <span class="n">y_loc</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x_loc</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span> <span class="o">+</span>\
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-32" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-32"></a>            <span class="n">c</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x_loc</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-33" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-33"></a>            <span class="n">d</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x_loc</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span><span class="o">**</span><span class="mi">3</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-34" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-34"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_loc</span><span class="p">,</span> <span class="n">y_loc</span><span class="p">,</span> <span class="s2">"red"</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-35" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-35"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">)</span>
<a id="rest_code_84dbe005abd945cf880fc101a7ecfa48-36" name="rest_code_84dbe005abd945cf880fc101a7ecfa48-36"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></section><section id="julia"><h3>Julia</h3>
<pre class="code julia"><a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-1" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-1"></a><span class="k">using</span> <span class="n">PyPlot</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-2" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-2"></a>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-3" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-3"></a>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-4" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-4"></a><span class="k">function</span> <span class="n">spline_coeff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-5" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-5"></a>    <span class="n">h</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-6" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-6"></a>    <span class="n">d_up</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-7" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-7"></a>    <span class="n">d_up</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-8" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-8"></a>    <span class="n">d_down</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-9" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-9"></a>    <span class="n">d_down</span><span class="p">[</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-10" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-10"></a>    <span class="n">d_cent</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-11" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-11"></a>    <span class="n">d_cent</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-12" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-12"></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">diagm</span><span class="p">(</span><span class="n">d_cent</span><span class="p">)</span> <span class="o">+</span> <span class="n">diagm</span><span class="p">(</span><span class="n">d_up</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">diagm</span><span class="p">(</span><span class="n">d_down</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-13" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-13"></a>    <span class="n">alpha</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-14" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-14"></a>    <span class="n">alpha</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">/</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">.*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mf">3.</span><span class="o">/</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-15" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-15"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">mat</span> <span class="o">\</span> <span class="n">alpha</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-16" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-16"></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-17" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-17"></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-18" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-18"></a>    <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">./</span><span class="n">h</span> <span class="o">-</span> <span class="n">h</span><span class="o">./</span><span class="mf">3.</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-19" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-19"></a>    <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">./</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-20" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-20"></a>    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-21" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-21"></a><span class="k">end</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-22" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-22"></a>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-23" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-23"></a>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-24" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-24"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">21</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-25" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-25"></a><span class="n">x</span> <span class="o">=</span> <span class="n">collect</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-26" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-26"></a><span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-27" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-27"></a><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">spline_coeff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-28" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-28"></a><span class="k">for</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-29" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-29"></a>    <span class="n">x_loc</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-30" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-30"></a>    <span class="n">y_loc</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x_loc</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span> <span class="o">+</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-31" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-31"></a>            <span class="n">c</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x_loc</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span><span class="o">.^</span><span class="mi">2</span> <span class="o">+</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-32" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-32"></a>            <span class="n">d</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x_loc</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span><span class="o">.^</span><span class="mi">3</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-33" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-33"></a>    <span class="n">plot</span><span class="p">(</span><span class="n">x_loc</span><span class="p">,</span> <span class="n">y_loc</span><span class="p">,</span> <span class="s">"red"</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-34" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-34"></a><span class="k">end</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-35" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-35"></a><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">"o"</span><span class="p">)</span>
<a id="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-36" name="rest_code_ddb0c7c0c73c405ab9c948649bcaa2b2-36"></a><span class="n">show</span><span class="p">()</span>
</pre>
<p>In both cases the result is the plot below.</p>
<img alt="Spline interpolation." class="align-center" src="images/spline.svg" style="width: 500px;"></section><section id="comparison-python-julia"><h3>Comparison Python/Julia</h3>
<p>Regarding number of lines we have: 36 in Python and 37 in Julia. The comparison
in execution time is done with <code class="docutils literal">%timeit</code> magic command in IPython and
<code class="docutils literal">@benchmark</code> in Julia.</p>
<p>For Python:</p>
<pre class="code IPython"><a id="rest_code_feb10ae294624a508db6ba8fbf0dfcc8-1" name="rest_code_feb10ae294624a508db6ba8fbf0dfcc8-1"></a><span class="o">%</span><span class="k">timeit</span> a, b, c, d = spline_coeff(x, y)
</pre>
<p>with result</p>
<pre class="code text"><a id="rest_code_9ad9f770344c4cc19cd2f126b1b12823-1" name="rest_code_9ad9f770344c4cc19cd2f126b1b12823-1"></a>1000 loops, best of 3: 216 µs per loop
</pre>
<p>For Julia:</p>
<pre class="code julia"><a id="rest_code_61b265ab328d4032940aef4207894d6d-1" name="rest_code_61b265ab328d4032940aef4207894d6d-1"></a><span class="nd">@benchmark</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">spline_coeff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre>
<p>with result</p>
<pre class="code julia"><a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-1" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-1"></a><span class="n">BenchmarkTools</span><span class="o">.</span><span class="n">Trial</span><span class="o">:</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-2" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-2"></a>  <span class="n">memory</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mf">31.59</span> <span class="n">KiB</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-3" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-3"></a>  <span class="n">allocs</span> <span class="n">estimate</span><span class="o">:</span>  <span class="mi">52</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-4" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-4"></a>  <span class="o">--------------</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-5" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-5"></a>  <span class="n">minimum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">18.024</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-6" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-6"></a>  <span class="n">median</span> <span class="n">time</span><span class="o">:</span>      <span class="mf">26.401</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-7" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-7"></a>  <span class="n">mean</span> <span class="n">time</span><span class="o">:</span>        <span class="mf">44.035</span> <span class="n">μs</span> <span class="p">(</span><span class="mf">3.94</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-8" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-8"></a>  <span class="n">maximum</span> <span class="n">time</span><span class="o">:</span>     <span class="mf">9.833</span> <span class="n">ms</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span> <span class="n">GC</span><span class="p">)</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-9" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-9"></a>  <span class="o">--------------</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-10" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-10"></a>  <span class="n">samples</span><span class="o">:</span>          <span class="mi">10000</span>
<a id="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-11" name="rest_code_eb21087dd1c1465cbb75c62645e8f3e1-11"></a>  <span class="n">evals</span><span class="o">/</span><span class="n">sample</span><span class="o">:</span>     <span class="mi">1</span>
</pre>
<p>In this case, we can say that the Python code is roughly 10 times slower.</p>
</section></section>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-4.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="nicoguaro-github";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script><footer id="footer"><p>Contents © 2021 <a href="mailto:nicoguarin@gmail.com">Nicolás Guarín-Zapata</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a></p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145359674-1', 'auto');
ga('send', 'pageview');
</script><script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
