<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Personal blog and website">
<meta name="viewport" content="width=device-width">
<title>Nicolás' blog (old posts, page 5) | Nicolás' blog</title>
<link href="assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" href="es/rss.xml">
<link rel="canonical" href="https://nicoguaro.github.io/index-5.html">
<link rel="prev" href="." type="text/html">
<link rel="next" href="index-4.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>This is my personal website and blog.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="pages/about/">About</a>
        <a class="sidebar-nav-item" href="index.html">Blog</a>
        <a class="sidebar-nav-item" href="pages/preprints-archive/">Preprints</a>
        <a class="sidebar-nav-item" href="pages/links/">Links</a>
        <a class="sidebar-nav-item" href="archive.html">Archive</a>
        <a class="sidebar-nav-item" href="categories/">Tags</a>
        <a class="sidebar-nav-item" href="rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://nicoguaro.github.io/" title="Nicolás' blog" rel="home">Nicolás' blog</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        

<div class="posts">
    <article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/isometric_inkscape2/" class="u-url">Isometric graphics in Inkscape: Part 2</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/isometric_inkscape2/" rel="bookmark"><time class="post-date published dt-published" datetime="2018-05-30T12:40:57-05:00" title="2018-05-30 12:40">2018-05-30 12:40</time></a></p>
                <p class="commentline">
        
    <a href="posts/isometric_inkscape2/#disqus_thread" data-disqus-identifier="cache/posts/isometric_inkscape2.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><a class="reference external" href="posts/isometric_inkscape">Last week</a>  I posted a quick guide on isometric
drawing using <a class="reference external" href="https://inkscape.org/en/">Inkscape</a>. In that post, I
showed how to obtain images that are projected to the faces of an
isometric box.</p>
<p>After my post, I was asked by <a class="reference external" href="https://twitter.com/parresianz">Biswajit Banerjee</a>
on <a class="reference external" href="https://twitter.com/parresianz/status/999787980658126848">Twitter</a> if
I could repeat the process with a more complex example, and he suggested
the following schematic</p>
<img alt="Computing the moment of force in a beam" class="align-center" src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/Beam_moment_plain.svg/512px-Beam_moment_plain.svg.png"><p>which, I guess, was created in Inkscape using the "Create 3D Box" option.</p>
<p>In this post, I will:</p>
<ol class="arabic simple">
<li><p>Use the same approach from last week to recreate this schematic</p></li>
<li><p>Suggest my preferred approach for drawing this schematic</p></li>
</ol>
<div class="section" id="first-approach">
<h2>First approach</h2>
<p>I will repeat the cheatsheet from last week. Keep in mind that Inkscape
treats clockwise rotation as positive. Opposite to common notation in
mathematics.</p>
<img alt="Cheatsheet for isometric schematics in Inkscape" class="align-center" src="images/isometric_inkscape/isometric_instructions.svg" style="width: 500px;"><p>Then, to create a box with desired dimensions we first create each rectangle
with the right dimensiones (in parallel projections). In the following
example we used faces with aspect ratios 3:2, 2:1 and 4:3. The box at the right
is the figure obtained after applying the transformations described in
the previous schematic.</p>
<img alt="Orthogonal views and final isometric figure" class="align-center" src="images/isometric_inkscape/isometric_ex2.svg" style="width: 500px;"><p>We can now proceed, to recreate the desired figure. I don't know the
exact dimensions of the box; my guess is that the cross-section was
a square and the aspect ratio was 5:1. After applying the transformations
to each rectangle we obtain the following (adding some tweaks here and there).</p>
<img alt="Recreated figure using the described approach" class="align-center" src="images/isometric_inkscape/isometric_beam.svg" style="width: 500px;">
</div>
<div class="section" id="second-approach">
<h2>Second approach</h2>
<p>For this type of schematic, I would prefer to create an axonometric grid
(<code class="docutils literal">File &gt; Document Properties &gt; Grids</code>). After adding the grid to our
canvas it is pretty straightforward to draw the figures in isometric
view. The canvas should look similar to the following image.</p>
<img alt="Second approach: using an axonometric grid" class="align-center" src="images/isometric_inkscape/screenshot_inkscape.png" style="width: 500px;"><p>We can then draw each face using the grid. If we want to be more precise
we can activate <code class="docutils literal">Snap to Cusp Nodes</code>. The following animation shows
the step by step construction.</p>
<img alt="Step by step construction of the isometric" class="align-center" src="images/isometric_inkscape/isometric_construction.gif" style="width: 500px;"><p>And we obtain the final image.</p>
<img alt="Recreated figure using the second approach" class="align-center" src="images/isometric_inkscape/isometric_beam2.svg" style="width: 500px;">
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>As I mentioned, Inkscape can be used for drawing simple figures in isometric
projection. Nevertheless, I strongly suggest to use a CAD like
<a class="reference external" href="https://freecadweb.org/">FreeCAD</a> for more complicated geometries.</p>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/isometric_inkscape/" class="u-url">Isometric graphics in Inkscape</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/isometric_inkscape/" rel="bookmark"><time class="post-date published dt-published" datetime="2018-05-24T15:42:02-05:00" title="2018-05-24 15:42">2018-05-24 15:42</time></a></p>
                <p class="commentline">
        
    <a href="posts/isometric_inkscape/#disqus_thread" data-disqus-identifier="cache/posts/isometric_inkscape.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Sometimes I find myself in need of making a schematic using an
<a class="reference external" href="https://en.wikipedia.org/wiki/Isometric_projection">isometric projection</a>.
When the schematic is complicated the best shot is to use some
CAD like <a class="reference external" href="https://freecadweb.org/">FreeCAD</a>, but sometimes it's just
needed in simple diagrams. Another situation where this is a common needed
is in <a class="reference external" href="https://en.wikipedia.org/wiki/Isometric_graphics_in_video_games_and_pixel_art">video games</a>,
where <a class="reference external" href="https://youtu.be/toWMFcWB4HA">"isometric art"</a> and
<a class="reference external" href="https://en.wikipedia.org/wiki/Pixel_art">pixel art</a> are pretty common.</p>
<p>What we want is depicted in the following figure.</p>
<img alt="Views names in third angle representation" class="align-center" src="images/isometric_inkscape/isometric_example.svg" style="width: 400px;"><p>That is, we want to start with some information that is drawn, or
written in the case of the example, and we want to obtain how would it
been seen on one of the faces of an isometric box.</p>
<p>Following, I will describe briefly the transformations involved in this process.
If you are just interested in the recipe for doing this in Inkscape, skip to
the end of this post.</p>
<div class="section" id="transformations-involved">
<h2>Transformations involved</h2>
<p>Since we are working on a computer screen, we are talking of 2 dimensions.
Hence, all transformations are represented by 2×2 matrices. In the particular
example of interest in this post we need the following transformations:</p>
<ol class="arabic simple">
<li><p>Vertical scaling</p></li>
<li><p>Horizontal skew</p></li>
<li><p>Rotation</p></li>
</ol>
<p>Following are the transformation matrices.</p>
<div class="section" id="scaling-in-the-vertical-direction">
<h3>Scaling in the vertical direction</h3>
<p>The matrix is given by</p>
<div class="math">
\begin{equation*}
M_\text{scaling} = \begin{bmatrix} 1 &amp;0\\ 0 &amp;a\end{bmatrix}\, ,
\end{equation*}
</div>
<p>where <span class="math">\(a\)</span> is the scaling factor.</p>
</div>
<div class="section" id="horizontal-skew">
<h3>Horizontal skew</h3>
<p>The matrix is given by</p>
<div class="math">
\begin{equation*}
M_\text{skew} = \begin{bmatrix} 1 &amp;\tan a\\ 0 &amp;1\end{bmatrix}\, ,
\end{equation*}
</div>
<p>where <span class="math">\(a\)</span> is the skewing angle.</p>
</div>
<div class="section" id="rotation">
<h3>Rotation</h3>
<p>The matrix is given by</p>
<div class="math">
\begin{equation*}
M_\text{rotation} = \begin{bmatrix} \cos a &amp;-\sin a\\ \sin a &amp;\cos a\end{bmatrix}\, ,
\end{equation*}
</div>
<p>where <span class="math">\(a\)</span> is the rotation angle.</p>
</div>
<div class="section" id="complete-transformation">
<h3>Complete transformation</h3>
<p>The complete transformation is given by</p>
<div class="math">
\begin{equation*}
M_\text{complete} = M_\text{rotation} M_\text{skew} M_\text{scaling}\, ,
\end{equation*}
</div>
<p>particularly,</p>
<div class="math">
\begin{align*}
&amp;M_\text{side} =
  \frac{1}{2}\begin{bmatrix} \sqrt{3} &amp; 0\\ -1 &amp;2\end{bmatrix}\approx
  \begin{bmatrix} 0.866 &amp; 0.000\\ -0.500 &amp;1.000\end{bmatrix}\, , \\
&amp;M_\text{front} = \frac{1}{2}\begin{bmatrix} \sqrt{3} &amp; 0\\ 1 &amp;2\end{bmatrix}\approx
  \begin{bmatrix} 0.866 &amp; 0.000\\ 0.500 &amp;1.000\end{bmatrix}\, , \\
&amp;M_\text{plant} = \frac{1}{2}\begin{bmatrix} \sqrt{3} &amp; -\sqrt{3}\\ -1 &amp;1\end{bmatrix}\approx
  \begin{bmatrix} 0.866 &amp; -0.866\\ 0.500 &amp;0.500\end{bmatrix}\, .
\end{align*}
</div>
<p>The values seem a bit arbitrary, but they can be obtained from the
<a class="reference external" href="https://en.wikipedia.org/wiki/Isometric_projection#Mathematics">isometric projection</a>
itself. But that explanation would be a bit too long for this post.</p>
</div>
<div class="section" id="tranformation-in-inkscape">
<h3>Tranformation in Inkscape</h3>
<p>We already have the transformation matrices and we can use them in Inkscape.
But first, we need to understand how it works. Inkscape uses
<a class="reference external" href="https://en.wikipedia.org/wiki/Scalable_Vector_Graphics">SVG</a>, the web
standard for vector graphics. <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/transform">Transformations</a> in SVG are done using the following
matrix</p>
<div class="math">
\begin{equation*}
\begin{bmatrix} a &amp;c &amp;e\\ b &amp;d &amp;f\\ 0 &amp;0 &amp;1\end{bmatrix}\, ,
\end{equation*}
</div>
<p>that uses <a class="reference external" href="https://en.wikipedia.org/wiki/Homogeneous_coordinates">homogeneous coordinates</a>. So, one can just press <code class="docutils literal">Shift + Ctrl + M</code>
and type the components of the matrices obtained above for
<span class="math">\(a\)</span>, <span class="math">\(b\)</span>, <span class="math">\(c\)</span>, and <span class="math">\(d\)</span>; leaving
<span class="math">\(e\)</span> and <span class="math">\(f\)</span> as zero.</p>
<p>My preferred method, though, is to apply each transformation after the
other in the <cite>Transform</cite> dialog (<code class="docutils literal">Shift + Ctrl + M</code>). And, this is the
method presented in the cheatsheet at the bottom of this post.</p>
</div>
</div>
<div class="section" id="tl-dr">
<h2>TL;DR</h2>
<p>If you are just interested in the transformations needed in Inkscape
you can check the cheatsheet below. It uses third-angle as presented
below.</p>
<img alt="Views names in third angle representation" class="align-center" src="images/isometric_inkscape/third_angle.svg" style="width: 400px;"><div class="section" id="cheatsheet">
<h3>Cheatsheet</h3>
<p>Keep in mind that Inkscape treats clockwise rotation as positive. Opposite
to common notation in mathematics.</p>
<img alt="Cheatsheet for isometric schematics in Inkscape" class="align-center" src="images/isometric_inkscape/isometric_instructions.svg" style="width: 500px;">
</div>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/infinite_fdm/" class="u-url">Finite differences in infinite domains</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/infinite_fdm/" rel="bookmark"><time class="post-date published dt-published" datetime="2018-05-17T15:57:00-05:00" title="2018-05-17 15:57">2018-05-17 15:57</time></a></p>
                <p class="commentline">
        
    <a href="posts/infinite_fdm/#disqus_thread" data-disqus-identifier="cache/posts/infinite_fdm.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div class="section" id="finite-differences-in-infinite-domains">
<h2>Finite differences in infinite domains</h2>
<p>Because of my friend, <a class="reference external" href="http://cosmoscalibur.com/">Edward Villegas</a>, I
ended up thinking about using a change of variables when solving an
eigenvalue problem with finite difference.</p>
<div class="section" id="the-problem">
<h3>The problem</h3>
<p>Let's say that we want to solve a differential equation over an infinite
domain. A common case is to solve the <a class="reference external" href="https://en.wikipedia.org/wiki/Schr%C3%B6dinger_equation#Time-independent_equation">Time independent Schrödinger
equation</a>
subject to a potential <span class="math">\(V(x)\)</span>. For example</p>
<div class="math">
\begin{equation*}
-\frac{1}{2}\frac{\mathrm{d}^2}{\mathrm{d}x^2}\psi(x) + V(x) \psi(x) = E\psi(x),\quad \forall x\in (-\infty, \infty),
\end{equation*}
</div>
<p>where we want to find the pairs of eigenvalues/eigenfunctions
<span class="math">\((E_n, \psi_n(x))\)</span>.</p>
<p>What I normally do when using <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_difference_method">finite
differences</a>
is to regularly divide the domain. Where I take a <em>large enough</em> domain,
so the solution have decayed close to zero. What I do in this post is to
make a change of variable to render the interval finite first and then
regularly divide the transformed domain in finite intervals.</p>
</div>
<div class="section" id="my-usual-approach">
<h3>My usual approach</h3>
<p>My usual approach is to approach the second derivative with a <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_difference_coefficient">centered
difference</a>
for the point <span class="math">\(x_i\)</span> like this</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}^2 f(x)}{\mathrm{d}x^2} \approx \frac{f(x + \Delta x) - 2 f(x_i) + f(x - \Delta x)}{\Delta x^2}\, ,
\end{equation*}
</div>
<p>with <span class="math">\(\Delta x\)</span> the separation between points.</p>
<p>We can solve this in Python with the following snippet:</p>
<pre class="code ipython3"><a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-2"></a><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="k">import</span> <span class="n">diags</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-3"></a><span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="k">import</span> <span class="n">eigs</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-4"></a>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-5"></a>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-6"></a><span class="k">def</span> <span class="nf">regular_FD</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nvals</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-7"></a>    <span class="sd">"""</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-8"></a><span class="sd">    Find eigenvalues/eigenfunctions for Schrodinger</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-9"></a><span class="sd">    equation for the given potential `pot` using</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-10"></a><span class="sd">    finite differences</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-11"></a><span class="sd">    """</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-12"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">x_max</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-13"></a>    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-14"></a>    <span class="n">D2</span> <span class="o">=</span> <span class="n">diags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-15"></a>    <span class="n">V</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-16"></a>    <span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">D2</span> <span class="o">+</span> <span class="n">V</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-17"></a>    <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">eigs</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">nvals</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SM"</span><span class="p">)</span>
<a name="rest_code_e7d5d7f34f604b4b9e2432be8d98898d-18"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">vecs</span>
</pre>
<p>Let's setup the plotting details.</p>
<pre class="code ipython3"><a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-1"></a><span class="c1"># Jupyter notebook plotting setup &amp; imports</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-2"></a><span class="o">%</span><span class="k">matplotlib</span> notebook
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-4"></a>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-5"></a><span class="n">gray</span> <span class="o">=</span> <span class="s1">'#757575'</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"mathtext.fontset"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"cm"</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"text.color"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-9"></a><span class="n">fontsize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"font.size"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"xtick.color"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"ytick.color"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"axes.labelcolor"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-13"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"axes.edgecolor"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"axes.spines.right"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a name="rest_code_64c3639a3c904b6d87975c0f0b05da32-15"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"axes.spines.top"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</pre>
<p>Let's consider the <a class="reference external" href="https://en.wikipedia.org/wiki/Quantum_harmonic_oscillator">Quantum harmonic
oscillator</a>,
that has as eigenvalues</p>
<div class="math">
\begin{equation*}
E_n = n + \frac{1}{2},\quad \forall n = 0, 1, 2 \cdots
\end{equation*}
</div>
<p>Using the finite difference method we have values that are really close
to the analytic ones.</p>
<pre class="code ipython3"><a name="rest_code_a208ca23198a423f86ee3b5c0b3b9f32-1"></a><span class="n">x</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">regular_FD</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
<a name="rest_code_a208ca23198a423f86ee3b5c0b3b9f32-2"></a><span class="n">vals</span>
</pre>
<p>with output</p>
<pre class="literal-block">
array([0.4996873 , 1.49843574, 2.49593063, 3.49216962, 4.48715031,
       5.4808703 ])
</pre>
<p>With the analytic ones</p>
<pre class="code text"><a name="rest_code_e65fe807c0034a4382ff1fb4e3b7c4e6-1"></a>[0.5, 1.5, 2.5, 3.5, 4.5, 5.5])
</pre>
<p>If we plot these two, we obtain the following.</p>
<pre class="code ipython3"><a name="rest_code_e7973c914a64425cb735bbb38493d7e0-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_e7973c914a64425cb735bbb38493d7e0-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anal_vals</span><span class="p">)</span>
<a name="rest_code_e7973c914a64425cb735bbb38493d7e0-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">)</span>
<a name="rest_code_e7973c914a64425cb735bbb38493d7e0-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_e7973c914a64425cb735bbb38493d7e0-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$E_n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_e7973c914a64425cb735bbb38493d7e0-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Analytic"</span><span class="p">,</span> <span class="s2">"Finite differences"</span><span class="p">])</span>
<a name="rest_code_e7973c914a64425cb735bbb38493d7e0-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre>
<object class="align-center" data="images/infinite_fdm/eigvals_regular.svg" style="width: 600px;" type="image/svg+xml">
Eigenvalues for the regular finite difference</object>
<p>Let's see the eigenfunctions.</p>
<pre class="code ipython3"><a name="rest_code_fb6b5707c6a04664baf3e5e5b11e336a-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_fb6b5707c6a04664baf3e5e5b11e336a-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vecs</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_fb6b5707c6a04664baf3e5e5b11e336a-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="rest_code_fb6b5707c6a04664baf3e5e5b11e336a-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_fb6b5707c6a04664baf3e5e5b11e336a-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$|\psi_n(x)|^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_fb6b5707c6a04664baf3e5e5b11e336a-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<a name="rest_code_fb6b5707c6a04664baf3e5e5b11e336a-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre>
<object class="align-center" data="images/infinite_fdm/eigvecs_regular.svg" style="width: 600px;" type="image/svg+xml">
Eigenfunctions for the regular finite difference</object>
<p>One inconvenient with this method is the redundant sampling towards the
extreme of the intervals, while under sample the middle part.</p>
</div>
<div class="section" id="changing-the-domain">
<h3>Changing the domain</h3>
<p>Let's now consider the case where we transform the infinite domain to a
finite one with a change of variable</p>
<div class="math">
\begin{equation*}
\xi = \xi(x)
\end{equation*}
</div>
<p>with <span class="math">\(\xi \in (-1, 1)\)</span>. Two options for this transformation are:</p>
<ul class="simple">
<li>
<span class="math">\(\xi = \tanh x\)</span>; and</li>
<li>
<span class="math">\(\xi = \frac{2}{\pi} \arctan x\)</span>.</li>
</ul>
<p>Making this change of variable the equation we need to solve the
following equation</p>
<div class="math">
\begin{equation*}
-\frac{1}{2}\left(\frac{\mathrm{d}\xi}{\mathrm{d}x}\right)^2\frac{\mathrm{d}^2}{\mathrm{d}\xi^2}\psi(\xi) - \frac{1}{2}\frac{\mathrm{d}^2\xi}{\mathrm{d}x^2}\frac{\mathrm{d}}{\mathrm{d}\xi}\psi(\xi) + V(\xi) \psi(\xi) = E\psi(\xi)
\end{equation*}
</div>
<p>The following snippet solve the eigenproblem for the mapped domain:</p>
<pre class="code ipython3"><a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-1"></a><span class="k">def</span> <span class="nf">mapped_FD</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">dxdxi</span><span class="p">,</span> <span class="n">dxdxi2</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">nvals</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">xi_tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-2"></a>    <span class="sd">"""</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-3"></a><span class="sd">    Find eigenvalues/eigenfunctions for Schrodinger</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-4"></a><span class="sd">    equation for the given potential `pot` using</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-5"></a><span class="sd">    finite differences over a mapped domain on (-1, 1)</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-6"></a><span class="sd">    """</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-7"></a>    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi_tol</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">xi_tol</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-8"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-9"></a>    <span class="n">dxi</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-10"></a>    <span class="n">D2</span> <span class="o">=</span> <span class="n">diags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span><span class="o">/</span><span class="n">dxi</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-11"></a>    <span class="n">D1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">diags</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span><span class="o">/</span><span class="n">dxi</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-12"></a>    <span class="n">V</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-13"></a>    <span class="n">fac1</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">dxdxi</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-14"></a>    <span class="n">fac2</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">dxdxi2</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-15"></a>    <span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fac1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">fac2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D1</span><span class="p">)</span> <span class="o">+</span> <span class="n">V</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-16"></a>    <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">eigs</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">nvals</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SM"</span><span class="p">)</span>
<a name="rest_code_a3aaedc902dd4f0985d321f6bb1f1cdc-17"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">vecs</span>
</pre>
<div class="section" id="first-transformation-xi-tanh-x">
<h4>First transformation: <span class="math">\(\xi = \tanh(x)\)</span>
</h4>
<p>Let's consider first the transformation</p>
<div class="math">
\begin{equation*}
\xi = \tanh(x)\, .
\end{equation*}
</div>
<p>In this case</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}\xi}{\mathrm{d}x} = 1 - \tanh^2(x) = 1 - \xi^2\, ,
\end{equation*}
</div>
<p>and</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}^2\xi}{\mathrm{d}x^2} = -2\tanh(x)[1 - \tanh^2(x)] = -2\xi[1 - \xi^2]\, .
\end{equation*}
</div>
<p>We need to define the functions</p>
<pre class="code ipython3"><a name="rest_code_aefa6d92f5ea4f068e7832dd7a82e426-1"></a><span class="n">pot</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_aefa6d92f5ea4f068e7832dd7a82e426-2"></a><span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
<a name="rest_code_aefa6d92f5ea4f068e7832dd7a82e426-3"></a><span class="n">dxdxi</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_aefa6d92f5ea4f068e7832dd7a82e426-4"></a><span class="n">dxdxi2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre>
<p>and run the function</p>
<pre class="code ipython3"><a name="rest_code_4ef5f4de4a7343999e2b204e3d22473e-1"></a><span class="n">x</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">mapped_FD</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">dxdxi</span><span class="p">,</span> <span class="n">dxdxi2</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
<a name="rest_code_4ef5f4de4a7343999e2b204e3d22473e-2"></a><span class="n">vals</span>
</pre>
<p>And we obtain the following</p>
<pre class="literal-block">
array([0.49989989, 1.4984226 , 2.49003572, 3.46934257, 4.46935021,
       5.59552989])
</pre>
<p>If we compare with the analytic values we get the following.</p>
<pre class="code ipython3"><a name="rest_code_c92e1ab55be6473c97f7047e1d871bb2-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_c92e1ab55be6473c97f7047e1d871bb2-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anal_vals</span><span class="p">)</span>
<a name="rest_code_c92e1ab55be6473c97f7047e1d871bb2-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">)</span>
<a name="rest_code_c92e1ab55be6473c97f7047e1d871bb2-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Analytic"</span><span class="p">,</span> <span class="s2">"Finite differences"</span><span class="p">])</span>
<a name="rest_code_c92e1ab55be6473c97f7047e1d871bb2-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_c92e1ab55be6473c97f7047e1d871bb2-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$E_n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_c92e1ab55be6473c97f7047e1d871bb2-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre>
<object class="align-center" data="images/infinite_fdm/eigvals_tanh.svg" style="width: 600px;" type="image/svg+xml">
Eigenvalues for the first transformation</object>
<p>And the following are the eigenfunctions.</p>
<pre class="code ipython3"><a name="rest_code_7a872d0a18b54682a684bfff9858a07b-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_7a872d0a18b54682a684bfff9858a07b-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vecs</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_7a872d0a18b54682a684bfff9858a07b-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="rest_code_7a872d0a18b54682a684bfff9858a07b-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_7a872d0a18b54682a684bfff9858a07b-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$|\psi_n(x)|^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_7a872d0a18b54682a684bfff9858a07b-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<a name="rest_code_7a872d0a18b54682a684bfff9858a07b-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre>
<object class="align-center" data="images/infinite_fdm/eigvecs_tanh.svg" style="width: 600px;" type="image/svg+xml">
Eigenfunctions for the first transformation</object>
</div>
<div class="section" id="second-transformation-xi-frac-2-pi-mathrm-atan-x">
<h4>Second transformation: <span class="math">\(\xi = \frac{2}{\pi}\mathrm{atan}(x)\)</span>
</h4>
<p>Let's consider first the transformation</p>
<div class="math">
\begin{equation*}
\xi = \frac{2}{\pi}\mathrm{atan}(x)\, .
\end{equation*}
</div>
<p>In this case</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}\xi}{\mathrm{d}x} = \frac{2}{\pi(1 + x^2)} = \frac{2 \cos^2\xi}{\pi} \, ,
\end{equation*}
</div>
<p>and</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}^2\xi}{\mathrm{d}x^2} = -\frac{4x}{\pi(1 + x^2)^2} = -\frac{4 \cos^4\xi \tan \xi}{\pi}\, .
\end{equation*}
</div>
<p>Once, again, we define the functions.</p>
<pre class="code ipython3"><a name="rest_code_befc7d87a2444221b458a75b2676504d-1"></a><span class="n">pot</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_befc7d87a2444221b458a75b2676504d-2"></a><span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span>
<a name="rest_code_befc7d87a2444221b458a75b2676504d-3"></a><span class="n">dxdxi</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="rest_code_befc7d87a2444221b458a75b2676504d-4"></a><span class="n">dxdxi2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span>
</pre>
<p>and run the function</p>
<pre class="code ipython3"><a name="rest_code_f85f191633954da88fb99b0a4c6ffb45-1"></a><span class="n">x</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">mapped_FD</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">dxdxi</span><span class="p">,</span> <span class="n">dxdxi2</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
<a name="rest_code_f85f191633954da88fb99b0a4c6ffb45-2"></a><span class="n">vals</span>
</pre>
<p>to obtain the following eigenvalues</p>
<pre class="literal-block">
array([0.49997815, 1.49979632, 2.49930872, 3.49824697, 4.49627555,
       5.49295665])
</pre>
<p>with this plot</p>
<pre class="code ipython3"><a name="rest_code_d452275a9fae4454adcfefa0c4d69ca1-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_d452275a9fae4454adcfefa0c4d69ca1-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anal_vals</span><span class="p">)</span>
<a name="rest_code_d452275a9fae4454adcfefa0c4d69ca1-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">)</span>
<a name="rest_code_d452275a9fae4454adcfefa0c4d69ca1-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Analytic"</span><span class="p">,</span> <span class="s2">"Finite differences"</span><span class="p">])</span>
<a name="rest_code_d452275a9fae4454adcfefa0c4d69ca1-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_d452275a9fae4454adcfefa0c4d69ca1-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$E_n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_d452275a9fae4454adcfefa0c4d69ca1-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre>
<object class="align-center" data="images/infinite_fdm/eigvals_atan.svg" style="width: 600px;" type="image/svg+xml">
Eigenvalues for the second transformation</object>
<p>and the following eigenfunctions.</p>
<pre class="code ipython3"><a name="rest_code_a5df7a159fc143c4be380de87be182b2-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_a5df7a159fc143c4be380de87be182b2-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vecs</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_a5df7a159fc143c4be380de87be182b2-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_a5df7a159fc143c4be380de87be182b2-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$|\psi|^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_a5df7a159fc143c4be380de87be182b2-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="rest_code_a5df7a159fc143c4be380de87be182b2-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_a5df7a159fc143c4be380de87be182b2-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$|\psi_n(x)|^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a name="rest_code_a5df7a159fc143c4be380de87be182b2-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<a name="rest_code_a5df7a159fc143c4be380de87be182b2-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre>
<object class="align-center" data="images/infinite_fdm/eigvecs_atan.svg" style="width: 600px;" type="image/svg+xml">
Eigenfunctions for the second transformation</object>
</div>
</div>
<div class="section" id="conclusion">
<h3>Conclusion</h3>
<p>The method works fine, although the differential equation is more
convoluted due to the change of variable. Although there are more
elegant methods to consider infinite domains, this is simple enough to
be solved in 10 lines of code.</p>
<p>We can see that the mapping <span class="math">\(\xi = \mathrm{atan}(x)\)</span>, covers
better the domain than <span class="math">\(\xi = \tanh(x)\)</span>, where most of the points
are placed in the center of the interval.</p>
<p>Thanks for reading!</p>
<small>
  <i>
    This post was written in the Jupyter notebook. You can
    <a href="downloads/notebooks/finite_diff_map.ipynb">download</a>
    this notebook, or see a static view on
    <a href="http://nbviewer.jupyter.org/url/nicoguaro.github.io/downloads/notebooks/finite_diff_map.ipynb">nbviewer</a>.
  <i>
</i></i></small>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/cyclic_colormaps/" class="u-url">Cyclic colormaps comparison</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/cyclic_colormaps/" rel="bookmark"><time class="post-date published dt-published" datetime="2018-01-02T18:55:41-05:00" title="2018-01-02 18:55">2018-01-02 18:55</time></a></p>
                <p class="commentline">
        
    <a href="posts/cyclic_colormaps/#disqus_thread" data-disqus-identifier="cache/posts/cyclic_colormaps.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I started this post looking for a
<a class="reference external" href="https://en.wikipedia.org/wiki/Diffusion_map">diffusion map</a> on Python,
that I didn't find. Then I continued following an
<a class="reference external" href="http://scikit-learn.org/stable/auto_examples/manifold/plot_compare_methods.html#sphx-glr-auto-examples-manifold-plot-compare-methods-py">example</a>
on <a class="reference external" href="https://en.wikipedia.org/wiki/Nonlinear_dimensionality_reduction">manifold learning</a>
by <a class="reference external" href="https://jakevdp.github.io/">Jake Vanderplas</a> on a <a class="reference external" href="https://commons.wikimedia.org/wiki/File:Diffusion_map_of_a_torodial_helix.jpg">different dataset</a>.
It worked nicely,</p>
<img alt="/images/manifold_learning_toroidal_helix.svg" src="images/manifold_learning_toroidal_helix.svg"><p>but the colormap used is <a class="reference external" href="https://matplotlib.org/examples/color/colormaps_reference.html">Spectral</a>,
that is divergent. This made me think about
using a cyclic colormap, and ended up in
<a class="reference external" href="https://stackoverflow.com/q/23712207/3358223">this StackOverflow</a> question.
And I decided to compare some cyclic colormaps.</p>
<p>I picked up colormaps from different sources</p>
<ul class="simple">
<li>
<p><a class="reference external" href="https://matplotlib.org/cmocean/">cmocean</a>:</p>
<ul>
<li><p>phase</p></li>
</ul>
</li>
<li>
<p><a class="reference external" href="http://paraview.org/">Paraview</a>:</p>
<ul>
<li><p>hue_L60</p></li>
<li><p>erdc_iceFire</p></li>
<li><p>nic_Edge</p></li>
</ul>
</li>
<li>
<p><a class="reference external" href="https://github.com/bokeh/colorcet">Colorcet</a>:</p>
<ul>
<li><p>colorwheel</p></li>
<li><p>cyclic_mrybm_35_75_c68</p></li>
<li><p>cyclic_mygbm_30_95_c78</p></li>
</ul>
</li>
</ul>
<p>and, of course, <code class="docutils literal">hsv</code>. You can download the colormaps in text
format from <a class="reference external" href="downloads/cyclic_colormaps.zip">here</a>.</p>
<div class="section" id="comparison">
<h2>Comparison</h2>
<p>For all the examples below the following imports are done:</p>
<pre class="code python"><a name="rest_code_d732ac2f09184a3ab891b6db116f5516-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_d732ac2f09184a3ab891b6db116f5516-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_d732ac2f09184a3ab891b6db116f5516-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_d732ac2f09184a3ab891b6db116f5516-4"></a><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<a name="rest_code_d732ac2f09184a3ab891b6db116f5516-5"></a><span class="kn">from</span> <span class="nn">colorspacious</span> <span class="kn">import</span> <span class="n">cspace_convert</span>
</pre>
<div class="section" id="color-map-test-image">
<h3>Color map test image</h3>
<p>Peter Kovesi proposed a way to compare cyclic colormaps on a
<a class="reference external" href="http://peterkovesi.com/projects/colourmaps/colourmaptestimage.html">paper</a>
on 2015. It consists of a spiral ramp with an undulation. In polar coordinates
it reads</p>
<div class="math">
\begin{equation*}
c = (A \rho^p \sin(n \theta) + \theta)\, \mathrm{mod}\, 2\pi
\end{equation*}
</div>
<p>with <span class="math">\(A\)</span> the amplitude of the oscilation, <span class="math">\(\rho\)</span> the normalized
radius in [0, 1], <span class="math">\(p\)</span> a positive number, and <span class="math">\(n\)</span> the number
of cycles.</p>
<p>And the following function creates the grid in Python</p>
<pre class="code python"><a name="rest_code_1275c698065d4bbd8b4c8b18abb879d3-1"></a><span class="k">def</span> <span class="nf">circle_sine_ramp</span><span class="p">(</span><span class="n">r_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">r_min</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">cycles</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a name="rest_code_1275c698065d4bbd8b4c8b18abb879d3-2"></a>                     <span class="n">power</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ntheta</span><span class="o">=</span><span class="mi">1025</span><span class="p">):</span>
<a name="rest_code_1275c698065d4bbd8b4c8b18abb879d3-3"></a><span class="n">r</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">r_min</span><span class="p">:</span><span class="n">r_max</span><span class="p">:</span><span class="n">nr</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="n">ntheta</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
<a name="rest_code_1275c698065d4bbd8b4c8b18abb879d3-4"></a><span class="n">r_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">r_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">r_max</span> <span class="o">-</span> <span class="n">r_min</span><span class="p">)</span>
<a name="rest_code_1275c698065d4bbd8b4c8b18abb879d3-5"></a><span class="n">vals</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">r_norm</span><span class="o">**</span><span class="n">power</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">cycles</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">t</span>
<a name="rest_code_1275c698065d4bbd8b4c8b18abb879d3-6"></a><span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<a name="rest_code_1275c698065d4bbd8b4c8b18abb879d3-7"></a><span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">vals</span>
</pre>
<p>The following is the result</p>
<img alt="/images/sine_helix_cyclic_cmap.png" src="images/sine_helix_cyclic_cmap.png">
</div>
<div class="section" id="colorblindness-test">
<h3>Colorblindness test</h3>
<pre class="code python"><a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-1"></a><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">circle_sine_ramp</span><span class="p">(</span><span class="n">cycles</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-2"></a><span class="n">cmaps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"hsv"</span><span class="p">,</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-3"></a>         <span class="s2">"cmocean_phase"</span><span class="p">,</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-4"></a>         <span class="s2">"hue_L60"</span><span class="p">,</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-5"></a>         <span class="s2">"erdc_iceFire"</span><span class="p">,</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-6"></a>         <span class="s2">"nic_Edge"</span><span class="p">,</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-7"></a>         <span class="s2">"colorwheel"</span><span class="p">,</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-8"></a>         <span class="s2">"cyclic_mrybm"</span><span class="p">,</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-9"></a>         <span class="s2">"cyclic_mygbm"</span><span class="p">]</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-10"></a><span class="n">severity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-11"></a><span class="k">for</span> <span class="n">colormap</span> <span class="ow">in</span> <span class="n">cmaps</span><span class="p">:</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-12"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">colormap</span> <span class="o">+</span> <span class="s2">".txt"</span><span class="p">)</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-13"></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-14"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-15"></a>        <span class="n">cvd_space</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"sRGB1+CVD"</span><span class="p">,</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-16"></a>             <span class="s2">"cvd_type"</span><span class="p">:</span> <span class="n">cvd_type</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-17"></a>             <span class="s2">"severity"</span><span class="p">:</span> <span class="n">severity</span><span class="p">[</span><span class="n">cont</span><span class="p">]}</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-18"></a>        <span class="n">data2</span> <span class="o">=</span> <span class="n">cspace_convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cvd_space</span><span class="p">,</span> <span class="s2">"sRGB1"</span><span class="p">)</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-19"></a>        <span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-20"></a>        <span class="n">cmap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">'my_colormap'</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-21"></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">cont</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">"polar"</span><span class="p">)</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-22"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-23"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-24"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-25"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-26"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a name="rest_code_87ffdf1f77424e3fa0650f76b4de6d22-27"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">colormap</span> <span class="o">+</span> <span class="s2">".png"</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre>
<div class="figure align-center">
<img alt="/images/hsv_eval.png" src="images/hsv_eval.png"><p class="caption"><code class="docutils literal">hsv</code> colormap comparison for different color vision deficiencies.</p>
</div>
<div class="figure align-center">
<img alt="/images/cmocean_phase_eval.png" src="images/cmocean_phase_eval.png"><p class="caption"><code class="docutils literal">Phase</code> colormap comparison for different color vision deficiencies.</p>
</div>
<div class="figure align-center">
<img alt="/images/hue_L60_eval.png" src="images/hue_L60_eval.png"><p class="caption"><code class="docutils literal">hue_L60</code> colormap comparison for different color vision deficiencies.</p>
</div>
<div class="figure align-center">
<img alt="/images/erdc_iceFire_eval.png" src="images/erdc_iceFire_eval.png"><p class="caption"><code class="docutils literal">erdc_iceFire</code> colormap comparison for different color vision deficiencies.</p>
</div>
<div class="figure align-center">
<img alt="/images/nic_Edge_eval.png" src="images/nic_Edge_eval.png"><p class="caption"><code class="docutils literal">nic_Edge</code> colormap comparison for different color vision deficiencies.</p>
</div>
<div class="figure align-center">
<img alt="/images/colorwheel_eval.png" src="images/colorwheel_eval.png"><p class="caption"><code class="docutils literal">Colorwheel</code> colormap comparison for different color vision deficiencies.</p>
</div>
<div class="figure align-center">
<img alt="/images/cyclic_mrybm_eval.png" src="images/cyclic_mrybm_eval.png"><p class="caption"><code class="docutils literal">Cyclic_mrybm</code> colormap comparison for different color vision deficiencies.</p>
</div>
<div class="figure align-center">
<img alt="/images/cyclic_mygbm_eval.png" src="images/cyclic_mygbm_eval.png"><p class="caption"><code class="docutils literal">Cyclic_mygbm</code> colormap comparison for different color vision deficiencies.</p>
</div>
</div>
</div>
<div class="section" id="randomly-generated-cyclic-colormaps">
<h2>Randomly generated cyclic colormaps</h2>
<p>What if we generate some random colormaps that are cyclic? How would they
look like?</p>
<p>Following are the snippet and resulting colormaps.</p>
<pre class="code python"><a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-3"></a><span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-5"></a><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-6"></a>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-7"></a>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-8"></a><span class="c1"># Next line to silence pyflakes. This import is needed.</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-9"></a><span class="n">Axes3D</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-10"></a>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">"all"</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-12"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-13"></a><span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-14"></a><span class="n">nx</span> <span class="o">=</span> <span class="mi">4</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-15"></a><span class="n">ny</span> <span class="o">=</span> <span class="mi">4</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-16"></a><span class="n">azimuths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">361</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-17"></a><span class="n">zeniths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-18"></a><span class="n">values</span> <span class="o">=</span> <span class="n">azimuths</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">361</span><span class="p">))</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-19"></a><span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span><span class="p">):</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-20"></a>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">cont</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-21"></a>    <span class="n">rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-22"></a>    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rad</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-23"></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-24"></a>    <span class="n">rot_mat</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">qr</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-25"></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-26"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">rad</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-27"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">rad</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-28"></a>    <span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-29"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-30"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">rot_mat</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-31"></a>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-32"></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">cont</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">'polar'</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-33"></a>    <span class="n">cmap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">'my_colormap'</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-34"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">azimuths</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">,</span> <span class="n">zeniths</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-35"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-36"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-37"></a>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-38"></a>    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">cont</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">'3d'</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-39"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-40"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-41"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-42"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-43"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-44"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-45"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-46"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-47"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-48"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-49"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">set_zticklabels</span><span class="p">([])</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-50"></a>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-51"></a>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-52"></a><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"random_cmaps.png"</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a name="rest_code_59eff08646354a298a94acbf3c4bcd6e-53"></a><span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"random_cmaps_traj.svg"</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre>
<div class="figure align-center">
<img alt="/images/random_cmaps.png" src="images/random_cmaps.png"><p class="caption">16 randomly generated colormaps.</p>
</div>
<div class="figure align-center">
<img alt="/images/random_cmaps_traj.svg" src="images/random_cmaps_traj.svg"><p class="caption">Trajectories in RGB space for the randomly generated colormaps.</p>
</div>
<p>A good idea would be to take these colormaps and optimize some perceptual
parameters such as lightness to get some usable ones.</p>
</div>
<div class="section" id="conclusions">
<h2>Conclusions</h2>
<p>I probably would use <code class="docutils literal">phase</code>, <code class="docutils literal">colorwheel</code>, or <code class="docutils literal">mrybm</code> in the
future.</p>
<div class="figure align-center">
<img alt="/images/toroidal_helix_phase.svg" src="images/toroidal_helix_phase.svg"><p class="caption">Initial image using <code class="docutils literal">phase</code>.</p>
</div>
<div class="figure align-center">
<img alt="/images/toroidal_helix_colorwheel.svg" src="images/toroidal_helix_colorwheel.svg"><p class="caption">Initial image using <code class="docutils literal">colorwheel</code>.</p>
</div>
<div class="figure align-center">
<img alt="/images/toroidal_helix_mrybm.svg" src="images/toroidal_helix_mrybm.svg"><p class="caption">Initial image using <code class="docutils literal">mrybm</code>.</p>
</div>
</div>
<div class="section" id="references">
<h2>References</h2>
<ol class="arabic simple">
<li><p>Peter Kovesi. Good Colour Maps: How to Design Them.
arXiv:1509.03700 [cs.GR] 2015</p></li>
</ol>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/putnam_prob/" class="u-url">Probability that a random tetrahedron over a sphere contains its center</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="posts/putnam_prob/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-12-13T15:24:52-05:00" title="2017-12-13 15:24">2017-12-13 15:24</time></a></p>
                <p class="commentline">
        
    <a href="posts/putnam_prob/#disqus_thread" data-disqus-identifier="cache/posts/putnam_prob.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I got interested in this problem watching the YouTube channel
<a class="reference external" href="https://www.youtube.com/channel/UCYO_jab_esuFRV4b17AJtAw">3Blue1Brown</a>,
by Grant Sanderson, where he explains a way to tackle the problem that
is just … elegant!</p>
<p>I can't emphasize enough how much I like this channel. For example,
his approach to linear algebra in
<a class="reference external" href="https://www.youtube.com/watch?v=kjBOesZCoqc&amp;list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab">Essence of linear algebra</a> is really
good. I mention it, just in case you don't know it.</p>
<div class="section" id="the-problem">
<h2>The problem</h2>
<p>Let's talk business now. The problem was originally part of the 53rd
<a class="reference external" href="http://kskedlaya.org/putnam-archive/1992.pdf">Putnam competition on 1992</a>
and was stated as</p>
<blockquote>
<p>Four points are chosen at random on the surface of a
sphere.   What is the probability that the center of the
sphere lies inside the tetrahedron whose vertices are at
the four points?  (It is understood that each point is in-
dependently chosen relative to a uniform distribution on
the sphere.)</p>
</blockquote>
<p>As shown in the mentioned video, the probability is <span class="math">\(1/8\)</span>. Let's
come with an algorithm to obtain this result —approximately, at least.</p>
</div>
<div class="section" id="the-proposed-approach">
<h2>The proposed approach</h2>
<p>The approach that we are going to use is pretty straightforward. We are
going to obtain a sample of (independent) random sets, with four points
each, and check how many of them satisfy the condition of being inside
the tetrahedron with the points as vertices.</p>
<p>For this approach to work, we need two things:</p>
<ol class="arabic simple">
<li><p>A way to generate random numbers uniformly distributed. This is already
in <code class="docutils literal">numpy.random.uniform</code>, so we don't need to do much about it.</p></li>
<li><p>A way to check if a point is inside a tetrahedron.</p></li>
</ol>
<div class="section" id="checking-that-a-point-is-inside-a-tetrahedron">
<h3>Checking that a point is inside a tetrahedron</h3>
<p>To find if a point is inside a tetrahedron, we could compute the
<a class="reference external" href="https://en.wikipedia.org/wiki/Barycentric_coordinate_system">barycentric coordinates</a>
for that point and check that all of them are have the same sign. Equivalently,
as proposed <a class="reference external" href="http://steve.hollasch.net/cgindex/geometry/ptintet.html">here</a>,
we can check that the determinants of the matrices</p>
<div class="math">
\begin{equation*}
M_0 =
\begin{bmatrix}
x_0 &amp;y_0 &amp;z_0 &amp;1\\
x_1 &amp;y_1 &amp;z_1 &amp;1\\
x_2 &amp;y_2 &amp;z_2 &amp;1\\
x_3 &amp;y_3 &amp;z_3 &amp;1
\end{bmatrix}\, ,
\end{equation*}
</div>
<div class="math">
\begin{equation*}
M_1 =
\begin{bmatrix}
x &amp;y &amp;z &amp;1\\
x_1 &amp;y_1 &amp;z_1 &amp;1\\
x_2 &amp;y_2 &amp;z_2 &amp;1\\
x_3 &amp;y_3 &amp;z_3 &amp;1
\end{bmatrix}\, ,
\end{equation*}
</div>
<div class="math">
\begin{equation*}
M_2 =
\begin{bmatrix}
x_0 &amp;y_0 &amp;z_0 &amp;1\\
x &amp;y &amp;z &amp;1\\
x_2 &amp;y_2 &amp;z_2 &amp;1\\
x_3 &amp;y_3 &amp;z_3 &amp;1
\end{bmatrix}\, ,
\end{equation*}
</div>
<div class="math">
\begin{equation*}
M_3 =
\begin{bmatrix}
x_0 &amp;y_0 &amp;z_0 &amp;1\\
x_1 &amp;y_1 &amp;z_1 &amp;1\\
x &amp;y &amp;z &amp;1\\
x_3 &amp;y_3 &amp;z_3 &amp;1
\end{bmatrix}\, ,
\end{equation*}
</div>
<div class="math">
\begin{equation*}
M_4 =
\begin{bmatrix}
x_0 &amp;y_0 &amp;z_0 &amp;1\\
x_1 &amp;y_1 &amp;z_1 &amp;1\\
x_2 &amp;y_2 &amp;z_2 &amp;1\\
x &amp;y &amp;z &amp;1
\end{bmatrix}\, ,
\end{equation*}
</div>
<p>have the same sign. In this case, <span class="math">\((x, y, z)\)</span> is the point of interest
and <span class="math">\((x_i, y_i, z_i)\)</span> are the coordinates of each vertex.</p>
</div>
</div>
<div class="section" id="the-algorithm">
<h2>The algorithm</h2>
<p>Below is a Python implementation of the approach discussed before</p>
<pre class="code python"><a name="rest_code_302464fb223b45a581781697d3bb60d6-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-2"></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="p">(</span><span class="n">random</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">hstack</span><span class="p">,</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-3"></a>                   <span class="n">column_stack</span><span class="p">,</span> <span class="n">logspace</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-4"></a><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">det</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-5"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-6"></a>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-7"></a>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-8"></a><span class="k">def</span> <span class="nf">in_tet</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-9"></a>    <span class="sd">"""</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-10"></a><span class="sd">    Determine if the point pt is inside the</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-11"></a><span class="sd">    tetrahedron with vertices coordinates x, y, z</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-12"></a><span class="sd">    """</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-13"></a>    <span class="n">mat0</span> <span class="o">=</span> <span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-14"></a>    <span class="n">det0</span> <span class="o">=</span> <span class="n">det</span><span class="p">(</span><span class="n">mat0</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-15"></a>    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-16"></a>        <span class="n">mat</span> <span class="o">=</span> <span class="n">mat0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-17"></a>        <span class="n">mat</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">pt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-18"></a>        <span class="k">if</span> <span class="n">sign</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">*</span><span class="n">det0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-19"></a>            <span class="n">inside</span> <span class="o">=</span> <span class="kc">False</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-20"></a>            <span class="k">break</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-21"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-22"></a>            <span class="n">inside</span> <span class="o">=</span> <span class="kc">True</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-23"></a>    <span class="k">return</span> <span class="n">inside</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-24"></a>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-25"></a>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-26"></a><span class="c1">#%% Computation</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-27"></a><span class="n">prob</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-28"></a><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-29"></a><span class="n">N_min</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-30"></a><span class="n">N_max</span> <span class="o">=</span> <span class="mi">5</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-31"></a><span class="n">N_vals</span> <span class="o">=</span> <span class="n">logspace</span><span class="p">(</span><span class="n">N_min</span><span class="p">,</span> <span class="n">N_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-32"></a><span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">N_vals</span><span class="p">:</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-33"></a>    <span class="n">inside_cont</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-34"></a>    <span class="k">for</span> <span class="n">cont_pts</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-35"></a>        <span class="n">phi</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-36"></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-37"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-38"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-39"></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-40"></a>        <span class="k">if</span> <span class="n">in_tet</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-41"></a>            <span class="n">inside_cont</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-42"></a>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-43"></a>    <span class="n">prob</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inside_cont</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-44"></a>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-45"></a>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-46"></a><span class="c1">#%% Plotting</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-47"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-48"></a><span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mf">0.125</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">N_min</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">N_max</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"#3f3f3f"</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-49"></a><span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">N_vals</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-50"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Number of trials"</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-51"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Computed probability"</span><span class="p">)</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-52"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a name="rest_code_302464fb223b45a581781697d3bb60d6-53"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
<p>As expected, when the number of samples is sufficiently large, the
estimated probability is close to the theoretical value: 0.125. This
can be seen in the following figure.</p>
<img alt="Computed probability for different sample sizes" class="align-center" src="images/random_tets.svg" style="width: 600px;">
</div>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="." rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-4.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="nicoguaro-github";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script><footer id="footer"><p>Contents © 2021 <a href="mailto:nicoguarin@gmail.com">Nicolás Guarín-Zapata</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a></p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145359674-1', 'auto');
ga('send', 'pageview');
</script><script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
