<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Finite differences in infinite domains | Nicolás' blog</title>
<link href="../../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" href="../../es/rss.xml">
<link rel="canonical" href="https://nicoguaro.github.io/posts/infinite_fdm/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Nicolás Guarín-Zapata">
<link rel="prev" href="../cyclic_colormaps/" title="Cyclic colormaps comparison" type="text/html">
<link rel="next" href="../isometric_inkscape/" title="Isometric graphics in Inkscape" type="text/html">
<meta property="og:site_name" content="Nicolás' blog">
<meta property="og:title" content="Finite differences in infinite domains">
<meta property="og:url" content="https://nicoguaro.github.io/posts/infinite_fdm/">
<meta property="og:description" content="Finite differences in infinite domains
Because of my friend, Edward Villegas, I
ended up thinking about using a change of variables when solving an
eigenvalue problem with finite difference.

The prob">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-05-17T15:57:00-05:00">
<meta property="article:tag" content="finite difference method">
<meta property="article:tag" content="pde">
<meta property="article:tag" content="python">
<meta property="article:tag" content="quantum mechanics">
<meta property="article:tag" content="scientific computing">
<link rel="alternate" hreflang="es" href="../../es/posts/infinite_fdm/">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>This is my personal website and blog.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../pages/about/">About</a>
        <a class="sidebar-nav-item" href="../../index.html">Blog</a>
        <a class="sidebar-nav-item" href="../../pages/preprints-archive/">Preprints</a>
        <a class="sidebar-nav-item" href="../../pages/links/">Links</a>
        <a class="sidebar-nav-item" href="../../archive.html">Archives</a>
        <a class="sidebar-nav-item" href="../../categories/">Tags</a>
        <a class="sidebar-nav-item" href="../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://nicoguaro.github.io/" title="Nicolás' blog" rel="home">Nicolás' blog</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="." class="u-url">Finite differences in infinite domains</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Nicolás Guarín-Zapata</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="post-date published dt-published" datetime="2018-05-17T15:57:00-05:00" itemprop="datePublished" title="2018-05-17 15:57">2018-05-17 15:57</time></a></p>
                <p class="commentline">
    
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/infinite_fdm.html">Comments</a>


        </p>
</div>
        
        <div class="metadata posttranslations translations">
            <h3 class="posttranslations-intro">Also available in:</h3>
                <p><a href="../../es/posts/infinite_fdm/" rel="alternate" hreflang="es">Español</a></p>
        </div>

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <section id="finite-differences-in-infinite-domains"><h2>Finite differences in infinite domains</h2>
<p>Because of my friend, <a class="reference external" href="http://cosmoscalibur.com/">Edward Villegas</a>, I
ended up thinking about using a change of variables when solving an
eigenvalue problem with finite difference.</p>
<section id="the-problem"><h3>The problem</h3>
<p>Let's say that we want to solve a differential equation over an infinite
domain. A common case is to solve the <a class="reference external" href="https://en.wikipedia.org/wiki/Schr%C3%B6dinger_equation#Time-independent_equation">Time independent Schrödinger
equation</a>
subject to a potential <span class="math">\(V(x)\)</span>. For example</p>
<div class="math">
\begin{equation*}
-\frac{1}{2}\frac{\mathrm{d}^2}{\mathrm{d}x^2}\psi(x) + V(x) \psi(x) = E\psi(x),\quad \forall x\in (-\infty, \infty),
\end{equation*}
</div>
<p>where we want to find the pairs of eigenvalues/eigenfunctions
<span class="math">\((E_n, \psi_n(x))\)</span>.</p>
<p>What I normally do when using <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_difference_method">finite
differences</a>
is to regularly divide the domain. Where I take a <em>large enough</em> domain,
so the solution have decayed close to zero. What I do in this post is to
make a change of variable to render the interval finite first and then
regularly divide the transformed domain in finite intervals.</p>
</section><section id="my-usual-approach"><h3>My usual approach</h3>
<p>My usual approach is to approach the second derivative with a <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_difference_coefficient">centered
difference</a>
for the point <span class="math">\(x_i\)</span> like this</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}^2 f(x)}{\mathrm{d}x^2} \approx \frac{f(x + \Delta x) - 2 f(x_i) + f(x - \Delta x)}{\Delta x^2}\, ,
\end{equation*}
</div>
<p>with <span class="math">\(\Delta x\)</span> the separation between points.</p>
<p>We can solve this in Python with the following snippet:</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_3baac3214219442c866a71cd397013e1-1" name="rest_code_3baac3214219442c866a71cd397013e1-1" href="#rest_code_3baac3214219442c866a71cd397013e1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-2" name="rest_code_3baac3214219442c866a71cd397013e1-2" href="#rest_code_3baac3214219442c866a71cd397013e1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.sparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">diags</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-3" name="rest_code_3baac3214219442c866a71cd397013e1-3" href="#rest_code_3baac3214219442c866a71cd397013e1-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.sparse.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">eigs</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-4" name="rest_code_3baac3214219442c866a71cd397013e1-4" href="#rest_code_3baac3214219442c866a71cd397013e1-4"></a>
<a id="rest_code_3baac3214219442c866a71cd397013e1-5" name="rest_code_3baac3214219442c866a71cd397013e1-5" href="#rest_code_3baac3214219442c866a71cd397013e1-5"></a>
<a id="rest_code_3baac3214219442c866a71cd397013e1-6" name="rest_code_3baac3214219442c866a71cd397013e1-6" href="#rest_code_3baac3214219442c866a71cd397013e1-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">regular_FD</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nvals</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-7" name="rest_code_3baac3214219442c866a71cd397013e1-7" href="#rest_code_3baac3214219442c866a71cd397013e1-7"></a><span class="w">    </span><span class="sd">"""</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-8" name="rest_code_3baac3214219442c866a71cd397013e1-8" href="#rest_code_3baac3214219442c866a71cd397013e1-8"></a><span class="sd">    Find eigenvalues/eigenfunctions for Schrodinger</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-9" name="rest_code_3baac3214219442c866a71cd397013e1-9" href="#rest_code_3baac3214219442c866a71cd397013e1-9"></a><span class="sd">    equation for the given potential `pot` using</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-10" name="rest_code_3baac3214219442c866a71cd397013e1-10" href="#rest_code_3baac3214219442c866a71cd397013e1-10"></a><span class="sd">    finite differences</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-11" name="rest_code_3baac3214219442c866a71cd397013e1-11" href="#rest_code_3baac3214219442c866a71cd397013e1-11"></a><span class="sd">    """</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-12" name="rest_code_3baac3214219442c866a71cd397013e1-12" href="#rest_code_3baac3214219442c866a71cd397013e1-12"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">x_max</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-13" name="rest_code_3baac3214219442c866a71cd397013e1-13" href="#rest_code_3baac3214219442c866a71cd397013e1-13"></a>    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-14" name="rest_code_3baac3214219442c866a71cd397013e1-14" href="#rest_code_3baac3214219442c866a71cd397013e1-14"></a>    <span class="n">D2</span> <span class="o">=</span> <span class="n">diags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-15" name="rest_code_3baac3214219442c866a71cd397013e1-15" href="#rest_code_3baac3214219442c866a71cd397013e1-15"></a>    <span class="n">V</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-16" name="rest_code_3baac3214219442c866a71cd397013e1-16" href="#rest_code_3baac3214219442c866a71cd397013e1-16"></a>    <span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">D2</span> <span class="o">+</span> <span class="n">V</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-17" name="rest_code_3baac3214219442c866a71cd397013e1-17" href="#rest_code_3baac3214219442c866a71cd397013e1-17"></a>    <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">eigs</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">nvals</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SM"</span><span class="p">)</span>
<a id="rest_code_3baac3214219442c866a71cd397013e1-18" name="rest_code_3baac3214219442c866a71cd397013e1-18" href="#rest_code_3baac3214219442c866a71cd397013e1-18"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">vecs</span>
</pre></div>
<p>Let's setup the plotting details.</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_006d702b55e2483c9db699a6c13fbff4-1" name="rest_code_006d702b55e2483c9db699a6c13fbff4-1" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-1"></a><span class="c1"># Jupyter notebook plotting setup &amp; imports</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-2" name="rest_code_006d702b55e2483c9db699a6c13fbff4-2" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-2"></a><span class="o">%</span><span class="k">matplotlib</span> notebook
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-3" name="rest_code_006d702b55e2483c9db699a6c13fbff4-3" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-4" name="rest_code_006d702b55e2483c9db699a6c13fbff4-4" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-4"></a>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-5" name="rest_code_006d702b55e2483c9db699a6c13fbff4-5" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-5"></a><span class="n">gray</span> <span class="o">=</span> <span class="s1">'#757575'</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-6" name="rest_code_006d702b55e2483c9db699a6c13fbff4-6" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-7" name="rest_code_006d702b55e2483c9db699a6c13fbff4-7" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"mathtext.fontset"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"cm"</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-8" name="rest_code_006d702b55e2483c9db699a6c13fbff4-8" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"text.color"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-9" name="rest_code_006d702b55e2483c9db699a6c13fbff4-9" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-9"></a><span class="n">fontsize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"font.size"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-10" name="rest_code_006d702b55e2483c9db699a6c13fbff4-10" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"xtick.color"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-11" name="rest_code_006d702b55e2483c9db699a6c13fbff4-11" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"ytick.color"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-12" name="rest_code_006d702b55e2483c9db699a6c13fbff4-12" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"axes.labelcolor"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-13" name="rest_code_006d702b55e2483c9db699a6c13fbff4-13" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-13"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"axes.edgecolor"</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-14" name="rest_code_006d702b55e2483c9db699a6c13fbff4-14" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"axes.spines.right"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="rest_code_006d702b55e2483c9db699a6c13fbff4-15" name="rest_code_006d702b55e2483c9db699a6c13fbff4-15" href="#rest_code_006d702b55e2483c9db699a6c13fbff4-15"></a><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"axes.spines.top"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
<p>Let's consider the <a class="reference external" href="https://en.wikipedia.org/wiki/Quantum_harmonic_oscillator">Quantum harmonic
oscillator</a>,
that has as eigenvalues</p>
<div class="math">
\begin{equation*}
E_n = n + \frac{1}{2},\quad \forall n = 0, 1, 2 \cdots
\end{equation*}
</div>
<p>Using the finite difference method we have values that are really close
to the analytic ones.</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_f691668d84744961aeb60afc5b290686-1" name="rest_code_f691668d84744961aeb60afc5b290686-1" href="#rest_code_f691668d84744961aeb60afc5b290686-1"></a><span class="n">x</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">regular_FD</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
<a id="rest_code_f691668d84744961aeb60afc5b290686-2" name="rest_code_f691668d84744961aeb60afc5b290686-2" href="#rest_code_f691668d84744961aeb60afc5b290686-2"></a><span class="n">vals</span>
</pre></div>
<p>with output</p>
<pre class="literal-block">array([0.4996873 , 1.49843574, 2.49593063, 3.49216962, 4.48715031,
       5.4808703 ])</pre>
<p>With the analytic ones</p>
<div class="code"><pre class="code text"><a id="rest_code_1d7baf16b108445792359af1893aa914-1" name="rest_code_1d7baf16b108445792359af1893aa914-1" href="#rest_code_1d7baf16b108445792359af1893aa914-1"></a>[0.5, 1.5, 2.5, 3.5, 4.5, 5.5])
</pre></div>
<p>If we plot these two, we obtain the following.</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_28d2229ae6e84558a93a65f05bfbdc84-1" name="rest_code_28d2229ae6e84558a93a65f05bfbdc84-1" href="#rest_code_28d2229ae6e84558a93a65f05bfbdc84-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a id="rest_code_28d2229ae6e84558a93a65f05bfbdc84-2" name="rest_code_28d2229ae6e84558a93a65f05bfbdc84-2" href="#rest_code_28d2229ae6e84558a93a65f05bfbdc84-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anal_vals</span><span class="p">)</span>
<a id="rest_code_28d2229ae6e84558a93a65f05bfbdc84-3" name="rest_code_28d2229ae6e84558a93a65f05bfbdc84-3" href="#rest_code_28d2229ae6e84558a93a65f05bfbdc84-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">)</span>
<a id="rest_code_28d2229ae6e84558a93a65f05bfbdc84-4" name="rest_code_28d2229ae6e84558a93a65f05bfbdc84-4" href="#rest_code_28d2229ae6e84558a93a65f05bfbdc84-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_28d2229ae6e84558a93a65f05bfbdc84-5" name="rest_code_28d2229ae6e84558a93a65f05bfbdc84-5" href="#rest_code_28d2229ae6e84558a93a65f05bfbdc84-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$E_n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_28d2229ae6e84558a93a65f05bfbdc84-6" name="rest_code_28d2229ae6e84558a93a65f05bfbdc84-6" href="#rest_code_28d2229ae6e84558a93a65f05bfbdc84-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Analytic"</span><span class="p">,</span> <span class="s2">"Finite differences"</span><span class="p">])</span>
<a id="rest_code_28d2229ae6e84558a93a65f05bfbdc84-7" name="rest_code_28d2229ae6e84558a93a65f05bfbdc84-7" href="#rest_code_28d2229ae6e84558a93a65f05bfbdc84-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
<img alt="Eigenvalues for the regular finite difference" class="align-center" src="../../images/infinite_fdm/eigvals_regular.svg" style="width: 600px;"><p>Let's see the eigenfunctions.</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_4407d8305219439e8b9ea99a2a7423ec-1" name="rest_code_4407d8305219439e8b9ea99a2a7423ec-1" href="#rest_code_4407d8305219439e8b9ea99a2a7423ec-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a id="rest_code_4407d8305219439e8b9ea99a2a7423ec-2" name="rest_code_4407d8305219439e8b9ea99a2a7423ec-2" href="#rest_code_4407d8305219439e8b9ea99a2a7423ec-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vecs</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_4407d8305219439e8b9ea99a2a7423ec-3" name="rest_code_4407d8305219439e8b9ea99a2a7423ec-3" href="#rest_code_4407d8305219439e8b9ea99a2a7423ec-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a id="rest_code_4407d8305219439e8b9ea99a2a7423ec-4" name="rest_code_4407d8305219439e8b9ea99a2a7423ec-4" href="#rest_code_4407d8305219439e8b9ea99a2a7423ec-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_4407d8305219439e8b9ea99a2a7423ec-5" name="rest_code_4407d8305219439e8b9ea99a2a7423ec-5" href="#rest_code_4407d8305219439e8b9ea99a2a7423ec-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$|\psi_n(x)|^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_4407d8305219439e8b9ea99a2a7423ec-6" name="rest_code_4407d8305219439e8b9ea99a2a7423ec-6" href="#rest_code_4407d8305219439e8b9ea99a2a7423ec-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<a id="rest_code_4407d8305219439e8b9ea99a2a7423ec-7" name="rest_code_4407d8305219439e8b9ea99a2a7423ec-7" href="#rest_code_4407d8305219439e8b9ea99a2a7423ec-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
<img alt="Eigenfunctions for the regular finite difference" class="align-center" src="../../images/infinite_fdm/eigvecs_regular.svg" style="width: 600px;"><p>One inconvenient with this method is the redundant sampling towards the
extreme of the intervals, while under sample the middle part.</p>
</section><section id="changing-the-domain"><h3>Changing the domain</h3>
<p>Let's now consider the case where we transform the infinite domain to a
finite one with a change of variable</p>
<div class="math">
\begin{equation*}
\xi = \xi(x)
\end{equation*}
</div>
<p>with <span class="math">\(\xi \in (-1, 1)\)</span>. Two options for this transformation are:</p>
<ul class="simple">
<li><p><span class="math">\(\xi = \tanh x\)</span>; and</p></li>
<li><p><span class="math">\(\xi = \frac{2}{\pi} \arctan x\)</span>.</p></li>
</ul>
<p>Making this change of variable the equation we need to solve the
following equation</p>
<div class="math">
\begin{equation*}
-\frac{1}{2}\left(\frac{\mathrm{d}\xi}{\mathrm{d}x}\right)^2\frac{\mathrm{d}^2}{\mathrm{d}\xi^2}\psi(\xi) - \frac{1}{2}\frac{\mathrm{d}^2\xi}{\mathrm{d}x^2}\frac{\mathrm{d}}{\mathrm{d}\xi}\psi(\xi) + V(\xi) \psi(\xi) = E\psi(\xi)
\end{equation*}
</div>
<p>The following snippet solve the eigenproblem for the mapped domain:</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_379f9c6541094947bfc584a257df52d4-1" name="rest_code_379f9c6541094947bfc584a257df52d4-1" href="#rest_code_379f9c6541094947bfc584a257df52d4-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">mapped_FD</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">dxdxi</span><span class="p">,</span> <span class="n">dxdxi2</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">nvals</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">xi_tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-2" name="rest_code_379f9c6541094947bfc584a257df52d4-2" href="#rest_code_379f9c6541094947bfc584a257df52d4-2"></a><span class="w">    </span><span class="sd">"""</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-3" name="rest_code_379f9c6541094947bfc584a257df52d4-3" href="#rest_code_379f9c6541094947bfc584a257df52d4-3"></a><span class="sd">    Find eigenvalues/eigenfunctions for Schrodinger</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-4" name="rest_code_379f9c6541094947bfc584a257df52d4-4" href="#rest_code_379f9c6541094947bfc584a257df52d4-4"></a><span class="sd">    equation for the given potential `pot` using</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-5" name="rest_code_379f9c6541094947bfc584a257df52d4-5" href="#rest_code_379f9c6541094947bfc584a257df52d4-5"></a><span class="sd">    finite differences over a mapped domain on (-1, 1)</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-6" name="rest_code_379f9c6541094947bfc584a257df52d4-6" href="#rest_code_379f9c6541094947bfc584a257df52d4-6"></a><span class="sd">    """</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-7" name="rest_code_379f9c6541094947bfc584a257df52d4-7" href="#rest_code_379f9c6541094947bfc584a257df52d4-7"></a>    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi_tol</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">xi_tol</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-8" name="rest_code_379f9c6541094947bfc584a257df52d4-8" href="#rest_code_379f9c6541094947bfc584a257df52d4-8"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-9" name="rest_code_379f9c6541094947bfc584a257df52d4-9" href="#rest_code_379f9c6541094947bfc584a257df52d4-9"></a>    <span class="n">dxi</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-10" name="rest_code_379f9c6541094947bfc584a257df52d4-10" href="#rest_code_379f9c6541094947bfc584a257df52d4-10"></a>    <span class="n">D2</span> <span class="o">=</span> <span class="n">diags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span><span class="o">/</span><span class="n">dxi</span><span class="o">**</span><span class="mi">2</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-11" name="rest_code_379f9c6541094947bfc584a257df52d4-11" href="#rest_code_379f9c6541094947bfc584a257df52d4-11"></a>    <span class="n">D1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">diags</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span><span class="o">/</span><span class="n">dxi</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-12" name="rest_code_379f9c6541094947bfc584a257df52d4-12" href="#rest_code_379f9c6541094947bfc584a257df52d4-12"></a>    <span class="n">V</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-13" name="rest_code_379f9c6541094947bfc584a257df52d4-13" href="#rest_code_379f9c6541094947bfc584a257df52d4-13"></a>    <span class="n">fac1</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">dxdxi</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-14" name="rest_code_379f9c6541094947bfc584a257df52d4-14" href="#rest_code_379f9c6541094947bfc584a257df52d4-14"></a>    <span class="n">fac2</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">dxdxi2</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-15" name="rest_code_379f9c6541094947bfc584a257df52d4-15" href="#rest_code_379f9c6541094947bfc584a257df52d4-15"></a>    <span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fac1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">fac2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D1</span><span class="p">)</span> <span class="o">+</span> <span class="n">V</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-16" name="rest_code_379f9c6541094947bfc584a257df52d4-16" href="#rest_code_379f9c6541094947bfc584a257df52d4-16"></a>    <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">eigs</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">nvals</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SM"</span><span class="p">)</span>
<a id="rest_code_379f9c6541094947bfc584a257df52d4-17" name="rest_code_379f9c6541094947bfc584a257df52d4-17" href="#rest_code_379f9c6541094947bfc584a257df52d4-17"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">vecs</span>
</pre></div>
<section id="first-transformation-xi-tanh-x"><h4>First transformation: <span class="math">\(\xi = \tanh(x)\)</span>
</h4>
<p>Let's consider first the transformation</p>
<div class="math">
\begin{equation*}
\xi = \tanh(x)\, .
\end{equation*}
</div>
<p>In this case</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}\xi}{\mathrm{d}x} = 1 - \tanh^2(x) = 1 - \xi^2\, ,
\end{equation*}
</div>
<p>and</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}^2\xi}{\mathrm{d}x^2} = -2\tanh(x)[1 - \tanh^2(x)] = -2\xi[1 - \xi^2]\, .
\end{equation*}
</div>
<p>We need to define the functions</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_c05bf05b5f904a8b817bb51a56473519-1" name="rest_code_c05bf05b5f904a8b817bb51a56473519-1" href="#rest_code_c05bf05b5f904a8b817bb51a56473519-1"></a><span class="n">pot</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<a id="rest_code_c05bf05b5f904a8b817bb51a56473519-2" name="rest_code_c05bf05b5f904a8b817bb51a56473519-2" href="#rest_code_c05bf05b5f904a8b817bb51a56473519-2"></a><span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
<a id="rest_code_c05bf05b5f904a8b817bb51a56473519-3" name="rest_code_c05bf05b5f904a8b817bb51a56473519-3" href="#rest_code_c05bf05b5f904a8b817bb51a56473519-3"></a><span class="n">dxdxi</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="o">**</span><span class="mi">2</span>
<a id="rest_code_c05bf05b5f904a8b817bb51a56473519-4" name="rest_code_c05bf05b5f904a8b817bb51a56473519-4" href="#rest_code_c05bf05b5f904a8b817bb51a56473519-4"></a><span class="n">dxdxi2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
<p>and run the function</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_070f4f697c844eda8a85a4944e65617b-1" name="rest_code_070f4f697c844eda8a85a4944e65617b-1" href="#rest_code_070f4f697c844eda8a85a4944e65617b-1"></a><span class="n">x</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">mapped_FD</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">dxdxi</span><span class="p">,</span> <span class="n">dxdxi2</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
<a id="rest_code_070f4f697c844eda8a85a4944e65617b-2" name="rest_code_070f4f697c844eda8a85a4944e65617b-2" href="#rest_code_070f4f697c844eda8a85a4944e65617b-2"></a><span class="n">vals</span>
</pre></div>
<p>And we obtain the following</p>
<pre class="literal-block">array([0.49989989, 1.4984226 , 2.49003572, 3.46934257, 4.46935021,
       5.59552989])</pre>
<p>If we compare with the analytic values we get the following.</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_714d445d2c7248c88b4d38a8324ff8d6-1" name="rest_code_714d445d2c7248c88b4d38a8324ff8d6-1" href="#rest_code_714d445d2c7248c88b4d38a8324ff8d6-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a id="rest_code_714d445d2c7248c88b4d38a8324ff8d6-2" name="rest_code_714d445d2c7248c88b4d38a8324ff8d6-2" href="#rest_code_714d445d2c7248c88b4d38a8324ff8d6-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anal_vals</span><span class="p">)</span>
<a id="rest_code_714d445d2c7248c88b4d38a8324ff8d6-3" name="rest_code_714d445d2c7248c88b4d38a8324ff8d6-3" href="#rest_code_714d445d2c7248c88b4d38a8324ff8d6-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">)</span>
<a id="rest_code_714d445d2c7248c88b4d38a8324ff8d6-4" name="rest_code_714d445d2c7248c88b4d38a8324ff8d6-4" href="#rest_code_714d445d2c7248c88b4d38a8324ff8d6-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Analytic"</span><span class="p">,</span> <span class="s2">"Finite differences"</span><span class="p">])</span>
<a id="rest_code_714d445d2c7248c88b4d38a8324ff8d6-5" name="rest_code_714d445d2c7248c88b4d38a8324ff8d6-5" href="#rest_code_714d445d2c7248c88b4d38a8324ff8d6-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_714d445d2c7248c88b4d38a8324ff8d6-6" name="rest_code_714d445d2c7248c88b4d38a8324ff8d6-6" href="#rest_code_714d445d2c7248c88b4d38a8324ff8d6-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$E_n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_714d445d2c7248c88b4d38a8324ff8d6-7" name="rest_code_714d445d2c7248c88b4d38a8324ff8d6-7" href="#rest_code_714d445d2c7248c88b4d38a8324ff8d6-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
<img alt="Eigenvalues for the first transformation" class="align-center" src="../../images/infinite_fdm/eigvals_tanh.svg" style="width: 600px;"><p>And the following are the eigenfunctions.</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_705ad6d01973448eb55ed44a673e1783-1" name="rest_code_705ad6d01973448eb55ed44a673e1783-1" href="#rest_code_705ad6d01973448eb55ed44a673e1783-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a id="rest_code_705ad6d01973448eb55ed44a673e1783-2" name="rest_code_705ad6d01973448eb55ed44a673e1783-2" href="#rest_code_705ad6d01973448eb55ed44a673e1783-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vecs</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_705ad6d01973448eb55ed44a673e1783-3" name="rest_code_705ad6d01973448eb55ed44a673e1783-3" href="#rest_code_705ad6d01973448eb55ed44a673e1783-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a id="rest_code_705ad6d01973448eb55ed44a673e1783-4" name="rest_code_705ad6d01973448eb55ed44a673e1783-4" href="#rest_code_705ad6d01973448eb55ed44a673e1783-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_705ad6d01973448eb55ed44a673e1783-5" name="rest_code_705ad6d01973448eb55ed44a673e1783-5" href="#rest_code_705ad6d01973448eb55ed44a673e1783-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$|\psi_n(x)|^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_705ad6d01973448eb55ed44a673e1783-6" name="rest_code_705ad6d01973448eb55ed44a673e1783-6" href="#rest_code_705ad6d01973448eb55ed44a673e1783-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<a id="rest_code_705ad6d01973448eb55ed44a673e1783-7" name="rest_code_705ad6d01973448eb55ed44a673e1783-7" href="#rest_code_705ad6d01973448eb55ed44a673e1783-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
<img alt="Eigenfunctions for the first transformation" class="align-center" src="../../images/infinite_fdm/eigvecs_tanh.svg" style="width: 600px;"></section><section id="second-transformation-xi-frac-2-pi-mathrm-atan-x"><h4>Second transformation: <span class="math">\(\xi = \frac{2}{\pi}\mathrm{atan}(x)\)</span>
</h4>
<p>Let's consider first the transformation</p>
<div class="math">
\begin{equation*}
\xi = \frac{2}{\pi}\mathrm{atan}(x)\, .
\end{equation*}
</div>
<p>In this case</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}\xi}{\mathrm{d}x} = \frac{2}{\pi(1 + x^2)} = \frac{2 \cos^2\xi}{\pi} \, ,
\end{equation*}
</div>
<p>and</p>
<div class="math">
\begin{equation*}
\frac{\mathrm{d}^2\xi}{\mathrm{d}x^2} = -\frac{4x}{\pi(1 + x^2)^2} = -\frac{4 \cos^4\xi \tan \xi}{\pi}\, .
\end{equation*}
</div>
<p>Once, again, we define the functions.</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_e0b7673ea7d1443dae90ed9c50b51e85-1" name="rest_code_e0b7673ea7d1443dae90ed9c50b51e85-1" href="#rest_code_e0b7673ea7d1443dae90ed9c50b51e85-1"></a><span class="n">pot</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<a id="rest_code_e0b7673ea7d1443dae90ed9c50b51e85-2" name="rest_code_e0b7673ea7d1443dae90ed9c50b51e85-2" href="#rest_code_e0b7673ea7d1443dae90ed9c50b51e85-2"></a><span class="n">fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span>
<a id="rest_code_e0b7673ea7d1443dae90ed9c50b51e85-3" name="rest_code_e0b7673ea7d1443dae90ed9c50b51e85-3" href="#rest_code_e0b7673ea7d1443dae90ed9c50b51e85-3"></a><span class="n">dxdxi</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a id="rest_code_e0b7673ea7d1443dae90ed9c50b51e85-4" name="rest_code_e0b7673ea7d1443dae90ed9c50b51e85-4" href="#rest_code_e0b7673ea7d1443dae90ed9c50b51e85-4"></a><span class="n">dxdxi2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span>
</pre></div>
<p>and run the function</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_66fe005fd8804b0c9b93cafd7d189403-1" name="rest_code_66fe005fd8804b0c9b93cafd7d189403-1" href="#rest_code_66fe005fd8804b0c9b93cafd7d189403-1"></a><span class="n">x</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">mapped_FD</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">dxdxi</span><span class="p">,</span> <span class="n">dxdxi2</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
<a id="rest_code_66fe005fd8804b0c9b93cafd7d189403-2" name="rest_code_66fe005fd8804b0c9b93cafd7d189403-2" href="#rest_code_66fe005fd8804b0c9b93cafd7d189403-2"></a><span class="n">vals</span>
</pre></div>
<p>to obtain the following eigenvalues</p>
<pre class="literal-block">array([0.49997815, 1.49979632, 2.49930872, 3.49824697, 4.49627555,
       5.49295665])</pre>
<p>with this plot</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-1" name="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-1" href="#rest_code_d58d16675ded4eea89fd9c64ad5b56ed-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a id="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-2" name="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-2" href="#rest_code_d58d16675ded4eea89fd9c64ad5b56ed-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anal_vals</span><span class="p">)</span>
<a id="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-3" name="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-3" href="#rest_code_d58d16675ded4eea89fd9c64ad5b56ed-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">)</span>
<a id="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-4" name="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-4" href="#rest_code_d58d16675ded4eea89fd9c64ad5b56ed-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">"Analytic"</span><span class="p">,</span> <span class="s2">"Finite differences"</span><span class="p">])</span>
<a id="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-5" name="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-5" href="#rest_code_d58d16675ded4eea89fd9c64ad5b56ed-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-6" name="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-6" href="#rest_code_d58d16675ded4eea89fd9c64ad5b56ed-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$E_n$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-7" name="rest_code_d58d16675ded4eea89fd9c64ad5b56ed-7" href="#rest_code_d58d16675ded4eea89fd9c64ad5b56ed-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
<img alt="Eigenvalues for the second transformation" class="align-center" src="../../images/infinite_fdm/eigvals_atan.svg" style="width: 600px;"><p>and the following eigenfunctions.</p>
<div class="code"><pre class="code ipython3"><a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-1" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-1" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-2" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-2" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vecs</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-3" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-3" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-4" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-4" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$|\psi|^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-5" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-5" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-6" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-6" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-7" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-7" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$|\psi_n(x)|^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-8" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-8" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<a id="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-9" name="rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-9" href="#rest_code_e9ac4a90ffdc4f699c52e0b8b72bce02-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
<img alt="Eigenfunctions for the second transformation" class="align-center" src="../../images/infinite_fdm/eigvecs_atan.svg" style="width: 600px;"></section></section><section id="conclusion"><h3>Conclusion</h3>
<p>The method works fine, although the differential equation is more
convoluted due to the change of variable. Although there are more
elegant methods to consider infinite domains, this is simple enough to
be solved in 10 lines of code.</p>
<p>We can see that the mapping <span class="math">\(\xi = \mathrm{atan}(x)\)</span>, covers
better the domain than <span class="math">\(\xi = \tanh(x)\)</span>, where most of the points
are placed in the center of the interval.</p>
<p>Thanks for reading!</p>
<small>
  <i>
    This post was written in the Jupyter notebook. You can
    <a href="../../downloads/notebooks/finite_diff_map.ipynb">download</a>
    this notebook, or see a static view on
    <a href="http://nbviewer.jupyter.org/url/nicoguaro.github.io/downloads/notebooks/finite_diff_map.ipynb">nbviewer</a>.
  <i>
</i></i></small></section></section>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/finite-difference-method/" rel="tag">finite difference method</a></li>
            <li><a class="tag p-category" href="../../categories/pde/" rel="tag">pde</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/quantum-mechanics/" rel="tag">quantum mechanics</a></li>
            <li><a class="tag p-category" href="../../categories/scientific-computing/" rel="tag">scientific computing</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../cyclic_colormaps/" rel="prev" title="Cyclic colormaps comparison">Previous post</a>
            </li>
            <li class="next">
                <a href="../isometric_inkscape/" rel="next" title="Isometric graphics in Inkscape">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
    
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nicoguaro-github",
            disqus_url="https://nicoguaro.github.io/posts/infinite_fdm/",
        disqus_title="Finite differences in infinite domains",
        disqus_identifier="cache/posts/infinite_fdm.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><script>var disqus_shortname="nicoguaro-github";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p><a href="https://creativecommons.org/licenses/by/4.0/" rel="nofollow">CC BY 4.0</a> © 2025 <a href="mailto:nicoguarin@gmail.com">Nicolás Guarín-Zapata</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> - <a rel="me" href="https://fosstodon.org/@nicoguaro">Mastodon profile</a></p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145359674-1', 'auto');
ga('send', 'pageview');
</script><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
